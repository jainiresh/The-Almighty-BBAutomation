"use strict";(self.webpackChunkensemble_client=self.webpackChunkensemble_client||[]).push([[599],{31323:function(e,t,n){n.d(t,{V:function(){return f}});var i=n(29439),r=n(81694),o=n.n(r),a=n(72791),s=n(5107),l=n(19055),c="Ribbon_container__xD9Wk",u="Ribbon_arrowButton__EbrfN",d="Ribbon_arrowLeft__UHVxP",v="Ribbon_arrowRight__znr9X",m="Ribbon_itemsContainer__0NOsK",p=n(80184),f=function(e){var t=e.children,n=e.itemsContainerClassName,r=e.lastChildMargin,f=void 0===r?0:r,_=e.stepSize,h=void 0===_?1:_,w=(0,a.useState)(0),g=(0,i.Z)(w,2),I=g[0],b=g[1],x=(0,a.useState)(0),C=(0,i.Z)(x,2),E=C[0],y=C[1],T=(0,a.useState)(0),N=(0,i.Z)(T,2),R=N[0],A=N[1],j=(0,a.useRef)(null),k=(0,s.Z)(j);(0,a.useEffect)((function(){j.current&&(A(j.current.scrollWidth),y(j.current.clientWidth))}),[j.current]);var D=(0,a.useCallback)((function(e){if(j.current&&j.current.children[0]&&!k){var t=function(e){var t=getComputedStyle(e),n=e.parentElement&&getComputedStyle(e.parentElement),i=parseInt((null===n||void 0===n?void 0:n.columnGap)||"")||0,r=parseInt(t.marginLeft)+parseInt(t.marginRight)+i,o=parseInt(t.borderLeftWidth)+parseInt(t.borderRightWidth);return parseFloat(t.width)+r+o}(j.current.children[0]),n=t*h;if("left"===e){var i=I-n<R?I-n:I-t;return j.current.scrollTo({left:i,behavior:"smooth"})}var r=I+n<R?I+n:I+t;j.current.scrollTo({left:r,behavior:"smooth"})}}),[I,R,h,k]),S=(0,a.useCallback)((function(){D("left")}),[D]),Z=(0,a.useCallback)((function(){D("right")}),[D]),O=!(I+E===R||I+E>R-f)&&(I>0||R>E),M=0!==I&&I>0;return(0,p.jsxs)("div",{className:c,"data-test-id":"ribbon.container",children:[M&&(0,p.jsx)("button",{className:o()(u,d),onClick:S,"data-test-id":"ribbon.navigation.left",children:(0,p.jsx)(l.Ub,{size:"extra-large"})}),(0,p.jsx)("div",{ref:j,onScroll:function(e){if(e.target){var t=e.target;b(t.scrollLeft),y(t.clientWidth),A(t.scrollWidth)}},className:o()(m,n),children:t}),O&&(0,p.jsx)("button",{className:o()(u,v),onClick:Z,"data-test-id":"ribbon.navigation.right",children:(0,p.jsx)(l.FM,{size:"extra-large"})})]})}},36107:function(e,t,n){n.r(t),n.d(t,{default:function(){return pv}});var i=n(93433),r=n(4942),o=n(15861),a=n(1413),s=n(29439),l=n(64687),c=n.n(l),u=n(81694),d=n.n(u),v=n(89420),m=n(72791),p=n(39230),f=n(59434),_=n(57689),h=n(11087),w=n(94516),g=n(97415),I=n(19055),b=n(54715),x=n(24566),C="ReviewTracker_base__MBiGs",E="ReviewTracker_regular__mRg+P",y="ReviewTracker_small__KoQ7K",T="ReviewTracker_transparentRegular__VwO3-",N="ReviewTracker_transparentSmallLeave__Kp9eB",R="ReviewTracker_transparentSmallEnter__fvkLv",A="ReviewTracker_noTransition__nvn-q",j=n(80184);function k(e){var t=e.children,n=e.onClick,i=e.className,r=e.size,o=void 0===r?"regular":r,l=e.show,c=e.animate,u=void 0===c||c,v=e.yThreshold,p=void 0===v?100:v,f=e.inverseScroll,_=void 0!==f&&f,h=(0,w.Z)().y,g=(0,m.useState)(l),I=(0,s.Z)(g,2),b=I[0],k=I[1],D={};n&&(D=(0,a.Z)((0,a.Z)({},D),{},{onClick:n})),(0,m.useEffect)((function(){return void 0!==l?k(l):!_&&h>=p||_&&h<=p?k(!1):void k(!0)}),[l,b,o,h,p,_]);var S=u&&!b&&"regular"===o&&T,Z=u&&!b&&"small"===o&&N,O=u&&b&&"small"===o&&R,M=!u&&"small"===o&&A,P="regular"===o?E:y,L=d()(C,P,i,S,Z,O,M);return(0,j.jsx)(x.YP,(0,a.Z)((0,a.Z)({appearance:"secondary",size:o,className:L},D),{},{children:t}))}var D=n(26342),S=n(66952),Z=n(7879),O=n(94970),M=function(e,t,n,r){var o=[],a=0,s=function(e){var n=o.findIndex((function(t){return t===e}));n>-1&&e===t&&a++,-1===n&&(o=[].concat((0,i.Z)(o),[e]))};e.forEach((function(e){var t,i,r,o;null===(t=e.comments)||void 0===t||null===(i=t.nodes)||void 0===i||i.forEach((function(e){var t=(0,O.ac)({author:e.author,teamMembers:n});t&&s(t)})),null===(r=e.approvedBy)||void 0===r||r.forEach((function(e){s(e.email)})),null===(o=e.favoritedBy)||void 0===o||o.forEach((function(e){s(e.email)}))}));var l=o.indexOf(t,0);return r&&-1===l?1:!r&&a<2?-1:0},P=n(9911),L=n(38684),V=n(18298),F=n(13368),B=n(27029),U=n(31609),W=n(15263),G=n(2491),H=n(68899),q=n(42592),z=n(29845),Y=n(54164),$=n(40549);function K(e){var t=(0,m.useRef)(null),n=function(n){t.current&&!t.current.contains(n.target)&&e()};return(0,m.useEffect)((function(){return document.addEventListener("click",n,!0),function(){document.removeEventListener("click",n,!0)}}),[]),{ref:t}}var X=n(70472),Q=n(64104),J=n(71775),ee=n(1793),te=n(85288),ne=n(763),ie=n(46724),re=n(89827),oe="AssetMarkupToolbar_root__sJuLj",ae="AssetMarkupToolbar_disabled__Rx5+F",se="AssetMarkupToolbar_divider__UA8re",le="AssetMarkupToolbar_icon__2gny6",ce="AssetMarkupToolbar_button__RrGAf",ue="ColorPicker_root__X4Tw1",de="ColorPicker_button__a4RWn",ve="ColorPicker_selected__EA8i3";function me(e){var t=e.colors,n=e.onSelectColor,i=e.selectedColor;return(0,j.jsx)("div",{className:ue,"data-test-id":"colorPicker",children:t.map((function(e){return(0,j.jsx)("button",{className:d()(de,(0,r.Z)({},ve,i.toLowerCase()===e.toLowerCase())),style:{backgroundColor:e},onClick:function(){return n(e)},"data-test-id":"colorPicker.button"},"color-picker-button-".concat(e))}))})}var pe=["#E65050","#FCB315","#FFFFFF","#000000"];function fe(e){var t=e.currentMarkupColor,n=e.isClearMarkupDisabled,i=e.isDisabled,r=void 0!==i&&i,o=e.onSelectColor,a=e.onClearMarkup,l=(0,p.$G)().t,c=(0,m.useState)(!1),u=(0,s.Z)(c,2),v=u[0],f=u[1],_=(0,j.jsx)(x.hU,{size:"small",appearance:"default",className:ce,style:{color:t,fill:t},"data-test-id":"assetMarkupToolbar.selectColorButton",disabled:r,children:(0,j.jsx)(I.Ud,{size:"small"})});return(0,j.jsxs)("div",{className:d()(oe,r&&ae),"data-test-id":"assetMarkup.toolbar",children:[(0,j.jsx)(I.Lu,{size:"small",className:le}),(0,j.jsx)("span",{className:se}),(0,j.jsx)(re.u,{content:l("assetMarkup.toolbar.color_picker_label"),isEnabled:!v,children:(0,j.jsx)(ie.J,{positions:["top","bottom"],isShowing:v,setIsShowing:f,target:_,showArrow:!1,padding:12,children:(0,j.jsx)(me,{selectedColor:t,colors:pe,onSelectColor:function(e){f(!1),o(e)}})})}),(0,j.jsx)(re.u,{content:l("assetMarkup.toolbar.clear_markup_label"),isEnabled:!n,children:(0,j.jsx)(x.hU,{size:"small",appearance:"default",className:ce,onClick:function(){a()},"data-test-id":"assetMarkupToolbar.clearMarkupButton",disabled:n,children:(0,j.jsx)(I.rF,{size:"small"})})})]})}var _e=n(45987),he=n(40431),we="CheckboxInput_label__dpCZ0",ge="CheckboxInput_disabled__rxC9l",Ie="CheckboxInput_checkbox__UKalp",be="CheckboxInput_end__iotGq",xe="CheckboxInput_start__siZuR",Ce="CheckboxInput_dark__AciLW",Ee="CheckboxInput_light__Cri57",ye="CheckboxInput_check__PR9Ou",Te=(n(14783),["children","labelPlacement","theme","checked","name","value","id"]);function Ne(e){var t,n,i=e.children,o=e.labelPlacement,s=void 0===o?"end":o,l=e.theme,c=void 0===l?"light":l,u=e.checked,v=e.name,m=e.value,p=e.id,f=(0,_e.Z)(e,Te),_=(t={},(0,r.Z)(t,xe,"start"===s),(0,r.Z)(t,be,"end"===s),t),h=(n={},(0,r.Z)(n,Ee,"light"===c),(0,r.Z)(n,Ce,"dark"===c),n);return(0,j.jsxs)("label",{className:d()(we,(0,r.Z)({},ge,f.disabled)),htmlFor:p,children:["start"===s&&i,(0,j.jsxs)(he.Qg,(0,a.Z)((0,a.Z)({},f),{},{checked:u,className:d()(_),children:[(0,j.jsx)(he.ZX,{id:p,name:v,value:m}),(0,j.jsx)("span",{className:d()(Ie,h),children:u&&(0,j.jsx)(I._O,{className:ye,size:"small"})})]})),"end"===s&&i]})}var Re=n(90222),Ae=n(54333),je="ReviewItemDetailAnchorCommentsInput_checkboxContainer__XfGQO",ke="ReviewItemDetailAnchorCommentsInput_checkboxPanel__xdkpJ",De="ReviewItemDetailAnchorCommentsInput_label__B8ceS",Se="ReviewItemDetailAnchorCommentsInput_disabled__NsRQe",Ze="ReviewItemDetailAnchorCommentsInput_disabledText__jk63+";function Oe(e){var t=e.currentTime,n=e.currentPage,i=e.totalPages,o=e.isDisabled,a=void 0!==o&&o,s=e.isChecked,l=e.isVideo,c=e.isAudio,u=e.isPdf,v=e.onChange;return(0,j.jsx)("div",{className:d()(je,(0,r.Z)({},Se,a)),children:(0,j.jsx)("div",{className:ke,children:(0,j.jsx)(Ne,{id:"anchor-comment",checked:a||s,onChange:function(e){v(!s)},theme:"dark",labelPlacement:"start",disabled:a,children:(0,j.jsxs)(Re.k,{icon:u?I.a5:I.qp,space:"small",size:"small",className:d()(De,(0,r.Z)({},Ze,a)),children:[l&&(0,j.jsx)(Ae.q,{label:"current video time",seconds:t}),c&&(0,j.jsx)(Ae.q,{label:"current audio time",seconds:t}),u&&"".concat(n,"/").concat(i)]})})})})}var Me=function(e,t){var n=92+(t?0:52);return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)-n&&e.right<=(window.innerWidth||document.documentElement.clientWidth)},Pe="CommentsInput_commentsInputOuterContainer__8rwlx",Le="CommentsInput_commentsInputOuterContainer__editingLastComment__newaF",Ve="CommentsInput_commentsInputInnerContainer__3Ed8p",Fe="CommentsInput_commentsInput__id8MC",Be="CommentsInput_anchor__IRksC",Ue="CommentsInput_mobile__RGfIm",We="CommentsInput_editing__auQzo",Ge="CommentsInput_ctaGroup__u04ac",He="CommentsInput_toolbarContainer__XQdVv",qe="CommentsInput_rightAligned__tmwla",ze=function(e){var t,n,i,o,l=e.onCancelClick,c=e.onAddClick,u=e.onFocus,v=e.placeholderText,f=e.onChange,_=e.value,h=e.showMarkupToolbar,w=void 0!==h&&h,g=e.isEditingComment,I=void 0!==g&&g,b=e.isEditingLastComment,C=void 0!==b&&b,E=e.itemId,y=e.containerMeasurements,T=e.scrollableContainerRef,N=e.currentTime,R=e.currentPage,A=(0,p.$G)().t,k=(0,m.useContext)(te._f),D=k.currentMarkup,S=k.clearCurrentMarkup,O=k.markupSettings,M=k.setMarkupSettings,P=k.currentPDFPageCount,F=k.isAnchorCheckboxChecked,B=k.setIsAnchorCheckboxChecked,U=k.isEditCommentDirty,W=k.setIsEditCommentDirty,H=(0,m.useContext)(X.X).reviewItems,q=(0,V.G)().isMinDesktop,z=(0,L.T)(),Y=z.canUseFreeTier,$=z.previews,K=(0,m.useContext)(G.H).identity,Q=y||{containerHeight:0,inputContainerHeight:0,notesContainerHeight:0},J=Q.containerHeight,ee=Q.inputContainerHeight,ie=Q.notesContainerHeight,oe=H.find((function(e){return e.publicId===E})),ae=(0,Z.Tn)(oe),se=ae.isVideo,le=ae.isAudio,ce=ae.isPdf,ue=se||ce||le,de=Boolean(D[E]&&D[E].length>0),ve=Boolean((0,ne.isEmpty)(null===oe||void 0===oe||null===(t=oe.preview)||void 0===t?void 0:t.videoStatic)&&"OWNER"!==K&&"LOADING"!==K||oe&&oe.size&&Y&&$&&$.video.quota&&oe.size>$.video.quota&&"OWNER"===K),me=w||ue,pe=(0,m.useCallback)((function(){if(I){var e=document.getElementById("commentsInput--outerContainer");if(e){var t=e.getBoundingClientRect();if(!Me(t,q)&&null!==T&&void 0!==T&&T.current){if(t.top<0)return void e.scrollIntoView({behavior:"auto",block:"start"});e.scrollIntoView({behavior:"auto",block:"end"})}}}}),[I,q,T]),_e=(0,m.useRef)(null),he=(0,m.useState)(_),we=(0,s.Z)(he,2),ge=we[0],Ie=we[1],be=(0,m.useState)(window.innerHeight),xe=(0,s.Z)(be,2),Ce=xe[0],Ee=xe[1],ye=(0,m.useState)(!0),Te=(0,s.Z)(ye,2),Ne=Te[0],Re=Te[1],Ae=q?"inherit":"".concat(Ce-126,"px"),je=(0,m.useCallback)((function(e){var t=ue?"6.375rem":"8.5rem";!I&&q||(t="inherit");var n=(e||Ce)-(40+(me?36:0)+(q?ie:0)+64+(I?ee:36)+(q?0:52)),i=_e.current?"".concat(Math.min(_e.current.scrollHeight,n),"px"):t;_e.current&&(_e.current.style.minHeight=i)}),[Ce,ee,I,q,me,ue,ie]);(0,m.useEffect)((function(){ve&&B(!1)}),[ve,B]),(0,m.useEffect)((function(){var e;I&&J&&(pe(),je(null===(e=window.visualViewport)||void 0===e?void 0:e.height))}),[J,I,q,je,pe]),(0,m.useEffect)((function(){var e,t=function(){var e,t;Ee((null===(e=window.visualViewport)||void 0===e?void 0:e.height)||0),je(null===(t=window.visualViewport)||void 0===t?void 0:t.height)};return null===(e=window.visualViewport)||void 0===e||e.addEventListener("resize",t),function(){var e;return null===(e=window.visualViewport)||void 0===e?void 0:e.removeEventListener("resize",t)}}),[]),(0,m.useEffect)((function(){I&&_e.current&&je()}),[I,je]),(0,m.useEffect)((function(){I||(de&&!U&&W(!0),de||ge||W(!1))}),[de]);(0,m.useEffect)((function(){var e,t=(null===_||void 0===_?void 0:_.length)||0;(Ie(_),Ne)&&(null===(e=_e.current)||void 0===e||e.setSelectionRange(t,t));Re(!1)}),[_]);var ke=(0,m.useCallback)((function(e){I&&"Tab"===e.key&&e.preventDefault()}),[I]);return(0,j.jsxs)("div",{className:d()((n={},(0,r.Z)(n,Pe,I),(0,r.Z)(n,Le,C),n)),id:"commentsInput--outerContainer",onKeyDown:ke,children:[(0,j.jsxs)("div",{className:Ve,style:{maxHeight:Ae},children:[(0,j.jsxs)("div",{className:d()((i={},(0,r.Z)(i,He,me),(0,r.Z)(i,qe,!w),i)),id:"commentsInput--toolbarContainer",children:[w&&(0,j.jsx)(fe,{currentMarkupColor:O.color,currentMarkupTool:O.selectedTool,onSelectColor:function(e){return M((0,a.Z)((0,a.Z)({},O),{},{color:e}))},onClearMarkup:function(){return S(E)},isClearMarkupDisabled:!de,onSelectMarkupTool:function(e){return M((0,a.Z)((0,a.Z)({},O),{},{selectedTool:e}))},isDisabled:ve}),ue&&(null!==N||null!==R)&&(0,j.jsx)(re.u,{content:A("assetMarkup.anchorInput.".concat(ce?"disabledPageTooltip":"disabledTimeTooltip")),isEnabled:de,positions:["right"],children:(0,j.jsx)(Oe,{currentTime:N||0,currentPage:R||0,totalPages:P,isPdf:ce,isVideo:se,isAudio:le,isChecked:!!de||F,onChange:B,isDisabled:de||I||ve})})]}),(0,j.jsx)("textarea",{autoFocus:!0,"data-test-id":"commentsInput--input",maxLength:1e3,ref:_e,className:d()(Fe,(o={},(0,r.Z)(o,Be,ue),(0,r.Z)(o,Ue,!q&&!I),(0,r.Z)(o,We,I),o)),onChange:function(e){je();var t=e.target.value;e.target.value.trim()||(t=""),Ie(t),f(t),pe(),W(de||(I?t!==_&&!!t:!!t))},onFocus:u,value:ge,placeholder:v,rows:I?1:void 0})]}),(0,j.jsxs)("div",{className:Ge,id:"commentsInput--ctaGroup",children:[(0,j.jsx)(x.YP,{"data-test-id":"commentsInput--cancelButton",onClick:l,appearance:"neutral",size:"small",children:A("cancel")}),(0,j.jsx)(x.YP,{"data-test-id":"commentsInput--addButton",onClick:function(){W(!1),c(),S(E)},disabled:!U,size:"small",children:A(I?"comments.save_changes":"add")})]})]})},Ye=function(e){return e.replace(/\n\s*\n/g,"\n\n").replace(/ +/g," ").trim()},$e="Comments_commentsContainer__jsLif",Ke={commentContainer:"Comment_commentContainer__AbfEz",commentContainer__notEditing:"Comment_commentContainer__notEditing__7Fjvb",commentContainer__showBorder:"Comment_commentContainer__showBorder__HbF-W",commentContainer__clickable:"Comment_commentContainer__clickable__yG4-s",commentContainer__clickableHover:"Comment_commentContainer__clickableHover__DDsUT",commentContainer__active:"Comment_commentContainer__active__yagCO",commentContainer__comment:"Comment_commentContainer__comment__6WtHW",commentContainer__author:"Comment_commentContainer__author__gKl2w",commentContainer__header:"Comment_commentContainer__header__qvawT",timeStamp:"Comment_timeStamp__20iic",anchor:"Comment_anchor__-5SvT"},Xe=function(e){var t,n=e.comment,i=e.commentAuthor,o=e.timeElapsedSinceCommentString,a=e.dateOfCommentString,s=e.showBorder,l=void 0!==s&&s,c=e.id,u=e.isActive,v=void 0!==u&&u,m=e.isEditing,f=void 0!==m&&m,_=e.isEdited,h=void 0!==_&&_,w=e.renderAnchor,g=e.onClick,I=(0,p.$G)().t,b=g?"button":"div",x=i.split("@")[0],C=(0,te.ze)().contextMenuHoveredId;return(0,j.jsx)(b,{className:d()(Ke.commentContainer,(t={},(0,r.Z)(t,Ke.commentContainer__clickable,"button"===b),(0,r.Z)(t,Ke.commentContainer__clickableHover,"button"===b&&!f),(0,r.Z)(t,Ke.commentContainer__active,"button"===b&&v||C===c),(0,r.Z)(t,Ke.commentContainer__notEditing,!f),(0,r.Z)(t,Ke.commentContainer__editing,f),(0,r.Z)(t,Ke.commentContainer__showBorder,l),t)),onClick:g,id:"comment-".concat(c),"data-test-id":"comment-".concat(c),children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:Ke.commentContainer__header,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("span",{className:Ke.commentContainer__author,children:x})," ","\xb7"," ",(0,j.jsx)(re.u,{size:"auto",isEnabled:!0,positions:["top"],content:a,children:(0,j.jsxs)("span",{className:Ke.timeStamp,children:[o,h&&" (".concat(I("comments.edited"),")")]})})]}),w&&(0,j.jsx)("div",{className:Ke.anchor,children:(0,j.jsx)(j.Fragment,{children:null===w||void 0===w?void 0:w()})})]}),n&&(0,j.jsx)("p",{className:Ke.commentContainer__comment,children:n})]})})},Qe=n(99426),Je="CommentDeleteModal_header__d7sDS",et="CommentDeleteModal_headerText__OmQIQ",tt="CommentDeleteModal_text__DSRrK",nt="CommentDeleteModal_buttonContainer__q+JqD",it="CommentDeleteModal_button__-ZhTE",rt="CommentDeleteModal_delete__KGG4M",ot="CommentDeleteModal_modal__DaPNe",at=["onDismiss","onDeleteClick"];function st(e){var t=e.onDismiss,n=e.onDeleteClick,i=(0,_e.Z)(e,at),r=(0,p.$G)().t;return(0,j.jsxs)(Qe.u,(0,a.Z)((0,a.Z)({},i),{},{ariaLabel:r("comments.delete_comment"),onDismiss:t,styleOverrides:ot,children:[(0,j.jsx)("div",{className:Je,children:(0,j.jsx)("p",{className:et,children:r("comments.delete_comment")})}),(0,j.jsx)("p",{className:tt,children:r("comments.delete_comment_message")}),(0,j.jsxs)("div",{className:nt,children:[(0,j.jsx)(x.LE,{appearance:"destructive",onClick:n,"data-test-id":"comment.delete",className:it,children:r("comments.delete_comment_button")}),(0,j.jsx)(x.LE,{appearance:"secondary",onClick:t,className:d()(it,rt),children:r("comments.cancel")})]})]}))}var lt=n(60173),ct=n(65310),ut="ContextMenu_commentMenuContainer__OA2u-",dt="ContextMenu_menuPopover__dsALp",vt="ContextMenu_menuItems__u16oa",mt="ContextMenu_multipleItems__AcHYP",pt="ContextMenu_menuItem__+gu+W",ft="ContextMenu_menuHitRegion__lQshA",_t="ContextMenu_menuButton__NOgHj",ht="ContextMenu_expanded__i3nAc",wt=function(e){var t=e.onEditComment,n=e.onDeleteComment,i=e.isAddCommentOpen,o=e.isCommentActive,a=e.isCommentOwner,s=e.isHovering,l=e.itemId,c=void 0===l?"":l,u=e.onClick,v=(0,p.$G)().t,m=(0,te.ze)(),f=m.editingCommentId,_=m.isCommentContextMenuOpen,h=m.setIsCommentContextMenuOpen,w=m.setContextMenuHoveredId,g=m.resetCommentContextMenu,b=(0,L.T)(),C=b.canDeleteComments,E=b.canEditComments,y=K((function(){g()})).ref,T=function(e){return lt.nI?e:void 0};return(0,j.jsx)("div",{className:ut,onMouseOver:T((function(){return w(c)})),onMouseOut:T((function(){return w("")})),children:(0,j.jsx)("div",{"data-test-id":"comment.contextMenu",onClick:function(e){e.stopPropagation(),e.preventDefault(),h(!1),w(""),_||null===u||void 0===u||u()},ref:y,children:(0,j.jsx)(ct.v2,{children:function(e){var l=e.isExpanded,c=a&&!i&&!f&&(C||E)&&(!lt.nI||lt.nI&&(l||s&&(!_||o)));return(0,j.jsxs)(j.Fragment,{children:[c&&(0,j.jsx)(ct.j2,{as:x.hU,className:d()(ft),children:(0,j.jsx)("div",{"data-test-id":"comment-context-menu-button",className:d()(_t,(0,r.Z)({},ht,l)),children:(0,j.jsx)(I.v2,{size:"extra-small"})})}),l?(0,j.jsx)(ct.YI,{className:dt,offsetYAbove:8,offsetYBelow:8,offsetX:4,align:"left",children:(0,j.jsxs)(ct.sd,{className:d()(vt,(0,r.Z)({},mt,E&&C)),children:[E&&(0,j.jsx)(ct.sN,{onSelect:t,className:pt,children:v("comments.edit")}),C&&(0,j.jsx)(ct.sN,{onSelect:n,className:pt,children:v("comments.delete")})]})}):null]})}})})})},gt=function(e){var t=e.comments,n=e.seekToValue,i=e.renderAnchoredComments,r=e.currentUser,o=e.currentUserFullName,a=e.isSelectDisabled,l=e.itemId,c=e.addMarkupEnabled,u=e.onDeleteCommentClick,d=e.onEditSaveCommentClick,v=e.onIsEditingComment,f=e.isAddCommentOpen,h=e.containerMeasurements,w=e.scrollableContainerRef,g=(0,p.$G)().t,I=(0,te.ze)(),b=I.activeCommentId,x=I.editingCommentId,C=I.setActiveCommentId,E=I.resetCommentContextMenu,y=I.hoveredCommentId,T=I.setHoveredCommentId,N=I.setIsCommentContextMenuOpen,R=I.setEditingCommentId,A=(0,m.useState)(""),k=(0,s.Z)(A,2),D=k[0],S=k[1],Z=(0,m.useState)(null),O=(0,s.Z)(Z,2),M=O[0],P=O[1],L=(0,m.useState)(!1),F=(0,s.Z)(L,2),B=F[0],U=F[1],W=(0,m.useState)(!1),G=(0,s.Z)(W,2),H=G[0],q=G[1],z=(0,V.G)().isMinDesktop,Y=(0,_.TH)(),$=new URLSearchParams(Y.search),K=!0,X=function(){E(),T(""),N(!1)},Q=function(){U(!1),P(null)};return(0,j.jsxs)("div",{children:[null===t||void 0===t?void 0:t.filter((function(e){return e})).map((function(e,s){var u,p,_,I=e.author,E=e.body,N=e.createdAt,A=e.updatedAt,k=e.publicId,Z=e.anchor,O=(0,ee.gU)(new Date(N),"MMM d',' y").returnedDateFormat,M=(0,ee.gU)(new Date(N),"h:mmaaa").returnedDateFormat,L="".concat(O," ").concat(g("at")," ").concat(M),V=(0,ee.C5)(new Date(N),new Date),F=!(!A||A===N),W=null!==(u=null===Z||void 0===Z?void 0:Z.timestamp)&&void 0!==u?u:null,G=null!==(p=null===Z||void 0===Z?void 0:Z.page)&&void 0!==p?p:null,Y=null!==(_=null===Z||void 0===Z?void 0:Z.markup)&&void 0!==_?_:null,Q=function(){R(null),q(!1),null===v||void 0===v||v(!1)},J=function(e){if(!a){if(b===k&&!e)return void C("");if(C(k),Z){if(!z&&$.get("item")&&!e){var t=document.getElementById("item-preview-".concat($.get("item")));null===t||void 0===t||t.scrollIntoView({behavior:"smooth"})}null===n||void 0===n||n({timestamp:W,page:G})}}},te=s===t.length-1;te&&(K=!1);var ne=!!r&&[r,o].includes(I),ie=k===b,re=k===x,oe=null!==Y||null!==W||null!==G;return(0,j.jsx)(m.Fragment,{children:(0,j.jsxs)("div",{className:$e,onMouseEnter:function(){return e=k,void(B||x||T(e));var e},onMouseLeave:function(){y===k&&T("")},children:[!re&&(0,j.jsx)(Xe,{id:k,comment:E,showBorder:K,commentAuthor:I,timeElapsedSinceCommentString:V,dateOfCommentString:L,isActive:ie,isEditing:re,isEdited:F,renderAnchor:function(){return null===i||void 0===i?void 0:i({timestamp:W,page:G,author:I,markup:Y})},onClick:a||!oe?void 0:function(){return J(!1)}},k),!a&&(0,j.jsx)(wt,{isAddCommentOpen:f,isCommentActive:ie,isCommentOwner:ne,isHovering:y===k,onEditComment:function(){return function(e,t,n){S(t),R(e),q(n),null===v||void 0===v||v(!0),X()}(k,E,te)},onDeleteComment:function(){return P(k),X(),void U(!0)},onClick:function(){return J(!0)},itemId:k}),re&&(0,j.jsx)(ze,{onCancelClick:Q,onAddClick:function(){Q(),null===d||void 0===d||d(k,Ye(D))},onFocus:function(){S(E)},onChange:function(e){S(e)},value:E,showMarkupToolbar:c,itemId:l||"",isEditingComment:!0,isEditingLastComment:H,containerMeasurements:h,scrollableContainerRef:w,currentTime:W,currentPage:G})]})},k)})),B&&(0,j.jsx)(st,{onDismiss:Q,onDeleteClick:function(){return M&&(null===u||void 0===u||u(M)),void Q()}})]})},It=(0,m.createContext)({review:null,team:void 0,teamMembers:null,user:void 0}),bt=function(e){var t=e.children,n=e.review,i=e.team,r=e.teamMembers,o=e.user,a=(0,m.useMemo)((function(){return{review:n,team:i,teamMembers:r,user:o}}),[n,i,r,o]);return(0,j.jsx)(It.Provider,{value:a,children:t})},xt="CommentAnchor_commentAnchor__+dB0T",Ct="CommentAnchor_label__yborT",Et="CommentAnchor_indicator__SxCx2",yt="CommentAnchor_valueContainer__RRKUn",Tt="CommentAnchor_iconContainer__+4QYs";function Nt(e){var t=e.displayTime,n=e.displayPage,i=e.displayMarkup,r=e.isPdf,o=e.isVideo,a=e.isAudio,s=e.color,l=e.showIndicator;return(0,j.jsxs)("div",{className:xt,children:[i?(0,j.jsx)("div",{className:Tt,children:(0,j.jsx)(I.Lu,{size:"small"})}):null,(o||a)&&void 0!==t&&null!==t&&(0,j.jsxs)("div",{className:Ct,children:[(0,j.jsx)("div",{className:yt,children:(0,j.jsx)(Ae.q,{label:"current video time",seconds:t})}),l&&(0,j.jsx)("div",{className:Et,style:{background:s,border:"1px solid rgba(0,0,0,0.5)"}})]}),r&&void 0!==n&&null!==n&&(0,j.jsx)("div",{className:d()(Ct,yt),children:"p. ".concat(n)})]})}var Rt=n(28e3),At=n(21706),jt=n(21800),kt=n(64161),Dt="NotificationsOverlay_notificationsOverlayContainer__ADDz1",St="NotificationsOverlay_notificationsOverlayContainer__content__B8Qif",Zt="NotificationsOverlay_notificationsOverlayContainer__content_emptyState__fB1RN",Ot="NotificationsOverlay_notificationsOverlayContainer__header__HGIh8",Mt="NotificationsOverlay_notificationsOverlayContainer__header_title__5pDyN",Pt="NotificationsOverlay_notificationsOverlayContainer__header_close__PAqd+",Lt=function(e){var t=e.title,n=e.onClose,i=e.children,r=e.emptyStateString,o=e.showEmptyState,a=void 0!==o&&o,s=(0,p.$G)().t,l=K((function(){return n()})).ref,c=a||!i;return(0,j.jsxs)("div",{className:Dt,ref:l,children:[(0,j.jsxs)("div",{className:Ot,children:[(0,j.jsx)("div",{className:Mt,children:t&&(0,j.jsx)(Re.k,{icon:I.$B,space:"small",children:(0,j.jsx)("p",{children:t})})}),(0,j.jsx)("div",{className:Pt,children:(0,j.jsx)(x.hU,{"data-test-id":"notificationsOverlay.closeButton",type:"button",onClick:function(){return n()},appearance:"inverted",children:(0,j.jsx)(I.x8,{size:"large"})})})]}),(0,j.jsxs)("div",{className:St,children:[i,c&&(0,j.jsx)("div",{"data-test-id":"notificationsOverlay.emptyStateString",className:Zt,children:r||s("report.list.no_new_notifications_available")})]})]})},Vt="Report_pageContainer__pDOhM",Ft="Report_reportContentWrapper__vtDGc",Bt="Report_reportRibbon__tU47r",Ut="Report_commentsOverlay__Nq+yb",Wt="Report_commentsOverlay__note__nYNTU",Gt="Report_spinnerWrapper__GgP5S",Ht="Report_commentOverlayEnter__wNOEh",qt="Report_commentOverlayEnterDone__-QHQU",zt="Report_commentOverlayExit__Z84bA",Yt="Report_commentOverlayExitDone__VM7qI",$t="ReportHeader_popOverMenu__E8b+f",Kt="ReportHeader_reportHeader__TGrRE",Xt="ReportHeader_reportHeaderCta__EmSCh",Qt="ReportHeader_reportHeaderIntro__1TQJD",Jt="ReportHeader_reportSummaryTitle__8bPwo",en="ReportHeader_reportSubHeader__i2suH",tn="ReportHeader_reportUpdateMeta__po5U8",nn="ReportHeader_reportAction__XhLGa",rn="ReportHeader_reportDueDate__7hryF",on="ReportHeader_reportActionType__sBCuI",an=function(e){var t=e.review,n=e.date,i=(0,p.$G)().t,r="'".concat(i("report.header.dueBy"),"' MMM d' ").concat(i("at")," ' h:mmaaa"),o=(0,ee.gU)(new Date(t.dueDate),r).returnedDateFormat,a=(0,m.useState)(!1),l=(0,s.Z)(a,2),c=l[0],u=l[1],d=function(){u(!0)},v=function(){u(!1)},f=t.dueDate?o:i("report.header.noDueDate"),_=t.dueDate?o:"";return(0,j.jsxs)("header",{className:Kt,children:[(0,j.jsxs)("div",{className:Qt,children:[(0,j.jsx)("span",{className:en,children:i("report.header.my_report")}),(0,j.jsx)("h1",{className:Jt,children:t.title||i("report.header.untitled")}),(0,j.jsx)("div",{className:tn,children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(p.cC,{i18nKey:"report.header.updated_on",components:[(0,j.jsx)("time",{dateTime:n,children:", "})],values:{date:n}})," ",(0,j.jsx)(ie.J,{arrowColor:"#333333",isShowing:c,target:(0,j.jsx)(x.CE,{className:Xt,type:"button",onMouseEnter:d,onMouseLeave:v,onTouchStart:function(){u((function(e){return!e}))},onFocus:d,onBlur:v,children:i("report.header.who_can_see_this")}),children:(0,j.jsx)("div",{className:$t,children:i("report.header.only_you_and_your_team")})})]})})]}),(0,j.jsxs)("div",{className:nn,children:["FAVORITE"===t.actionType&&(0,j.jsx)(Re.k,{icon:I.Rh,space:"small",className:on,children:i("report.header.favorite_items")}),"APPROVE"===t.actionType&&(0,j.jsx)(Re.k,{icon:I.Th,space:"small",className:on,children:i("report.header.approve_items")}),"VIEW"===t.actionType&&(0,j.jsx)(Re.k,{icon:I.xZ,space:"small",className:on,children:i("report.header.view_items")}),"DOWNLOAD"===t.actionType&&(0,j.jsx)(Re.k,{icon:I.W1,space:"small",className:on,children:i("report.header.download_files")}),(0,j.jsx)("span",{className:rn,children:(0,j.jsx)(Re.k,{icon:I.qp,space:"small",className:on,children:(0,j.jsx)("time",{dateTime:_,children:f})})})]})]})},sn=n(17434),ln=n(62758);function cn(e,t,n){var i=(0,p.$G)().t;return"ACTION"===e&&"APPROVE"===t?i(n?"report.stats.approveHeaderWithActivity":"report.stats.approveHeaderWithoutActivity"):"ACTION"===e&&"FAVORITE"===t?i(n?"report.stats.favoriteHeaderWithActivity":"report.stats.favoriteHeaderWithoutActivity"):"COMMENT"===e?i(n?"report.stats.commentHeaderWithActivity":"report.stats.commentHeaderWithoutActivity"):"ACTIVITY"===e?i(n?"report.stats.activityHeaderWithActivity":"report.stats.activityHeaderWithoutActivity"):void 0}function un(e,t,n,i){var r=(0,p.$G)().t;return"ACTION"===e&&"APPROVE"===t?r(n?"report.stats.approveCountWithActivity":"report.stats.approveCountWithoutActivity",{count:i}):"ACTION"===e&&"FAVORITE"===t?r(n?"report.stats.favoriteCountWithActivity":"report.stats.favoriteCountWithoutActivity",{count:i}):"COMMENT"===e?r("report.stats.commentCount",{count:i}):"ACTIVITY"===e?r(n?"report.stats.activityCountWithActivity":"report.stats.activityCountWithoutActivity",{count:i}):void 0}var dn=n(61910),vn=n(97507),mn="DropdownWithIcon_dropdownWithIconContainer__TNVXh",pn="DropdownWithIcon_dropdownWithIconContainer__headline__LAmrH",fn="DropdownWithIcon_dropdownWithIconContainer__headline_iconImage__0yROL",_n="DropdownWithIcon_dropdownWithIconContainer__dropdown__Zur5Z",hn=function(e){var t,n,i=e.options,r=e.onDropdownItemClick,o=e.indexOptionToHighlight,l=(0,m.useState)(i[0]),c=(0,s.Z)(l,2),u=c[0],d=c[1],v=(0,m.useState)(),p=(0,s.Z)(v,2),f=p[0],_=p[1],h=(0,m.useRef)(null),w="".concat(null===(t=h.current)||void 0===t?void 0:t.offsetWidth,"px"),g="".concat(null===(n=h.current)||void 0===n?void 0:n.offsetHeight,"px");return(0,m.useEffect)((function(){i.every((function(e){return e.index}))?_(i):_(i.map((function(e,t){return(0,a.Z)((0,a.Z)({},e),{},{index:t})})))}),[i]),(0,m.useEffect)((function(){f&&!o&&d(f[0]),f&&o&&d(f[o])}),[f,o]),(0,j.jsx)(dn.v2,{"data-test-id":"dropdownWithIcon.container",children:(0,j.jsxs)("div",{className:mn,children:[(0,j.jsxs)(dn.j2,{"data-test-id":"dropdownWithIcon.headlineText-".concat(u.title),className:pn,"aria-label":u.title,ref:h,children:[(0,j.jsx)(Re.k,{size:"regular",space:"small",icon:u.iconHighlightedState,children:u.title}),(0,j.jsx)("div",{className:fn,children:(0,j.jsx)(Re.k,{size:"small",space:"none",icon:I.Wg})})]}),(0,j.jsx)(dn.YI,{position:vn.g0,portal:!1,style:{width:w,marginTop:g},children:(0,j.jsx)(dn.sd,{className:_n,children:f&&f.sort((function(e,t){return e.index-t.index})).map((function(e){var t=e.title,n=e.iconNormalState,i=e.iconHighlightedState,o=e.index,a=e.stringToEmit;return(0,j.jsx)(dn.sN,{"data-test-id":"dropdownWithIcon.dropdownOption-".concat(t,"-").concat(o),onSelect:function(){return function(e){var t=e.title,n=e.iconHighlightedState,i=e.index,o=e.stringToEmit;d({title:t,iconHighlightedState:n,index:i,stringToEmit:o}),r(o,i)}({title:t,iconHighlightedState:i,index:o,stringToEmit:a})},children:(0,j.jsx)(Re.k,{size:"regular",space:"small",icon:n,children:t})},o)}))})})]})})},wn="ReportFilterOptionSelector_dropdownContainer__zyx3x",gn="ReportFilterOptionSelector_tabbedStrip__LEO-h",In="TabbedStrip_tab__eE9BI",bn="TabbedStrip_selectedTab__BbiKs",xn="TabbedStrip_iconedText__6ZWk9",Cn=function(e){var t=e.options,n=(0,m.useState)(t),i=(0,s.Z)(n,2),o=i[0],l=i[1],c=(0,sn.gC)().selectedIndex;return(0,m.useEffect)((function(){t.every((function(e){return e.index}))?l(t):l(t.map((function(e,t){return(0,a.Z)((0,a.Z)({},e),{},{index:t})})))}),[t]),(0,j.jsx)(j.Fragment,{children:o&&o.sort((function(e,t){return e.index-t.index})).map((function(e,t){var n=e.title,i=e.iconNormalState,o=e.iconHighlightedState,a=d()(In,(0,r.Z)({},bn,c===t));return(0,j.jsx)(sn.OK,{"data-test-id":"tabbedStrip.tabItem-".concat(n),className:a,children:(0,j.jsx)(Re.k,{className:xn,size:"regular",space:"small",icon:c===t?o:i,children:n})},t)}))})},En=function(e){var t=e.options,n=e.onOptionSelected,i=e.wrapperClassName,r=e.setSharedSelectedTabIndex,o=(0,sn.gC)().selectedIndex;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:d()(wn,i),children:(0,j.jsx)(hn,{options:t,indexOptionToHighlight:o,onDropdownItemClick:function(e,t){n(e),r(t)}})}),(0,j.jsx)(sn.td,{className:d()(gn,i),children:(0,j.jsx)(Cn,{options:t})})]})},yn=n(98972),Tn=n(73993),Nn=n(14160),Rn="ImagePlaceholderWithTitle_imagePlaceholderWithTitleContainer__LDY3D",An="ImagePlaceholderWithTitle_image__LmeO7",jn="ImagePlaceholderWithTitle_itemPreviewOverrides__A75de",kn="ImagePlaceholderWithTitle_hoverImage__kt9z7",Dn="ImagePlaceholderWithTitle_metadataContainer__1bY0L",Sn="ImagePlaceholderWithTitle_metadata__mKwry",Zn="ImagePlaceholderWithTitle_subMetadata__bf29-",On="ImagePlaceholderWithTitle_fadeOutAnimation__obkUT",Mn=function(e){var t=e.item,n=e.title,i=e.onHover,o=e.showSubMetadata,a=void 0===o||o,l=e.subMetadata,c=e.containerStylesOverride,u=e.onImageClick,v=(0,m.useState)(!1),p=(0,s.Z)(v,2),f=p[0],_=p[1],h=i||f,w=d()(kn,(0,r.Z)({},On,!h)),g=d()(Rn,c);return(0,j.jsxs)("div",{className:g,onMouseEnter:function(){return _(!0)},onMouseLeave:function(){return _(!1)},onFocus:function(){return _(!0)},onBlur:function(){return _(!1)},children:[(0,j.jsxs)("button",{className:An,onKeyDown:function(e){("Space"===e.nativeEvent.code||"Enter"===e.nativeEvent.key)&&(e.preventDefault(),u(e))},onClick:u,children:[(0,j.jsx)(Nn.t,{reviewItem:t,styleOverrides:jn,hideTitle:!0,isReportView:!0,shouldDisplayPreviewPadding:!1,shouldDisplayBorder:!1}),h&&(0,j.jsx)("span",{className:w,children:(0,j.jsx)(I.Fu,{size:"large"})})]}),(0,j.jsxs)("div",{className:Dn,children:[(0,j.jsx)("p",{className:Sn,"aria-label":n,children:n}),a&&h&&l&&(0,j.jsx)("p",{className:Zn,"aria-label":l,children:l})]})]})},Pn="NotificationIndicator_notificationIndicatorContainer__+t6rI",Ln="NotificationIndicator_notificationIndicatorOff__IDOH5",Vn=function(e){var t=e.show,n=e.stylesOverride,i=d()(Pn,(0,r.Z)({},Ln,!t),n);return(0,j.jsx)("div",{className:i})},Fn="NotifierWithIcon_notifierWithIconEmpty__z38FR",Bn=function(e){var t=e.notificationValue,n=void 0===t?0:t,i=e.icon,o=n>0,a=o?n>99?"99+":n:"-",s=d()((0,r.Z)({},Fn,!o));return(0,j.jsx)(Re.k,{className:s,size:"regular",space:"extra-small",icon:i,children:(0,j.jsx)("span",{"data-test-id":"notifierWithIconValue",className:s,children:a})})},Un="ReportLineItem_reportLineItemContainer__IPmDY",Wn="ReportLineItem_reportLineItemContainer__emptyState__NNcKB",Gn="ReportLineItem_reportLineItemContainer__content__tcUBn",Hn="ReportLineItem_reportLineItemContainer__content__imagePlaceholderWithTitle__Ddywo",qn="ReportLineItem_reportLineItemContainer__content__metrics__q+Kue",zn="ReportLineItem_viewComments__q+wqW",Yn=function(e){var t=e.onClick,n=e.item,i=e.eventToBeEmittedOnClick,r=void 0===i?"NOT_SET":i,o=e.showCommentsNotifier,a=void 0===o||o,l=e.showFavouritesNotifier,c=void 0===l||l,u=e.showNotificationIndicator,v=void 0===u||u,f=e.showApprovalsNotifier,_=void 0===f||f,h=e.numberOfFavourites,w=e.numberOfComments,g=e.numberOfApprovals,b=e.subMetadata,C=e.showEmptyState,E=void 0!==C&&C,y=e.emptyStateString,T=e.showViewCommentsButton,N=void 0===T||T,R=e.onImagePlaceholderClick,A=e.emptyStateContainerStyles,k=e.highlightedContainerStyles,D=e.analyticsTracker,S=(0,m.useState)(!1),Z=(0,s.Z)(S,2),O=Z[0],M=Z[1],P=(0,m.useState)(!1),L=(0,s.Z)(P,2),V=L[0],F=L[1],B=(0,p.$G)().t,U=(null===n||void 0===n?void 0:n.name)||"",W=(0,yn.bv)(n),G=(0,yn.vt)({previewType:W,filename:U}),H=W!==Tn.s.CollectLink&&!Tn.s.PasteLink||U?G:B("report.list.".concat(G)),q=function(e,n){("Space"===e.code||"Enter"===e.key)&&(e.preventDefault(),t(n))},z=function(){return(0,j.jsx)("div",{onKeyDown:function(e){return q(e,r)},"data-test-id":"reportLineItem.emptyState",className:d()(Un,Wn,A),children:y||B("report.list.no_items_to_display")})};return(0,j.jsx)(j.Fragment,{children:E?(0,j.jsx)(z,{}):(0,j.jsx)("div",{role:"row","data-test-id":"reportLineItem.lineItem",onKeyDown:function(e){return q(e,r)},className:d()(Un,k),onClick:function(){return t(r)},onMouseEnter:function(){return M(!0)},onMouseLeave:function(){return M(!1)},onFocus:function(){F(!0)},children:(0,j.jsxs)("div",{role:"cell",className:Gn,children:[(0,j.jsx)(Vn,{show:v}),(0,j.jsx)("div",{className:Hn,children:(0,j.jsx)(Mn,{item:n,title:H,onHover:O,subMetadata:b,onImageClick:function(e){e.stopPropagation(),F(!1),R&&R(),(null===D||void 0===D?void 0:D.trackItemDetailClick)&&D.trackItemDetailClick()}})}),(0,j.jsxs)("div",{className:qn,children:[c&&(0,j.jsx)(Bn,{icon:I.Rh,notificationValue:h}),_&&(0,j.jsx)(Bn,{icon:I.Th,notificationValue:g}),a&&(0,j.jsx)(Bn,{icon:I.I3,notificationValue:w})]}),(V||O)&&a&&N&&(0,j.jsx)(x.CE,{className:zn,onClick:function(e){e.preventDefault(),(null===D||void 0===D?void 0:D.trackViewCommentsButtonClick)&&(null===D||void 0===D||D.trackViewCommentsButtonClick())},onBlur:function(){F(!1)},children:B("report.list.view_comments")})]})})})},$n="ReportList_reportFilterWrapper__3UWFb",Kn="ReportList_itemsListWrapper__n9LUy",Xn="ReportList_itemsListWrapper__reversed__MeujU",Qn="ReportList_reportSubHeaderWrapper__304cg",Jn="ReportList_reportSubHeader__fxMyQ",ei="ReportList_inlineButton__YtDXF",ti="ReportList_inactiveStateContainerOverride__w7xkk",ni="ReportList_activeStateContainerOverride__h6q0R",ii=function(e,t){switch(e){case"COMMENT":return"report.list.no_items_with_comments";case"ACTIVITY":return"report.list.no_items_with_activity";case"ACTION":return"APPROVE"===t.actionType?"report.list.no_items_approved":"report.list.no_items_favorited";default:return""}},ri=function(e){var t=e.analyticsTracker,n=e.review,i=e.onClickLineItem,o=e.isFetchingReviewItems,l=e.filterOption,c=e.setFilterOption,u=e.itemsInView,v=e.sortedByActionCount,h=e.commentCount,w=e.sortedByNoActivityCount,g=e.reviewHasAtLeastOneComment,b=e.highlightedLineItemId,C=(0,p.$G)().t,E=(0,_.s0)(),y=(0,B.Fn)(),T=y.fireEvent,N=y.fireErrorEvent,R=(0,_.TH)(),A=(0,V.G)().isMinTablet,k=(0,f.v9)(ln.m2.selectEntities),S=(0,m.useContext)(It),Z=S.teamMembers,M=S.user,P=cn(l,null===n||void 0===n?void 0:n.actionType,!0),L=cn(l,null===n||void 0===n?void 0:n.actionType,!1),F=un(Ni.action,null===n||void 0===n?void 0:n.actionType,!0,v),U=un(Ni.comment,null===n||void 0===n?void 0:n.actionType,!0,h),W=un(Ni.activity,null===n||void 0===n?void 0:n.actionType,!1,w),G=[{title:F||Ni.action,stringToEmit:Ni.action,iconNormalState:"APPROVE"===n.actionType?I.EC:I.OE,iconHighlightedState:"APPROVE"===n.actionType?I.Th:I.Rh},{title:U||Ni.comment,stringToEmit:Ni.comment,iconNormalState:I.cV,iconHighlightedState:I.I3},{title:W||Ni.activity,stringToEmit:Ni.activity,iconNormalState:I.a5,iconHighlightedState:I.n0}],H=[{title:U||Ni.comment,stringToEmit:Ni.comment,iconNormalState:I.cV,iconHighlightedState:I.I3},{title:W||Ni.activity,stringToEmit:Ni.activity,iconNormalState:I.a5,iconHighlightedState:I.n0}],q=[{title:F||Ni.action,stringToEmit:Ni.action,iconNormalState:"APPROVE"===n.actionType?I.EC:I.OE,iconHighlightedState:"APPROVE"===n.actionType?I.Th:I.Rh},{title:W||Ni.activity,stringToEmit:Ni.activity,iconNormalState:I.a5,iconHighlightedState:I.n0}],z=[{title:C("report.stats.items_in_this_review"),stringToEmit:Ni.list}],Y=(0,m.useState)(G),$=(0,s.Z)(Y,2),K=$[0],X=$[1],Q=(0,m.useState)(0),J=(0,s.Z)(Q,2),ee=J[0],te=J[1],ne=function(e){var i=e.filter((function(e){return e.name})).map((function(e,t){return 0===t?e.name:" ".concat(e.name)})).toString();navigator.clipboard.writeText(i).then((function(){T({eventName:B.B_.FILENAMES_EXPORTED,groups:(0,r.Z)({},B.YT.REVIEW,null===n||void 0===n?void 0:n.publicId)}),(0,D.t6)({message:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Re.k,{icon:I.CK,space:"small",children:1===e.length?C("report.header.filename_copied_to_clipboard"):C("report.header.filenames_copied_to_clipboard")})})})}),(function(){N("error.failed_to_copy_error"),(0,D.t6)({message:C("error.failed_to_copy_error"),type:"error"})})),t.trackCopyFilenamesClick()},ie=function(e,t,n){if(!t||!t.length)return"";var i=(0,O.RM)({actionRequests:t,teamMembers:Z,user:M}),r=i.name,o=i.names;return o?C("FAVORITE"===e?"report.stats.favoritedBy_multiple":"report.stats.approvedBy_multiple",{name:r,names:o}):C("FAVORITE"===e?"report.stats.favoritedBy_single":"report.stats.approvedBy_single",{name:r})};(0,m.useEffect)((function(){if(!n.commentsEnabled&&!g)return"APPROVE"!==(null===n||void 0===n?void 0:n.actionType)&&"FAVORITE"!==(null===n||void 0===n?void 0:n.actionType)?(c(Ni.list),X(z)):(c(Ni.action),X(q));"VIEW"!==n.actionType&&"DOWNLOAD"!==n.actionType&&n.actionType||(c(Ni.comment),X(H))}),[n,v,h,w]);var re=function(e){return b?e.publicId===b?ni:ti:""},oe=function(e){E({pathname:R.pathname,search:"?item=".concat(e.publicId)})};return(0,j.jsxs)(sn.mQ,{index:ee,onChange:function(e){T({eventName:B.B_.REPORT_SORTED,groups:(0,r.Z)({},B.YT.REVIEW,null===n||void 0===n?void 0:n.publicId)}),c(K[e].stringToEmit),te(e)},children:[(0,j.jsx)(En,{options:K,onOptionSelected:function(e){return c(e)},setSharedSelectedTabIndex:te,wrapperClassName:$n}),(0,j.jsx)(sn.nP,{children:(0,j.jsxs)(sn.x4,{className:d()(Kn,"ACTIVITY"===l&&Xn),role:"table",children:["LIST"!==l&&(0,j.jsxs)("div",{role:"rowgroup",children:[(0,j.jsxs)("div",{role:"row",className:Qn,children:[(0,j.jsx)("span",{className:Jn,role:"rowheader",children:P}),u.hasActivity.length>0&&(0,j.jsx)(x.CE,{className:ei,type:"button",onClick:function(){return ne(u.hasActivity)},children:(0,j.jsx)(Re.k,{icon:I.CK,space:A?"extra-small":"none",size:"small",children:A&&(1===u.hasActivity.length?C("report.header.copy_filename"):C("report.header.copy_filenames"))})})]}),0===u.hasActivity.length&&(0,j.jsx)(Yn,{showEmptyState:!0,onClick:function(){},emptyStateString:C(ii(l,n))}),!o&&u.hasActivity.length>0&&u.hasActivity.map((function(e,r){var o,s,l,c,u,d=(null===e||void 0===e||null===(o=e.preview)||void 0===o||null===(s=o.image)||void 0===s?void 0:s.url)||void 0,v={item:e,eventToBeEmittedOnClick:function(){},showCommentsNotifier:n.commentsEnabled||g,showViewCommentsButton:n.commentsEnabled||g,showFavouritesNotifier:"FAVORITE"===n.actionType,showApprovalsNotifier:"APPROVE"===n.actionType,showNotificationIndicator:!1,numberOfFavourites:null===e||void 0===e||null===(l=e.favoritedBy)||void 0===l?void 0:l.length,numberOfApprovals:null===e||void 0===e||null===(c=e.approvedBy)||void 0===c?void 0:c.length,numberOfComments:null===(u=k[e.publicId])||void 0===u?void 0:u.totalCount,itemTitle:e.name||"",imageSource:d,highlightedContainerStyles:re(e),subMetadata:(e.approvedBy||e.favoritedBy)&&ie(n.actionType,"FAVORITE"===n.actionType?e.favoritedBy:e.approvedBy),onClick:function(){var t;return i({title:v.itemTitle,comments:null===(t=k[e.publicId])||void 0===t?void 0:t.nodes,note:e.note,item:e})},analyticsTracker:{trackItemDetailClick:t.trackItemDetailClick,trackViewCommentsButtonClick:t.trackViewCommentsButtonClick}};return(0,j.jsx)(Yn,(0,a.Z)((0,a.Z)({},v),{},{onImagePlaceholderClick:function(){return oe(e)}}),r)}))]}),(0,j.jsxs)("div",{role:"rowgroup",children:[(0,j.jsxs)("div",{className:Qn,role:"row",children:[(0,j.jsx)("span",{className:Jn,role:"rowheader",children:L}),u.hasNoActivity.length>0&&(0,j.jsx)(x.CE,{className:ei,type:"button",onClick:function(){return ne(u.hasNoActivity)},children:(0,j.jsx)(Re.k,{icon:I.CK,space:A?"extra-small":"none",size:"small",children:A&&(1===u.hasActivity.length?C("report.header.copy_filename"):C("report.header.copy_filenames"))})})]}),0===u.hasNoActivity.length&&(0,j.jsx)(Yn,{showEmptyState:!0,onClick:function(){}}),u.hasNoActivity.length>0&&u.hasNoActivity.map((function(e,r){var o,s,l,c,u,d=(null===e||void 0===e||null===(o=e.preview)||void 0===o||null===(s=o.image)||void 0===s?void 0:s.url)||void 0,v={item:e,eventToBeEmittedOnClick:function(){},showCommentsNotifier:n.commentsEnabled||g,showViewCommentsButton:n.commentsEnabled||g,showFavouritesNotifier:"FAVORITE"===n.actionType,showApprovalsNotifier:"APPROVE"===n.actionType,showNotificationIndicator:!1,numberOfFavourites:null===e||void 0===e||null===(l=e.favoritedBy)||void 0===l?void 0:l.length,numberOfApprovals:null===e||void 0===e||null===(c=e.approvedBy)||void 0===c?void 0:c.length,numberOfComments:null===(u=k[e.publicId])||void 0===u?void 0:u.totalCount,itemTitle:e.name||"",imageSource:d,highlightedContainerStyles:re(e),subMetadata:(e.approvedBy||e.favoritedBy)&&ie(n.actionType,"FAVORITE"===n.actionType?e.favoritedBy:e.approvedBy),onClick:function(){var t;return i({title:v.itemTitle,comments:null===(t=k[e.publicId])||void 0===t?void 0:t.nodes,note:e.note,item:e})},analyticsTracker:{trackItemDetailClick:t.trackItemDetailClick,trackViewCommentsButtonClick:t.trackViewCommentsButtonClick}};return(0,j.jsx)(Yn,(0,a.Z)((0,a.Z)({},v),{},{onImagePlaceholderClick:function(){return oe(e)}}),r)}))]})]})})]})},oi=n(31323),ai="ReportRibbon_root__gQqie",si="ReportRibbon_infoContainer__hPonV",li="ReportRibbon_ribbonContainer__rTJ6N",ci="ReportRibbon_item__kInlJ",ui="ReportRibbon_lastItem__igvLA",di="ReportRibbon_padded__BrScD",vi="ReportSummary_bold__54XwI";function mi(e){var t=e.review,n=e.totalFavoritedCount,i=e.totalApprovedCount,r=e.totalCommentCount,o=(0,p.$G)().t;if(!t)return null;var a=![n,i,r].every((function(e){return 0===e})),s=null===t||void 0===t?void 0:t.actionRequests,l=(null===s||void 0===s?void 0:s.length)||0;if(!a)return 0===l?(0,j.jsx)(j.Fragment,{children:o("report.review_status.review_no_reviewers")}):(0,j.jsx)(j.Fragment,{children:o("report.review_status.review_waiting_for_reviewers")});if("APPROVE"===t.actionType){if(1===r){if(1===i)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_approved_one_comments_one",components:[(0,j.jsx)("span",{className:vi})]});if(i>1)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_approved_other_comments_one",values:{approved_count:i},components:[(0,j.jsx)("span",{className:vi})]})}if(r>1){if(1===i)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_approved_one_comments_other",values:{comment_count:r},components:[(0,j.jsx)("span",{className:vi})]});if(i>1)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_approved_other_comments_other",values:{approved_count:i,comment_count:r},components:[(0,j.jsx)("span",{className:vi})]})}if(i)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_approved",values:{count:i},components:[(0,j.jsx)("span",{className:vi})]})}if("FAVORITE"===t.actionType){if(1===r){if(1===n)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_favorited_one_comments_one",components:[(0,j.jsx)("span",{className:vi})]});if(n>1)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_favorited_other_comments_one",values:{favorited_count:n},components:[(0,j.jsx)("span",{className:vi})]})}if(r>1){if(1===n)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_favorited_one_comments_other",values:{comment_count:r},components:[(0,j.jsx)("span",{className:vi})]});if(n>1)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_favorited_other_comments_other",values:{favorited_count:n,comment_count:r},components:[(0,j.jsx)("span",{className:vi})]})}if(n)return(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_favorited",values:{count:n},components:[(0,j.jsx)("span",{className:vi})]})}return r?(0,j.jsx)(p.cC,{i18nKey:"report.review_status.reviewers_comments",values:{count:r},components:[(0,j.jsx)("span",{className:vi})]}):null}var pi=n(62738),fi="ReviewerCard_reviewerCardContainer__iEVWf",_i="ReviewerCard_reviewerCardContainer__reviewerAndMetadataContainer__jlerh",hi="ReviewerCard_reviewerCardContainer__reviewerIdentifier__hbUbI",wi="ReviewerCard_reviewerCardContainer__reviewerIdentifier_disable__5MseB",gi="ReviewerCard_reviewerCardContainer__metadata__pnIsQ",Ii="ReviewerCard_reviewerCardContainer__disable__wRT84",bi=function(e){var t=e.reviewerIdentifier,n=e.icon,i=e.metadata,o=e.disableCard,a=void 0!==o&&o,s=e.containerStylesOverride,l=d()(fi,(0,r.Z)({},Ii,a),s),c=d()(hi,(0,r.Z)({},wi,a)),u=(0,pi.J)(t,30);return(0,j.jsxs)("div",{className:l,children:[(0,j.jsx)(Re.k,{size:"regular",space:"small",icon:n}),(0,j.jsxs)("div",{className:_i,children:[(0,j.jsx)("p",{"data-test-id":"reviewerCard.reviewerIdentifier",className:c,title:t,children:u}),(0,j.jsx)("p",{className:gi,children:i})]})]})},xi=function(e){var t=e.review,n=e.totalApprovedCount,i=e.totalCommentCount,o=e.totalFavoritedCount,a=e.cards;return(0,j.jsxs)("div",{className:ai,children:[(0,j.jsx)("div",{className:si,children:(0,j.jsx)("p",{children:(0,j.jsx)(mi,{review:t,totalApprovedCount:n,totalCommentCount:i,totalFavoritedCount:o})})}),a.length>0?(0,j.jsx)("div",{className:li,children:(0,j.jsx)(oi.V,{lastChildMargin:93,children:a.map((function(e,t){var n,i=e.reviewerIdentifier,o=e.metadata,s=e.icon,l=e.disableCard;return(0,j.jsx)("div",{className:d()(ci,(n={},(0,r.Z)(n,di,0===t),(0,r.Z)(n,ui,t===a.length-1),n)),children:(0,j.jsx)(bi,{reviewerIdentifier:i,metadata:o,icon:s,disableCard:l})},"report-ribbon-item-".concat(t))}))})}):null]})};function Ci(e,t){return e.name&&t.name?new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}).compare(e.name,t.name):0}function Ei(e,t){return e.comments&&t.comments?e.comments.totalCount<t.comments.totalCount?1:e.comments.totalCount>t.comments.totalCount?-1:Ci(e,t):0}function yi(e,t){return e.approvedBy&&t.approvedBy?e.approvedBy.length<t.approvedBy.length?1:e.approvedBy.length>t.approvedBy.length?-1:Ei(e,t):0}function Ti(e,t){return e.favoritedBy&&t.favoritedBy?e.favoritedBy.length<t.favoritedBy.length?1:e.favoritedBy.length>t.favoritedBy.length?-1:Ei(e,t):0}var Ni={action:"ACTION",comment:"COMMENT",activity:"ACTIVITY",list:"LIST"};function Ri(e){var t,n,a,l,u=e.portalId,d=e.containerRef,v=e.review,h=e.commentOverlayPanelOpen,w=e.commentOverlayPanelClosed,g=(0,p.$G)().t,b=(0,B.Fn)(),x=b.fireEvent,C=b.fireErrorEvent,E=(0,P.T)(),y=(0,V.G)().isMinTablet,T=(0,_.UO)().reviewId,N=(0,Rt.B)({portalId:u,reviewId:T}).guestTokenId,R=(0,m.useContext)(It),A=R.team,k=R.teamMembers,S=R.user,M=(0,f.v9)(kt.v9),L=(0,z.g)({portalId:u,guestTokenId:N}).portal,F=(0,m.useRef)(null),U=(0,m.useState)(),W=(0,s.Z)(U,2),G=W[0],H=W[1],q=(0,m.useState)(!1),Y=(0,s.Z)(q,2),K=Y[0],X=Y[1],Q=(0,m.useState)(!1),te=(0,s.Z)(Q,2),ne=te[0],ie=te[1],re=(0,m.useState)(!1),oe=(0,s.Z)(re,2),ae=oe[0],se=oe[1],le=(0,m.useState)(!1),ce=(0,s.Z)(le,2),ue=ce[0],de=ce[1],ve=(0,m.useState)(),me=(0,s.Z)(ve,2),pe=me[0],fe=me[1],_e=(0,m.useState)(),he=(0,s.Z)(_e,2),we=he[0],ge=he[1];function Ie(e,t){return e>=1920&&t>=1440}var be=(0,m.useMemo)(jt.yh,[]),xe=(0,m.useState)(0),Ce=(0,s.Z)(xe,2),Ee=Ce[0],ye=Ce[1],Te=(0,m.useRef)(Ie(window.innerWidth,window.innerHeight)?window.innerWidth:1920),Ne=(0,m.useRef)(Ie(window.innerWidth,window.innerHeight)?window.innerWidth:1440),Re=(0,m.useState)(),Ae=(0,s.Z)(Re,2),je=Ae[0],ke=Ae[1],De=(0,f.v9)((function(e){return be(e,T)})),Se=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Pe(!0),e.prev=1,e.next=4,E((0,At.sq)({reviewId:T,previewWidth:Te.current,previewHeight:Ne.current}));case 4:Pe(!1),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),(0,D.t6)({message:g("error.file_download_error"),type:"error"}),C("error.file_download_error");case 11:case"end":return e.stop()}}),e,null,[[1,7]])}))),[E,T,g,C]);(0,m.useEffect)((function(){Se()}),[Se]);var Ze=(0,m.useState)(!0),Oe=(0,s.Z)(Ze,2),Me=Oe[0],Pe=Oe[1],Le=(0,m.useState)(Ni.action),Ve=(0,s.Z)(Le,2),Fe=Ve[0],Be=Ve[1],Ue=(0,m.useMemo)((function(){if(De)return De.some((function(e){var t,n;return(null!==(t=null===(n=e.comments)||void 0===n?void 0:n.totalCount)&&void 0!==t?t:0)>0}))}),[De]),We=(0,m.useMemo)((function(){return De.length&&v?function(e,t){var n=[],i=[];return e.forEach((function(e){var t,r,o;null!==(t=e.comments)&&void 0!==t&&t.totalCount||null!==(r=e.favoritedBy)&&void 0!==r&&r.length||null!==(o=e.approvedBy)&&void 0!==o&&o.length?n.push(e):i.push(e)})),{hasActivity:"APPROVE"===t?n.sort(yi):"FAVORITE"===t?n.sort(Ti):n.sort(Ei),hasNoActivity:i.sort(Ci)}}(De,(null===v||void 0===v?void 0:v.actionType)||"APPROVE"):{hasActivity:[],hasNoActivity:[]}}),[v,De]),Ge=(0,m.useMemo)((function(){return De.length&&v?function(e,t){var n=[],i=[];return"FAVORITE"===t&&(e.forEach((function(e){var t;null!==(t=e.favoritedBy)&&void 0!==t&&t.length?n.push(e):i.push(e)})),i.sort(Ei),n.sort(Ti)),"APPROVE"===t&&(e.forEach((function(e){var t;null!==(t=e.approvedBy)&&void 0!==t&&t.length?n.push(e):i.push(e)})),i.sort(Ei),n.sort(yi)),{hasActivity:n,hasNoActivity:i}}(De,(null===v||void 0===v?void 0:v.actionType)||"APPROVE"):{hasActivity:[],hasNoActivity:[]}}),[v,De]),He=(0,m.useMemo)((function(){return De.length&&v?function(e,t){var n=[],i=[];return e.forEach((function(e){var t;null!==(t=e.comments)&&void 0!==t&&t.totalCount?n.push(e):i.push(e)})),{hasActivity:n.sort(Ei),hasNoActivity:"APPROVE"===t?i.sort(yi):"FAVORITE"===t?i.sort(Ti):i.sort(Ci)}}(De,(null===v||void 0===v?void 0:v.actionType)||"APPROVE"):{hasActivity:[],hasNoActivity:[]}}),[v,De]),qe=(0,m.useMemo)((function(){return De.length&&v?function(e){var t=[];return e.forEach((function(e){return t.push(e)})),{hasActivity:[],hasNoActivity:t.sort(Ci)}}(De):{hasActivity:[],hasNoActivity:[]}}),[v,De]),ze=(0,m.useMemo)((function(){return Fe===Ni.action?(ye(Ge.hasActivity.length),Ge):Fe===Ni.activity?We:Fe===Ni.comment?He:qe}),[Fe,Ge,We,He,qe]),Ye=(0,m.useMemo)((function(){var e,t=[];null!==v&&void 0!==v&&v.actionRequests&&De&&k&&(t=null===v||void 0===v||null===(e=v.actionRequests)||void 0===e?void 0:e.map((function(e){var t=e.email,n=e.completedAt,i=e.engagementType,r=(0,O.MG)({email:t,teamMembers:k,user:S});return{email:t,engagementType:i,completedAt:n,approvedByCount:0,favoritedByCount:0,commentCount:0,isTeammate:r.isTeammate,displayName:r.displayName}})),De.forEach((function(e){var n,r,o,a;null===(n=e.comments)||void 0===n||null===(r=n.nodes)||void 0===r||r.forEach((function(e){var n=t.findIndex((function(t){return(0,O.od)(e.author,t.email,k)}));if(n>-1)t[n].commentCount=t[n].commentCount+1;else{var r=(0,O.MG)({email:e.author,teamMembers:k,user:S}),o=r.isTeammate,a=r.displayName;t=[].concat((0,i.Z)(t),[{email:e.author,engagementType:void 0,approvedByCount:0,favoritedByCount:0,commentCount:1,completedAt:e.createdAt,isTeammate:o,displayName:a}])}})),null===(o=e.approvedBy)||void 0===o||o.forEach((function(e){var n=t.findIndex((function(t){return t.email===e.email}));n>-1&&(t[n].approvedByCount=t[n].approvedByCount+1)})),null===(a=e.favoritedBy)||void 0===a||a.forEach((function(e){var n=t.findIndex((function(t){return t.email===e.email}));n>-1&&(t[n].favoritedByCount=t[n].favoritedByCount+1)}))})));return t}),[null===v||void 0===v?void 0:v.actionRequests,De,k,S]),$e=(0,m.useMemo)((function(){return null===De||void 0===De?void 0:De.reduce((function(e,t){var n;return e+((null===t||void 0===t||null===(n=t.comments)||void 0===n?void 0:n.totalCount)||0)}),0)}),[De]),Ke=(0,m.useMemo)((function(){return Ye.reduce((function(e,t){return e+(t.commentCount||0)}),0)}),[Ye]),Xe=(null===v||void 0===v||null===(t=v.stats)||void 0===t?void 0:t.totalFavoritedCount)||0,Qe=(null===v||void 0===v||null===(n=v.stats)||void 0===n?void 0:n.totalApprovedCount)||0,Je=(null===v||void 0===v||null===(a=v.stats)||void 0===a?void 0:a.totalCommentCount)||0,et=!1;null!==v&&void 0!==v&&v.actionRequests&&(et=v.actionRequests.some((function(e){return"ASSIGNED"===e.engagementType})));var tt=0===Ee&&0===Ke&&!et,nt=(0,m.useCallback)((function(e){K||e?(X(!1),ke(""),w()):(x({eventName:B.B_.COMMENTS_PANEL_OPENED,groups:(0,r.Z)({},B.YT.REVIEW,null===v||void 0===v?void 0:v.publicId)}),X(!0),h())}),[null===v||void 0===v?void 0:v.publicId,K,h,w,ke,x]);(0,m.useEffect)((function(){var e;ne&&(ke(null===pe||void 0===pe||null===(e=pe.item)||void 0===e?void 0:e.publicId),ge(pe))}),[ne,pe,we,ke]);var it=(0,m.useCallback)((function(e){"Escape"===e.key&&nt(!0)}),[nt]);(0,m.useEffect)((function(){return document.addEventListener("keydown",it,!1),function(){document.removeEventListener("keydown",it,!1)}}),[]),(0,m.useEffect)((function(){if(v&&v.actionRequests&&k){var e=Ye.sort(O.wP).map((function(e){var t="",n="",i="",r=!0,o=!0;if(e){switch(n=g("report.stats.commentCount",{count:e.commentCount}),v.actionType){case"FAVORITE":i=g("report.stats.favoritedCount",{count:e.favoritedByCount});break;case"APPROVE":i=g("report.stats.approvedCount",{count:e.approvedByCount});break;case"DOWNLOAD":i=g("report.stats.downloaded");break;case"VIEW":i=g("report.stats.viewed")}(v.actionType&&v.commentsEnabled||v.actionType&&e.commentCount>0)&&(t="".concat(i,", ").concat(n)),(!v.actionType&&v.commentsEnabled||!v.actionType&&e.commentCount>0||("VIEW"===v.actionType||"DOWNLOAD"===v.actionType)&&!e.completedAt)&&(t="".concat(n)),v.actionType&&!v.commentsEnabled&&0===e.commentCount&&(t="".concat(i)),r=0===(null===e||void 0===e?void 0:e.favoritedByCount)&&0===(null===e||void 0===e?void 0:e.approvedByCount)&&0===e.commentCount&&!e.completedAt,o="SELF"===e.engagementType&&r}var a,s=e.completedAt;switch(v.actionType){case"APPROVE":a=s?I.Th:I.EC;break;case"DOWNLOAD":a=I.W1;break;case"FAVORITE":a=s?I.GM:I.OE;break;case"VIEW":a=I.xZ;break;default:a=e.commentCount>0?I.I3:I.cV}return v.actionType||v.commentsEnabled||(a=I.xZ),{reviewerIdentifier:e.displayName,icon:a,metadata:t,disableCard:r,hideCard:o}})).filter((function(e){return!e.hideCard}));H(e)}}),[v,k]);var rt=(0,m.useMemo)((function(){return null!==we&&void 0!==we&&we.comments?null===we||void 0===we?void 0:we.comments:[]}),[null===we||void 0===we?void 0:we.comments]),ot=(0,Z.Tn)(null===pe||void 0===pe?void 0:pe.item),at=ot.isVideo,st=ot.isPdf,lt=ot.isAudio;return(0,j.jsx)("div",{className:Vt,ref:d,children:(0,j.jsx)("div",{className:Ft,children:v?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(an,{review:v,date:function(e){var t="MMM d',' y '".concat(g("at"),"' h:mmaaa");return(0,ee.gU)(new Date(e),t).returnedDateFormat}(v.updatedAt)}),(0,j.jsxs)("main",{children:[!tt&&(0,j.jsx)("div",{className:Bt,children:(0,j.jsx)(xi,{review:v,totalApprovedCount:Qe,totalCommentCount:Je,totalFavoritedCount:Xe,cards:G||[]})}),(0,j.jsx)(ri,{filterOption:Fe,reviewHasAtLeastOneComment:Ue,setFilterOption:Be,isFetchingReviewItems:Me,review:v,onClickLineItem:function(e){var t,n;y&&(ae&&(null===e||void 0===e||null===(t=e.item)||void 0===t?void 0:t.publicId)!==(null===pe||void 0===pe||null===(n=pe.item)||void 0===n?void 0:n.publicId)&&(de(!0),fe(e)),ae||(nt(),fe(e)))},analyticsTracker:{trackViewCommentsButtonClick:function(){v&&(0,B.Hc)({tier:M,team:A,userId:(null===S||void 0===S?void 0:S.sub)||"",portal:L,review:v})},trackCopyFilenamesClick:function(){v&&(0,B.Le)({tier:M,team:A,userId:(null===S||void 0===S?void 0:S.sub)||"",portal:L,review:v})},trackItemDetailClick:function(){v&&(0,B.ux)({tier:M,team:A,userId:(null===S||void 0===S?void 0:S.sub)||"",portal:L,review:v})}},itemsInView:ze,sortedByActionCount:Ge.hasActivity.length,commentCount:$e,sortedByNoActivityCount:We.hasNoActivity.length,highlightedLineItemId:je}),(0,j.jsx)($.Z,{nodeRef:F,in:K,classNames:{enter:Ht,enterDone:qt,exit:zt,exitActive:Yt},enter:!0,onEnter:function(){return ie(!0)},onEntered:function(){return ie(!1)},onExit:function(){return se(!0)},onExited:function(){ue&&(nt(),de(!1)),se(!1)},timeout:{enter:300,exit:300},unmountOnExit:!0,children:(0,j.jsx)("div",{ref:F,className:Ut,children:(0,j.jsx)(Lt,{title:null===we||void 0===we?void 0:we.title,showEmptyState:!(null!==we&&void 0!==we&&null!==(l=we.comments)&&void 0!==l&&l.length),onClose:nt,emptyStateString:g("report.list.no_comments_to_display"),children:(0,j.jsxs)(j.Fragment,{children:[(null===pe||void 0===pe?void 0:pe.note)&&(0,j.jsx)("p",{className:Wt,children:null===we||void 0===we?void 0:we.note}),(null===pe||void 0===pe?void 0:pe.comments)&&(0,j.jsx)(gt,{isSelectDisabled:!0,comments:rt,renderAnchoredComments:function(e){var t=e.page,n=e.timestamp,i=e.markup;return(0,j.jsx)(Nt,{displayPage:t,displayTime:n,displayMarkup:i,isPdf:st,isVideo:at,isAudio:lt,showIndicator:!1})}})]})})})})]})]}):(0,j.jsx)("div",{className:Gt,children:(0,j.jsx)(J.$,{})})})})}var Ai,ji="ReportOverlay_backdropContainer__YKjPT",ki="ReportOverlay_backdropContainer__backButtonContainer__w4q-v",Di="ReportOverlay_backgroundHeaderSticky__kURm3",Si="ReportOverlay_backdropContainer__Override__V39XX",Zi="ReportOverlay_reportOverlayBackdropEnter__ULmER",Oi="ReportOverlay_reportOverlayBackdropEnterDone__AhSf+",Mi="ReportOverlay_reportOverlayBackdropExit__RjnEo",Pi="ReportOverlay_reportOverlayBackdropExitDone__i2E3F",Li="ReportOverlay_reportOverlayEnter__pcV3w",Vi="ReportOverlay_reportOverlayEnterDone__FKOak",Fi="ReportOverlay_reportOverlayExit__wH3xh",Bi="ReportOverlay_reportOverlayExitDone__ZBFRX",Ui=function(e){var t=e.portalId,n=e.show,i=void 0!==n&&n,o=e.onCloseReportOverlay,a=e.onTransitionEnd,l=e.backdropContainerStyles,c=e.onInviteReviewerClick,u=e.review,v=(0,m.useRef)(null),p=(0,_.TH)().state,f=(0,m.useContext)(X.X).setReportOriginPage;(0,m.useEffect)((function(){window.addEventListener("popstate",(function e(){document.body.style.overflow="auto",window.removeEventListener("popstate",e)}))}),[]),(0,m.useEffect)((function(){if(null!==p&&void 0!==p&&p.viewReport&&null!==p&&void 0!==p&&p.fromPortalPage)return f(Q.Wy.PORTAL);null!==p&&void 0!==p&&p.viewReport&&f(Q.Wy.HOMEPAGE)}));var h=K((function(){o&&!window.location.href.includes("?item=")&&o()})).ref,g=(0,w.Z)().y,I=(0,m.useState)(!1),b=(0,s.Z)(I,2),x=b[0],C=b[1];(0,m.useEffect)((function(){document.body.style.overflow=i?"hidden":"auto"}),[i]);return(0,Y.createPortal)((0,j.jsx)($.Z,{in:i,nodeRef:v,classNames:{enter:Zi,enterDone:Oi,exit:Mi,exitActive:Pi},timeout:{enter:0,exit:200},onExited:function(){document.body.style.overflow="auto",a&&a()},unmountOnExit:!0,children:(0,j.jsxs)("div",{className:d()(ji,l,(0,r.Z)({},Si,x)),ref:v,children:[(0,j.jsx)("div",{className:d()(ki,(0,r.Z)({},Di,g>=100))}),(0,j.jsx)($.Z,{in:i,nodeRef:h,classNames:{appear:Li,appearDone:Vi,exit:Fi,exitActive:Bi},appear:!0,timeout:{enter:0,exit:200},unmountOnExit:!0,children:(0,j.jsx)(Ri,{portalId:t,review:u,containerRef:h,onInviteReviewerClick:c,commentOverlayPanelOpen:function(){return C(!0)},commentOverlayPanelClosed:function(){return C(!1)}})})]})}),document.querySelector("#portal-overlay"))},Wi=n(30168),Gi=n(45984),Hi=n(45726),qi=(0,Gi.Ps)(Ai||(Ai=(0,Wi.Z)(["\n  query PortalQueryByPortalId($portalId: String!) {\n    portal: reviewCollection(id: $portalId) {\n      publicId\n      passwordProtected\n    }\n  }\n"])));var zi=n(11538),Yi=n(3460),$i=n(25065),Ki=n(66893),Xi=n(22327);function Qi(e,t,n){var i=n&&localStorage.getItem("".concat(t,"-").concat(e,"-").concat(n));return i?JSON.parse(i):[]}function Ji(e,t,n){localStorage.removeItem("".concat(t,"-").concat(e,"-").concat(n))}function er(e,t,n,r){var o=Qi(e,t,r),a=(0,m.useState)(o),l=(0,s.Z)(a,2),c=l[0],u=l[1],d=0===c.length,v=c.length!==o.length;return(0,m.useEffect)((function(){n&&n.length>0&&u(n)}),[n]),(0,m.useEffect)((function(){d&&r&&Ji(e,t,r)}),[d]),(0,m.useEffect)((function(){var i=Qi(e,t,r);v&&r&&0===(null===n||void 0===n?void 0:n.length)&&u(i)}),[e,r,null===n||void 0===n?void 0:n.length,v,t]),{selectedItems:c,updateItems:function(e,t){if(e)u([].concat((0,i.Z)(c),[{publicId:t}]));else{var n=c.filter((function(e){return e.publicId!==t}));u(n)}},isSelectedItem:function(e){return c.some((function(t){return t.publicId===e}))},removeItems:Ji}}var tr,nr,ir=n(84916),rr=n(40040),or=n(4766),ar=n(36106),sr=n(52662),lr=n(85885),cr=n(82728),ur=n(87498),dr=n(75159),vr=n(68825),mr=n(68775),pr=n(28854),fr=n(19623),_r=n(16409),hr="AssetUploadButton_squareButton__-yjVf",wr="AssetUploadButton_squareLabel__3IGHv",gr="AssetUploadButton_roundedButton__5lYNS",Ir="AssetUploadButton_disabled__mVQBI",br=function(e){var t=e.type,n=(0,m.useContext)(_r.l).uploadFiles,i=(0,L.T)(),o=i.canUseFreeTier,a=i.canUploadAssets,s=(0,fr.P)().getEntitlementPopover,l=(0,B.Fn)().fireErrorEvent,c=function(e,t){if(t)return(0,D.t6)({message:t.message,type:"error"}),void l("File Validation Error",t.message);n(Array.from(e))},u=!o||a,v=u?(0,j.jsxs)(x.z,{className:gr,as:pr.S,size:"medium",onFilesSelected:c,"data-test-id":"editReview.add_items.label_upload_files",children:[(0,j.jsx)(mr.T,{size:"medium"}),(0,vr.t)("editReview.add_items.add_items")]}):(0,j.jsx)(x.Yz,{as:"a",href:(0,S.Cp)("?trk=portals_upload"),target:"_blank",className:gr,analyticsLocation:"Upload"}),p=(0,j.jsx)(x.LE,{as:pr.S,onFilesSelected:c,appearance:"secondary",size:"small","data-test-id":"editReview.add_more_items",className:d()(hr,(0,r.Z)({},Ir,!u)),disabled:!u,children:(0,j.jsxs)("span",{className:wr,children:[(0,j.jsx)(I.ZC,{size:"small"})," Add"]})}),f=u?p:s({target:(0,j.jsx)("div",{children:p}),type:"storage"});return"Rounded"===t?v:f},xr="AssetUploadHero_promptContainer__liJcg",Cr="AssetUploadHero_completedLoading__F68Kk",Er="AssetUploadHero_buttonContainer__f+GBm",yr="AssetUploadHero_uploadText__qDGFS",Tr="AssetUploadHero_boldText__qob6y",Nr=function(e){var t=e.completedLoading,n=(0,L.T)(),i=n.canUseFreeTier,o=n.canUploadAssets;return(0,j.jsx)("div",{className:d()(xr,(0,r.Z)({},Cr,t)),children:(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{className:d()(yr),children:i&&!o?(0,vr.t)("editReview.add_items.free_up_space"):(0,j.jsx)(p.cC,{i18nKey:"editReview.add_items.drag_and_drop_some_files",components:[(0,j.jsx)("span",{className:Tr})]})}),(0,j.jsx)("div",{className:d()(Er),children:(0,j.jsx)(br,{type:"Rounded"})})]})})},Rr=n(25216),Ar=n(43893),jr=function(e){var t=e.children,n=(0,m.useContext)(X.X),i=n.reviewId,r=n.reviewItems,o=(0,P.T)(),a=(0,Rr.Dy)((0,Rr.VT)(Rr.LO),(0,Rr.VT)(Rr.we,{activationConstraint:{distance:0}}),(0,Rr.VT)(Rr.Lg,{coordinateGetter:Ar.is}));return(0,j.jsx)(Rr.LB,{sensors:a,collisionDetection:Rr.pE,onDragEnd:function(e){var t=e.active,n=e.over;if(t.id&&(null===t||void 0===t?void 0:t.id)!==(null===n||void 0===n?void 0:n.id)){var a=r.findIndex((function(e){return e.publicId===t.id})),s=r.findIndex((function(e){return e.publicId===(null===n||void 0===n?void 0:n.id)}));-1!==a&&-1!==s&&(o((0,At.Ad)({reviewId:i,movedItemIndex:a,targetItemIndex:s,reviewItems:r})),B.Lg.incrementOrderAction())}},children:(0,j.jsx)(Ar.Fo,{items:r.map((function(e){return e.publicId})),strategy:Ar.U2,children:t})})},kr=n(68218),Dr=(0,Gi.Ps)(tr||(tr=(0,Wi.Z)(["\n  mutation GetDownloadReviewMutation($reviewId: String!) {\n    downloadReview(reviewId: $reviewId) {\n      streamingDownloadUrl\n      errors\n    }\n  }\n"])));var Sr,Zr=(0,Gi.Ps)(nr||(nr=(0,Wi.Z)(["\n  mutation GetDownloadReviewItemMutation(\n    $reviewId: String!\n    $reviewItemId: String!\n  ) {\n    downloadReviewItem(reviewId: $reviewId, reviewItemId: $reviewItemId) {\n      streamingDownloadUrl\n      errors\n    }\n  }\n"])));function Or(){var e=(0,Hi.Db)(Zr),t=(0,s.Z)(e,2);return{isFetching:t[0].fetching,getDownloadReviewItemLink:t[1]}}var Mr=(0,Gi.Ps)(Sr||(Sr=(0,Wi.Z)(["\n  query PortalQueryByPortalId($portalId: String!) {\n    portal: reviewCollection(id: $portalId) {\n      publicId\n      teamId\n      passwordProtected\n    }\n  }\n"])));function Pr(e){var t,n=(0,Hi.aM)({query:Mr,variables:{portalId:e},pause:!e}),i=(0,s.Z)(n,1)[0],r=i.data,o=i.fetching;return{portal:null!==(t=null===r||void 0===r?void 0:r.portal)&&void 0!==t?t:null,isFetchingPortal:o}}var Lr=n(7533),Vr=n(28661),Fr=n(74175);var Br=n(391),Ur=n(7597),Wr=n(12237),Gr="AssetDetailsOverlay_dialog__DGkfn",Hr="AssetDetailsOverlay_withOutageBanner__H-6Nw",qr={container:"ActionPositioner_container__YsF7O","top-left":"ActionPositioner_top-left__AdwI-","top-right":"ActionPositioner_top-right__08160","bottom-left":"ActionPositioner_bottom-left__Po-CK","bottom-right":"ActionPositioner_bottom-right__LfCKB"};function zr(e){var t=e.className,n=e.position,i=void 0===n?"top-left":n,r=(e.actioned,e.children),o=d()(t);return(0,j.jsx)("div",{className:d()(qr.container,qr[i],o),children:r})}var Yr=n(76841),$r=function(e,t,n,r,o){var a=!1,s=e.filter((function(e){var i="FAVORITE"===t?e.favoritedItems:e.approvedItems;return null===i||void 0===i?void 0:i.find((function(t){return t.publicId===n&&(e.email!==r||(a=!0,o))}))})).map((function(e){return{email:e.email}}));return o&&r&&!a?[].concat((0,i.Z)(s),[{email:r||""}]):s},Kr="ApproveAction_popOverMenu__4pRNQ",Xr="ApproveAction_container__tleT5",Qr="ApproveAction_boldText__gYxdG",Jr="ApproveAction_buttonIcon__7oD0z",eo="ApproveAction_selected__DxmUR",to="ApproveAction_icon__fnrJH",no="ApproveAction_actionValueAvailable__4OTPW",io="ApproveAction_actionRequestValue__-O26f";function ro(e){e.approvedBy;var t=e.isApproved,n=e.shouldDisplayMetaData,i=e.onUpdateApprove,o=e.publicId,a=e.reviewId,l=e.disabled,c=void 0!==l&&l,u=e.popoverPosition,v=void 0===u?"bottom":u,f=e.className,h=(0,p.$G)().t,w=(0,_.TH)(),g=(0,m.useContext)(te._f),b=g.isUnidentifiedUser,C=g.savingActionError,E=g.currentAssetBeingActionedUpon,y=(0,m.useContext)(It),T=y.teamMembers,N=y.user,R=(0,m.useState)(!1),A=(0,s.Z)(R,2),k=A[0],D=A[1],S=(0,m.useState)(!1),Z=(0,s.Z)(S,2),M=Z[0],P=Z[1],L=(0,m.useState)(t),V=(0,s.Z)(L,2),F=V[0],B=V[1];(0,Yr.Z)()((function(){return D(!1)}));var U=(0,zi.B)(a),W=U.notCompletedAssignedActionRequests,G=U.refreshReviewActionRequests,H=U.actionRequests;(0,m.useEffect)((function(){G()}),[]),(0,m.useEffect)((function(){B(t)}),[t]),(0,m.useEffect)((function(){C&&E.assetItemId===o&&B((function(e){return!e}))}),[E.assetItemId,o,C]),(0,m.useEffect)((function(){D(!1)}),[w]);var q=(0,m.useMemo)((function(){return $r(H,"APPROVE",o,null===N||void 0===N?void 0:N.email,F)}),[H,F,o,null===N||void 0===N?void 0:N.email]),z=q&&q.length>0,Y=function(){D(!1),b||B((function(e){return!e})),i&&i(!t,o)},$=function(){P(!0),D(!0)},K=function(){P(!1),D(!1)},X=(0,m.forwardRef)((function(e,n){var i;return(0,j.jsxs)(x.hU,{ref:n,className:d()(Jr,f,(i={},(0,r.Z)(i,eo,F),(0,r.Z)(i,no,z),i)),onMouseEnter:$,onMouseLeave:K,onTouchStart:null,onClick:Y,size:"regular",appearance:F?"none":"overlay",disabled:c,"data-test-id":"approveAction.button",children:[t?M?(0,j.jsx)(I.EC,{size:"small",className:to}):(0,j.jsx)(I.Th,{size:"small"}):M?(0,j.jsx)(I.Th,{size:"small"}):(0,j.jsx)(I.EC,{size:"small"}),z&&(0,j.jsx)("p",{className:io,children:q.length})]})})),Q=n?function(){return(0,j.jsx)(ie.J,{positions:[v],arrowColor:"#333333","data-test-id":"approveAction.popover",isShowing:k,target:(0,j.jsx)(X,{}),parentElement:document.getElementById("action_parent")||void 0,containerClassName:Xr,children:(0,j.jsxs)("div",{className:Kr,"data-test-id":"approveAction.approvedBy",children:[(!q||q&&0===q.length)&&(0,j.jsx)("p",{"data-test-id":"favoriteAction.notApproved",children:h("review.no_approvals")}),q&&q.length>0&&(0,j.jsx)("p",{"data-test-id":"approveAction.approve",children:(0,j.jsx)(p.cC,{i18nKey:q&&1===q.length?"review.approved_by_single":"review.approved_by_multiple",components:[(0,j.jsx)("span",{className:Qr,children:", "})],values:(0,O.RM)({actionRequests:q,teamMembers:T,user:N})})}),W&&W.length>0&&(0,j.jsx)("p",{"data-test-id":"approveAction.waitingFor",children:(0,j.jsx)(p.cC,{i18nKey:1===W.length?"review.waiting_for_single":"review.waiting_for_multiple",components:[(0,j.jsx)("span",{className:Qr,children:", "})],values:{count:W.length}})})]})})}:X;return(0,j.jsx)(Q,{})}var oo={container:"AssetPreviewActions_container__wWE4-",showOnHover:"AssetPreviewActions_showOnHover__wCs2j",actions:"AssetPreviewActions_actions__x72Os"},ao="CommentsMiniOverviewAction_buttonContainer__Gp605",so="CommentsMiniOverviewAction_commentCount__MwkK7",lo=function(e){var t=e.reviewId,n=e.reviewItemId,i=e.numberOfComments,r=(0,m.useState)(!1),o=(0,s.Z)(r,2),a=o[0],l=o[1];return(0,j.jsxs)(x.hU,{className:ao,onMouseEnter:function(){l(!0)},onMouseLeave:function(){l(!1)},size:"regular",appearance:"overlay",as:h.rU,to:{pathname:(0,Ki.o)({reviewId:t}),search:"item=".concat(n)},children:[a?(0,j.jsx)(I.I3,{size:"small"}):(0,j.jsx)(I.cV,{size:"small"}),(0,j.jsx)("span",{"data-test-id":"".concat(n,".commentsMiniOverviewAction.commentCount"),className:so,children:i})]})},co="FavoriteAction_popOverMenu__rHYu2",uo="FavoriteAction_container__6Vu4Q",vo="FavoriteAction_boldText__q+gQI",mo="FavoriteAction_buttonIcon__Rnnpm",po="FavoriteAction_selected__2y8FE",fo="FavoriteAction_icon__JXTBI",_o="FavoriteAction_actionValueAvailable__Jx6KS",ho="FavoriteAction_actionRequestValue__+FASz";function wo(e){e.favoritedBy;var t=e.shouldDisplayMetaData,n=e.isFavorited,i=e.onUpdateFavorite,o=e.publicId,a=e.reviewId,l=e.disabled,c=void 0!==l&&l,u=e.popoverPosition,v=void 0===u?"bottom":u,f=(0,p.$G)().t,h=(0,_.TH)(),w=(0,m.useContext)(te._f),g=w.isUnidentifiedUser,b=w.savingActionError,C=w.currentAssetBeingActionedUpon,E=(0,m.useContext)(It),y=E.teamMembers,T=E.user,N=(0,Yr.Z)(),R=(0,m.useState)(!1),A=(0,s.Z)(R,2),k=A[0],D=A[1],S=(0,m.useState)(!1),Z=(0,s.Z)(S,2),M=Z[0],P=Z[1],L=(0,m.useState)(n),V=(0,s.Z)(L,2),F=V[0],B=V[1];N((function(){return D(!1)}));var U=(0,zi.B)(a),W=U.notCompletedAssignedActionRequests,G=U.refreshReviewActionRequests,H=U.actionRequests;(0,m.useEffect)((function(){G()}),[]),(0,m.useEffect)((function(){B(n)}),[n]),(0,m.useEffect)((function(){b&&C.assetItemId===o&&B((function(e){return!e}))}),[C.assetItemId,o,b]),(0,m.useEffect)((function(){D(!1)}),[h]);var q=(0,m.useMemo)((function(){return $r(H,"FAVORITE",o,null===T||void 0===T?void 0:T.email,F)}),[H,F,o,null===T||void 0===T?void 0:T.email]),z=q&&q.length>0,Y=function(){D(!1),g||B((function(e){return!e})),i&&i(!n,o)},$=function(){P(!0),D(!0)},K=function(){P(!1),D(!1)},X=(0,m.forwardRef)((function(e,i){var o;return(0,j.jsxs)(x.hU,{ref:i,className:d()(mo,(o={},(0,r.Z)(o,po,F),(0,r.Z)(o,_o,z),o)),onMouseEnter:t?$:null,onMouseLeave:t?K:null,onTouchStart:null,onClick:Y,size:"regular",appearance:F?"none":"overlay",disabled:c,"data-test-id":"favoriteAction.popover.button",as:"div",children:[n?(0,j.jsx)(I.Rh,{size:"small",className:fo}):M?(0,j.jsx)(I.Rh,{size:"small"}):(0,j.jsx)(I.OE,{size:"small"}),z&&(0,j.jsx)("p",{className:ho,children:q.length})]})})),Q=t?function(){return(0,j.jsx)(ie.J,{"data-test-id":"favoriteAction.popover",positions:[v],arrowColor:"#333333",isShowing:k,target:(0,j.jsx)(X,{}),parentElement:document.getElementById("action_parent")||void 0,containerClassName:uo,children:(0,j.jsxs)("div",{className:co,"data-test-id":"favoriteAction.favoritedBy",children:[(!q||q&&0===q.length)&&(0,j.jsx)("p",{"data-test-id":"favoriteAction.noStars",children:f("review.no_stars")}),q&&q.length>0&&(0,j.jsx)("p",{"data-test-id":"favoriteAction.favorite",children:(0,j.jsx)(p.cC,{i18nKey:1===q.length?"review.starred_by_single":"review.starred_by_multiple",components:[(0,j.jsx)("span",{className:vo,children:", "})],values:(0,O.RM)({actionRequests:q,teamMembers:y,user:T})})}),W&&W.length>0&&(0,j.jsx)("p",{"data-test-id":"favoriteAction.waitingFor",children:(0,j.jsx)(p.cC,{i18nKey:1===W.length?"review.waiting_for_single":"review.waiting_for_multiple",components:[(0,j.jsx)("span",{className:vo,children:", "})],values:{count:W.length}})})]})})}:X;return(0,j.jsx)(Q,{})}function go(e){var t=e.reviewId,n=e.reviewItemId;return(0,j.jsx)(x.hU,{size:"regular",appearance:"overlay",as:h.rU,to:{pathname:(0,Ki.o)({reviewId:t}),search:"item=".concat(n)},"data-test-id":"".concat(n,".reviewItem.expand"),children:(0,j.jsx)(I.M0,{})})}function Io(e){var t=e.publicId,n=e.name,i=e.onUpdateAction,r=e.onDeleteItem,o=void 0===r?function(){}:r,a=e.isFavorited,s=(e.isActionRequestSubmitted,e.isApproved),l=(e.isGuest,e.approvedBy),c=e.favoritedBy,u=(e.isOwnerView,e.children),v=e.className,m=e.itemType,p=e.reviewId,f=(e.portalId,e.isUploading),_=e.isProcessingComplete,h=e.isEditView,w=e.canApprove,g=e.canFavorite,b=e.hasPublished,C=e.fileType,E=e.numberOfComments,y=e.commentsEnabled,T=e.isActionConfirmedUponAsset,N="FILE"===m&&h&&!f,R="LINK"===m,A="LINK"===m&&h&&!f,k=b;return(0,j.jsxs)("div",{className:d()(v,oo.container),children:[u,_&&t&&(0,j.jsxs)(j.Fragment,{children:[w&&(0,j.jsx)(zr,{position:"top-left",actioned:T||s,children:(0,j.jsx)(ro,{shouldDisplayMetaData:k,onUpdateApprove:function(){i&&i("APPROVE",!s,t,n,C)},isApproved:s,approvedBy:l,publicId:t,reviewId:p,disabled:h})}),g&&(0,j.jsx)(zr,{position:"top-left",actioned:T||a,children:(0,j.jsx)(wo,{shouldDisplayMetaData:k,isFavorited:a,favoritedBy:c,onUpdateFavorite:function(){i&&i("FAVORITE",!a,t,n,C)},publicId:t,reviewId:p,disabled:h})}),R&&(0,j.jsxs)(zr,{className:oo.cornerOnHover,position:"top-right",children:[(0,j.jsx)(go,{reviewId:p,reviewItemId:t}),A&&(0,j.jsx)(x.hU,{as:I.rF,onClick:o,appearance:"overlay",size:"regular","data-test-id":"".concat(n,"-reviewItem.delete")}),(y&&!h||!y&&!h&&0!==E)&&(0,j.jsx)(lo,{reviewId:p,reviewItemId:t,numberOfComments:E})]})]}),N&&(0,j.jsx)(zr,{className:oo.showOnHover,position:"top-right",children:(0,j.jsx)(x.hU,{as:I.rF,onClick:o,appearance:"overlay",size:"regular","data-test-id":"".concat(n,"-reviewItem.delete")})}),(y&&!h&&!R||!y&&!h&&0!==E)&&(0,j.jsx)(zr,{position:"top-right",actioned:T||a||s,children:(0,j.jsx)(lo,{reviewId:p,reviewItemId:t,numberOfComments:E})})]})}var bo=n(93382),xo=n(20405),Co="LockButton_lockBadge__bDf9e",Eo="LockButton_iconedLink__QqH4X",yo=["onClick","size","dataTestId","children","className"],To=(0,m.forwardRef)((function(e,t){var n=e.onClick,i=(e.size,e.dataTestId,e.children),r=e.className,o=((0,_e.Z)(e,yo),(0,m.useState)(!1)),a=(0,s.Z)(o,2),l=a[0],c=a[1];return(0,j.jsx)("div",{onMouseEnter:function(){c(!0)},onMouseLeave:function(){c(!1)},children:(0,j.jsxs)(x.CE,{className:Eo,as:"button","data-test-id":"review.download_button",appearance:"inverted",onClick:n,ref:t,children:[(0,j.jsx)("span",{className:d()(Co,r),children:(0,j.jsx)(xo._,{size:"small",isHovered:l})}),i]})})}));var No="DownloadAction_popoverMenu__teeGM",Ro="DownloadAction_size__Tm8cp",Ao="DownloadAction_iconedText__3CMdI",jo="DownloadAction_disabled__ZwTuq",ko="DownloadAction_text__hLCm4",Do="DownloadAction_hidden__U0xpM",So="DownloadAction_icon__QuWNm",Zo="DownloadAction_button__CiEAZ",Oo="DownloadAction_spinnerContainer__dNv3I",Mo="DownloadAction_spinnerIcon__T372D";function Po(e){var t=e.portalId,n=e.fileSize,i=e.fileName,a=e.fileType,l=e.canDownload,u=(0,p.$G)().t,v=(0,B.Fn)(),h=v.fireEvent,w=v.fireErrorEvent,g=v.fireGroupIdentifyAdd,b=(0,V.G)().isMinTablet,C=(0,m.useState)(null),E=(0,s.Z)(C,2),y=E[0],T=E[1],N=(0,_.UO)().reviewId,R=(0,m.useState)(!1),A=(0,s.Z)(R,2),k=A[0],S=A[1],Z=(0,m.useState)(!1),O=(0,s.Z)(Z,2),M=O[0],P=O[1],F=(0,m.useState)(!1),U=(0,s.Z)(F,2),W=U[0],G=U[1],H=(0,m.useState)(!1),q=(0,s.Z)(H,2),Y=q[0],$=q[1],K=Or().getDownloadReviewItemLink,X=(0,_.TH)(),Q=(0,L.T)(),ee=Q.canUseFreeTier,te=Q.restrictionStatus,ne=(0,fr.P)().getEntitlementPopover,re=ee&&"OVER_LIMIT"===te,oe=(0,f.v9)(sr.BX),ae=(0,f.v9)(lr.HF),se=(0,f.v9)(kt.v9),le=(0,Rt.B)({portalId:t,reviewId:N}),ce=le.guestTokenId,ue=le.guestEmail,de=le.isFetchingGuestToken,ve=(0,z.g)({portalId:t,guestTokenId:ce}).portal,me=(0,Lr.$)({reviewId:N,guestTokenId:ce}).review,pe=(0,ir.c)({guestEmail:ue,actionRequests:null!==me&&void 0!==me&&me.actionRequest?[me.actionRequest]:[],owningTeam:null===me||void 0===me?void 0:me.teamId,isFetchingGuestToken:de}).identity,fe="OWNER"===pe,_e=(0,m.useMemo)((function(){return function(e){if(0===e)return"";var t=Math.floor(Math.log(e)/Math.log(1024)),n=e/Math.pow(1024,t),i=0===t?0:2,r=0===t?"bytes":"".concat(" KMGTP".charAt(t),"B");return"".concat(n.toFixed(i)," ").concat(r)}(n||0)}),[n]);function he(){return(he=(0,o.Z)(c().mark((function e(){var t,n,o,s,l,d,v,m,p,f;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=4;break}return(0,D.t6)({message:u("error.file_download_error"),type:"error"}),w("error.file_download_error"),e.abrupt("return");case 4:return G(!0),e.next=7,K({reviewId:N,reviewItemId:y});case 7:l=e.sent,G(!1),l.error||null!==(t=l.data)&&void 0!==t&&null!==(n=t.downloadReviewItem)&&void 0!==n&&n.errors&&(null===(o=l.data)||void 0===o||null===(s=o.downloadReviewItem)||void 0===s?void 0:s.errors.length)>0?(d=fe?"error.file_download_error":"error.file_download_error_guest",(0,D.t6)({message:u(d),type:"error"}),w("error.file_download_error"),$(!0)):(me&&i&&(g({groupType:B.YT.REVIEW,groupName:null===me||void 0===me?void 0:me.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_DOWNLOADS,1)}),(0,B.Xt)({review:me,portal:ve,team:oe,userId:(null===ae||void 0===ae?void 0:ae.sub)||"",userIdentity:pe,guestTokenId:ce,tier:se,itemId:y,fileName:i})),h({eventName:B.B_.FILE_DOWNLOADED,optionalEventProperties:(v={},(0,r.Z)(v,B.r8.TYPE,"single"),(0,r.Z)(v,B.r8.LOCATION,B.sR.ITEM),(0,r.Z)(v,B.r8.ITEM_TYPE,a),v),groups:(0,r.Z)({},B.YT.REVIEW,N)}),g({groupType:B.YT.REVIEW,groupName:N,propertyValues:(0,r.Z)({},B.vb.NUM_ACTIONS,1)}),(f=null===(m=l.data)||void 0===m||null===(p=m.downloadReviewItem)||void 0===p?void 0:p.streamingDownloadUrl)&&(window.location.href=f));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}if((0,m.useEffect)((function(){var e=new URLSearchParams(X.search);T(e.get("item"))}),[X.search]),!l)return null;var we=W?function(){return(0,j.jsx)("div",{className:Oo,children:(0,j.jsx)(J.$,{className:Mo,color:bo.in})})}:I.ZZ,ge=(0,j.jsxs)(x.hU,{onClick:function(){return he.apply(this,arguments)},appearance:"inverted",size:"regular",className:Zo,children:[(0,j.jsx)(I.ZZ,{className:So}),(0,j.jsx)("div",{className:d()(Ao,(0,r.Z)({},jo,re||Y)),children:(0,j.jsx)(Re.k,{icon:we,space:"small",size:"regular",children:(0,j.jsx)("span",{className:d()(ko,(0,r.Z)({},Do,re)),children:(0,j.jsx)(p.cC,{i18nKey:"reviewItem.download_size",components:[(0,j.jsx)("span",{className:Ro,children:", "})],values:{size:_e}})})})})]}),Ie=re&&!fe?(0,j.jsx)(ie.J,{arrowColor:"#333333",isShowing:M,setIsShowing:P,positions:["bottom"],target:ge,children:(0,j.jsx)("div",{className:No,children:u("review.guest_overlimit_download")})}):ge;return re&&fe?(0,j.jsxs)(j.Fragment,{children:[ne({target:(0,j.jsx)(To,{children:b&&u("reviewItem.download")}),type:"review",position:["bottom"]}),k&&(0,j.jsx)(Vr.n,{onDismiss:function(){return S(!1)},title:null===me||void 0===me?void 0:me.title,reviewId:N,portalId:t,forceNavigation:!0})]}):Ie}var Lo="AssetDetailsOverlayHeader_assetDetailsOverlayHeaderContainer__8ENwR",Vo="AssetDetailsOverlayHeader_additionalOptionsGroup__CzwH1",Fo="AssetDetailsOverlayHeader_additionalOptionsGroupItem__zfNi5",Bo="AssetDetailsOverlayHeader_fileNameContainer__fHDXX",Uo="AssetDetailsOverlayHeader_fileName__EP7D-",Wo="AssetDetailsOverlayHeader_download__Gzl3b",Go="AssetDetailsOverlayHeader_action__mKjGc",Ho=function(e){var t=e.portalId,n=e.filename,i=e.filesize,r=e.canDownload,o=e.itemType,a=(e.isGuest,e.canFavorite),s=e.shouldDisplayMetaData,l=e.isFavorited,c=e.favoritedBy,u=e.publicId,d=e.canApprove,v=e.onAction,m=e.isApproved,p=e.approvedBy,f=e.reviewId,_=e.fileType,h=e.onClose,w=e.hasPublished;return(0,j.jsxs)("div",{className:Lo,children:[(0,j.jsxs)("div",{className:Vo,children:[a&&(0,j.jsx)("div",{className:Fo,children:(0,j.jsx)(wo,{shouldDisplayMetaData:s,isFavorited:l,favoritedBy:c,onUpdateFavorite:function(){v&&w&&v("FAVORITE",!l,u,n||"",_)},publicId:u,popoverPosition:"bottom",reviewId:f,disabled:!w})}),d&&(0,j.jsx)("div",{className:Fo,children:(0,j.jsx)(ro,{shouldDisplayMetaData:s,onUpdateApprove:function(){v&&w&&v("APPROVE",!m,u,n||"",_)},isApproved:m,approvedBy:p,publicId:u,reviewId:f,popoverPosition:"bottom",disabled:!w,className:Go})}),(0,j.jsx)("div",{className:Fo,children:(0,j.jsxs)("div",{className:Bo,children:[(0,j.jsx)("p",{className:Uo,title:n||"",children:n}),"FILE"===o&&(0,j.jsx)("div",{className:Wo,children:(0,j.jsx)(Po,{portalId:t,fileSize:i,fileName:n,fileType:_,canDownload:!!r})})]})})]}),(0,j.jsx)(x.hU,{type:"button",onClick:h,"data-test-id":"lightboxClose.button",appearance:"inverted",children:(0,j.jsx)(I.x8,{size:"large"})})]})},qo=n(52949),zo=["onCancel","onConfirm"];function Yo(e){var t=e.onCancel,n=e.onConfirm,i=((0,_e.Z)(e,zo),(0,p.$G)().t);return(0,j.jsx)(qo.s,{ariaLabel:i("comments.discard_edits_confirm.title"),title:i("comments.discard_edits_confirm.title"),body:i("comments.discard_edits_confirm.body"),confirmText:i("comments.discard_edits_confirm.confirm"),cancelText:i("comments.discard_edits_confirm.cancel"),onConfirm:n,onCancel:t})}var $o=n(3764),Ko=n(54261),Xo=function(e){var t=(0,m.useRef)(null);return(0,m.useEffect)((function(){e.forEach((function(e){e&&("function"===typeof e?e(t.current):e.current=t.current)}))}),[e]),t},Qo="CommentsInputGroup_commentInputGroup__GoClj",Jo={commentsPlaceholderInputContainer__input:"CommentsPlaceholderInput_commentsPlaceholderInputContainer__input__nbl2l"},ea=function(e){var t=e.onFocus,n=e.placeholderText,i=(0,m.useRef)(null);return(0,j.jsx)("div",{className:Jo.commentsPlaceholderInputContainer,children:(0,j.jsx)("input",{"data-test-id":"commentsPlaceholderInput",className:Jo.commentsPlaceholderInputContainer__input,placeholder:n,onFocus:function(){var e;null===i||void 0===i||null===(e=i.current)||void 0===e||e.blur(),t&&t()},ref:i})})},ta=function(e){var t=e.autofocusComments,n=e.onCommentsInputFocus,i=e.onCommentsInputCancel,r=e.isUnknownGuest,o=e.itemId,a=e.onAddCommentClickHandler,l=e.actionSuccessful,c=e.onInputChange,u=e.temporaryComments,d=e.onSetCommentAutofocus,v=e.onOpenIdentificationModal,f=e.addMarkupEnabled,_=e.containerMeasurements,h=(0,m.useContext)(te._f),w=h.clearCurrentMarkup,g=h.currentPDFPage,I=h.currentVideoTime,b=(0,p.$G)().t,x=(0,m.useState)(!1),C=(0,s.Z)(x,2),E=C[0],y=C[1],T=(0,m.useState)(""),N=(0,s.Z)(T,2),R=N[0],A=N[1],k=(0,m.useRef)(""),D=b("comments.comments_placeholder_input");(0,m.useEffect)((function(){l||(y(!0),A(k.current))}),[l]),(0,m.useEffect)((function(){return function(){y(!1),A("")}}),[]),(0,m.useEffect)((function(){var e=u.find((function(e){return e.itemId===o}));e&&""!==e.text?(y(!0),n(),A(Ye(e.text))):(A(""),i(),y(!1))}),[o]),(0,m.useEffect)((function(){!r&&t&&(y(!0),d&&d(!1))}),[t,r,d,y]);return(0,j.jsxs)("div",{className:Qo,children:[!E&&(0,j.jsx)(ea,{onFocus:function(){if(r)return v&&v(),void(d&&d(!0));y(!0),n()},placeholderText:D}),E&&(0,j.jsx)(ze,{onCancelClick:function(){y(!1),i(),A(""),w(o)},onAddClick:function(){y(!1),i(),k.current=R,A(""),a({itemId:o,text:Ye(R)})},onFocus:n,placeholderText:D,onChange:function(e){A(e),c(e)},value:R,showMarkupToolbar:f,itemId:o,containerMeasurements:_,currentTime:I,currentPage:g})]})},na="ContentWithCommentsSidebar_contentWithCommentsOuterContainer__02YSP",ia="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__jYIk6",ra="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__commentsContainer__+qimN",oa="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__note__wO4Hi",aa="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__commentsGroup__ybPsF",sa="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__commentInput__KHCH6",la="ContentWithCommentsSidebar_navigationOnly__lZx3+",ca="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__inputInnerContainer__38a5a",ua="ContentWithCommentsSidebar_editingOverlay__s5tli",da="ContentWithCommentsSidebar_commentGroupEditingOverlay__Er5L1",va="ContentWithCommentsSidebar_commentInputEditingOverlay__c0tml",ma="ContentWithCommentsSidebar_editingComment__WY+Fs",pa="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__commentsNotification__rOVXU",fa="ContentWithCommentsSidebar_contentWithCommentsSidebarContainer__commentsContainer_wrapped__j81rA",_a="ContentWithCommentsSidebar_contentWithCommentsSidebarContainerWithSidebar__5aSss",ha=n(25215),wa="NotesInput_notesInput__textArea__Zb8w-",ga=function(e){var t,n=e.onChange,i=e.onBlur,r=e.defaultValue,o=void 0===r?"":r,a=e.disableInput,l=void 0===a||a,c=e.className,u=e.focusInput,v=void 0!==u&&u,f=e.onFocus,_=e.itemId,h=(0,m.useState)(o),w=(0,s.Z)(h,2),g=w[0],I=w[1],b=(0,m.useRef)(null),x=(0,ha.Z)(),C=(0,p.$G)().t;function E(){var e;b.current.style.minHeight="1.125rem",null!==(e=b.current)&&void 0!==e&&e.scrollHeight&&(b.current.style.minHeight="".concat(b.current.scrollHeight,"px"))}(0,m.useEffect)((function(){E()}),[null===(t=b.current)||void 0===t?void 0:t.scrollHeight,g]),x((function(){E()})),(0,m.useEffect)((function(){I(o)}),[o,_]);var y=d()(wa,c);return(0,j.jsx)("textarea",{autoFocus:v,"data-test-id":"notesInput--input",disabled:l,ref:b,placeholder:C("editReview.add_note"),className:y,onInput:function(e){b.current.style.minHeight="inherit",I(e.target.value),n(e.target.value),b.current.style.minHeight="".concat(e.target.scrollHeight,"px")},onKeyDown:function(e){"Enter"===e.key&&e.shiftKey||"Enter"!==e.key&&"Escape"!==e.key||e.currentTarget.blur()},value:g,onBlur:i,onFocus:f,maxLength:1e3,rows:1})},Ia=function(e){var t,n,l=e.autofocusComments,u=e.children,v=e.viewerIdentity,_=e.note,h=e.comments,w=e.commentsTotalCount,I=e.reviewItemPublicIdCommentsBelongTo,b=e.commentsEnabled,x=e.reviewId,C=e.portalId,E=e.itemId,y=void 0===E?"":E,T=e.focusNoteInputField,N=e.reviewTitle,R=e.commentIdToScrollTo,A=e.navState,k=e.anchorValue,S=e.seekToValue,Z=e.pauseMedia,M=e.review,L=e.portal,F=e.onNotesInputFocus,U=e.onNotesInputBlur,W=e.onCommentsInputFocus,G=e.onCommentsInputCancel,H=e.onCommentEvent,q=e.onSetCommentAutofocus,z=e.onOpenIdentificationModal,Y=e.showSidebarToViewer,$=e.showNotesToViewer,K=e.onContentWrap,Q=e.renderAnchoredComments,J=e.onCommentAddClick,ee=e.onCommentEditFocus,ne=e.onCommentEditBlur,ie=e.addMarkupEnabled,re=e.navigationBar,oe=(0,p.$G)().t,ae=(0,B.Fn)(),se=ae.fireErrorEvent,le=ae.fireGroupIdentifySet,ce=(0,$o.q_)((function(){return{toScroll:0}})),ue=(0,s.Z)(ce,2)[1],de=(0,V.G)().isMinDesktop,ve=(0,m.useState)(""),me=(0,s.Z)(ve,2),pe=me[0],fe=me[1],_e=(0,f.v9)(lr.HF),he=(0,Rt.B)({portalId:C,reviewId:x}),we=(0,m.useContext)(It).teamMembers,ge=(null===_e||void 0===_e?void 0:_e.email)||he.guestEmail,Ie=(0,O.Z3)(ge,we),be=(0,P.T)(),xe=(0,m.useRef)(null),Ce=(0,m.useRef)(null),Ee=(0,m.useRef)(null),ye=(0,g.Z)(),Te=(0,s.Z)(ye,2),Ne=Te[0],Re=Te[1].height,Ae=(0,g.Z)(),je=(0,s.Z)(Ae,2),ke=je[0],De=je[1].height,Se=(0,g.Z)(),Ze=(0,s.Z)(Se,2),Oe=Ze[0],Pe=Ze[1].height,Le=(0,g.Z)(),Ve=(0,s.Z)(Le,2),Fe=Ve[0],Be=Ve[1].height,Ue=Xo([Ce,Fe]),We=Xo([Ee,ke]),Ge=(0,m.useState)(!1),He=(0,s.Z)(Ge,2),qe=He[0],ze=He[1],Ye=(0,m.useState)(_),$e=(0,s.Z)(Ye,2),Ke=$e[0],Xe=$e[1],Qe=(0,m.useState)(!1),Je=(0,s.Z)(Qe,2),et=Je[0],tt=Je[1],nt=(0,m.useState)([]),it=(0,s.Z)(nt,2),rt=it[0],ot=it[1],at=(0,te.ze)(),st=at.currentMarkup,lt=at.editingCommentId,ct=at.isAnchorCheckboxChecked,ut=at.lightboxHeight,dt=!!st[y],vt=(0,m.useMemo)(ln.q,[]),mt=(0,f.v9)((function(e){return vt(e,x)})),pt=(0,m.useContext)(X.X).reviewItems,ft=(0,zi.B)(x).actionRequests,_t=(0,f.v9)(sr.BX),ht=(0,f.v9)(lr.HF),wt=(0,f.v9)(kt.v9),bt="OWNER"===v&&A&&A.isEditing,xt="UNKNOWN_GUEST"===v;(0,m.useEffect)((function(){ot([])}),[y]);var Ct=function(){var e=(0,o.Z)(c().mark((function e(t,n){var i,o,s,l,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_!==n){e.next=2;break}return e.abrupt("return");case 2:return U(),o=[{publicId:t,note:n}],e.next=6,be((0,At.z$)({reviewId:x,attributes:o}));case 6:if(!e.sent.error){e.next=11;break}return(0,D.t6)({message:oe("error.not_found.image_alt"),type:"error"}),se("error.not_found.image_alt"),e.abrupt("return");case 11:if(M&&_t){e.next=13;break}return e.abrupt("return");case 13:s=0,l=function(e){return e&&e.length>0},u=pt.map((function(e){return e.publicId===t?(l(n)&&s++,(0,a.Z)((0,a.Z)({},e),{},{note:n})):(l(e.note)&&s++,e)})),le({groupType:Br.YT.REVIEW,groupName:x,propertyValues:(0,r.Z)({},Br.vb.NUM_NOTES,s)}),d=null!==(i=ft.filter((function(e){return"ASSIGNED"===e.engagementType})).length)&&void 0!==i?i:0,(0,B.gk)({review:M,reviewItems:u,numberOfAssignedReviewers:d,portal:L,team:_t,userId:(null===ht||void 0===ht?void 0:ht.sub)||"",comments:mt,tier:wt});case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Et=function(){ot((function(e){return e.filter((function(e){return e.itemId!==y}))}))},yt=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return i={commentId:t,comments:h,commentsTotalCount:w,reviewId:x,reviewItemId:y},_e||(i.token=he.guestTokenId),e.next=6,be((0,At.YF)(i));case 6:r=e.sent,null!==(n=r.data)&&void 0!==n&&n.deleteComment.errors.length?(o=oe("comments.delete_comment_failure"),(0,D.t6)({autoClose:5e3,className:pa,message:o,type:"error"}),se("comments.delete_comment_failure")):(a=oe("comments.delete_comment_success"),(0,D.t6)({autoClose:3e3,className:pa,message:a,type:"default"}),H("DELETE",t));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Tt=function(){var e=(0,o.Z)(c().mark((function e(t,n){var i,r,o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={commentId:t,body:n,comments:h,commentsTotalCount:w,reviewId:x,reviewItemId:y},_e||(r.token=he.guestTokenId),e.next=4,be((0,At.DF)(r));case 4:o=e.sent,null!==(i=o.data)&&void 0!==i&&i.updateComment.errors.length?(a=oe("comments.update_comment_failure"),(0,D.t6)({autoClose:5e3,className:pa,message:a,type:"error"}),se("comments.update_comment_failure")):H("EDIT",t);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Nt=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r,o,s,l,u,d,v,m,p,f,_;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.itemId,(r=t.text)||dt){e.next=3;break}return e.abrupt("return");case 3:return null===J||void 0===J||J(),tt(!0),o={},(ct||dt)&&(s=k(),l=s.location,u=st[i]&&"number"===typeof st[i][0].atTimestamp?st[i][0].atTimestamp:l.timestamp,o=(0,a.Z)((0,a.Z)({anchorableType:"COMMENT"},o),{},{anchor:{page:l.page,timestamp:u,markup:st[i]||null}})),d=(0,Ko.Z)(),v={comments:h,commentsTotalCount:w,reviewItemPublicIdCommentsBelongTo:I,itemId:i,reviewId:x,author:(null===_e||void 0===_e?void 0:_e.name)||he.guestEmail,comment:(0,a.Z)({publicId:d,body:r,commentableId:i,commentableType:"REVIEW_ITEM"},o)},_e||(v.token=he.guestTokenId),fe(d),e.next=13,be((0,At.fg)(v));case 13:if(m=e.sent,null!==(n=m.data)&&void 0!==n&&n.createComment.errors.length){e.next=21;break}Et(),H("ADD"),fe(""),null===(p=xe.current)||void 0===p||p.scrollIntoView({behavior:"smooth",block:"end"}),e.next=31;break;case 21:_="",e.t0=null===(f=m.data)||void 0===f?void 0:f.createComment.errors[0],e.next="GUEST_IS_NOT_A_REVIEWER"===e.t0?25:27;break;case 25:return N?(_=oe("portal.comments.commenting_privileges_revoked_with_review_title",{reviewTitle:N}),se("portal.comments.commenting_privileges_revoked_with_review_title")):(_=oe("portal.comments.commenting_privileges_revoked_no_title"),se("portal.comments.commenting_privileges_revoked_no_title")),e.abrupt("break",29);case 27:_=oe("error.not_found.image_alt"),se("error.not_found.image_alt");case 29:(0,D.t6)({autoClose:5e3,className:pa,message:_,type:"error"}),tt(!1);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,m.useEffect)((function(){if(Y){if(!de)return void K(!0);K(!1)}}),[Y,de,K]);var jt=d()(ia,(0,r.Z)({},_a,Y)),Dt=d()(ra,(0,r.Z)({},fa,!de)),St=d()(ua,(0,r.Z)({},da,lt)),Zt=d()(ua,(0,r.Z)({},va,lt)),Ot={width:xe.current?null===(t=xe.current)||void 0===t?void 0:t.getBoundingClientRect().width:0,height:xe.current?null===(n=xe.current)||void 0===n?void 0:n.getBoundingClientRect().height:0},Mt=d()(aa,(0,r.Z)({},ma,lt)),Pt=d()(na,(0,r.Z)({},ma,lt)),Lt=de?Ee:Ce;(0,m.useEffect)((function(){if(Lt.current&&""!==pe){var e=document.getElementById("comment-".concat(pe));if(e){var t=e.getBoundingClientRect();if(!Me(t,de)){var n=Lt.current.scrollTop+t.top;ue.start({delay:350,toScroll:n,reset:!0,from:{toScroll:Lt.current.scrollTop},onChange:function(e){Lt.current&&Lt.current.scroll({left:0,top:e.value.toScroll-8})}})}}}}),[de,Lt,ue,pe]),(0,m.useEffect)((function(){R&&fe(R)}),[R]);var Vt=(0,m.useMemo)((function(){return de?{overflow:"hidden"}:{height:"calc(100% - ".concat(Re,"px)")}}),[Re,de]),Ft=(0,m.useMemo)((function(){return Math.max(De+ut+Pe,Be)}),[ut,De,Pe,Be]),Bt=(0,m.useMemo)((function(){return de?{}:{height:"".concat(Ft,"px")}}),[Ft,de]),Ut=(0,m.useMemo)((function(){return{containerHeight:Ft,inputContainerHeight:Re,notesContainerHeight:Pe}}),[Ft,Pe,Re]),Wt=(0,m.useMemo)((function(){return!!ut}),[ut]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:Pt,style:(0,a.Z)({},Vt),ref:Ue,children:(0,j.jsxs)("div",{className:jt,style:(0,a.Z)({},Bt),children:[Y&&(0,j.jsxs)("div",{"data-test-id":"contentWithCommentsSidebar.sidebar",className:Dt,ref:xe,children:[($||bt)&&Wt&&(0,j.jsx)("div",{className:oa,ref:Oe,children:(0,j.jsx)(ga,{itemId:y,disableInput:!bt,onChange:function(e){return Xe(e)},defaultValue:_,onBlur:function(){return Ct(y,Ke)},onFocus:F,focusInput:T})}),(0,j.jsx)("div",{className:Mt,"data-test-id":"review.comment.panel",ref:We,children:Wt&&(0,j.jsx)(gt,{addMarkupEnabled:ie,onDeleteCommentClick:yt,onEditSaveCommentClick:Tt,comments:h,containerMeasurements:Ut,currentUser:ge,currentUserFullName:Ie,seekToValue:S,renderAnchoredComments:Q,onIsEditingComment:function(e){return e?null===ee||void 0===ee?void 0:ee():null===ne||void 0===ne?void 0:ne()},itemId:y||"",isAddCommentOpen:qe,scrollableContainerRef:Lt})}),(0,j.jsxs)("div",{className:d()(sa,(0,r.Z)({},la,!b&&h&&h.length>0)),"data-test-id":"review.comment.input",ref:Ne,children:[b&&(0,j.jsxs)("div",{className:ca,children:[(0,j.jsx)(ta,{autofocusComments:l,onCommentsInputFocus:function(){W(),ze(!0)},onCommentsInputCancel:function(){Et(),G(),ze(!1)},isUnknownGuest:xt,itemId:y||"",containerMeasurements:Ut,onAddCommentClickHandler:Nt,actionSuccessful:et,onInputChange:function(e){(ct||dt)&&Z(),ot((function(t){var n=t.findIndex((function(e){return e.itemId===y}));if(n<0){var r={itemId:y,text:e};return[].concat((0,i.Z)(t),[r])}return t[n].text=e,t}))},temporaryComments:rt,onSetCommentAutofocus:q,onOpenIdentificationModal:z,addMarkupEnabled:ie}),(0,j.jsx)("div",{className:Zt})]}),re&&re]})]}),(0,j.jsx)("div",{children:u})]})}),(0,j.jsx)("div",{className:St,style:Ot})]})},ba="Lightbox_container__1yVPO",xa="Lightbox_withOutageBanner__qN426",Ca="Lightbox_enablementBanner__dbzIw",Ea="Lightbox_containerWithComments__-qFeU",ya="Lightbox_top__OsV4o",Ta="Lightbox_bottom__vmj-J",Na="Lightbox_bottomWrapped__j0Ypi",Ra="Lightbox_bottomUnwrapped__SqO1O",Aa="Lightbox_itemContainer__IH21I",ja="Lightbox_itemContainerWithComments__-5rm5",ka="Lightbox_mobile__-nycq";function Da(e){var t,n,i,o=e.children,l=e.prevLink,c=e.nextLink,u=e.navState,v=e.overrideArrowkeyNavigation,p=e.headerBar,f=e.navigationBar,h=e.isSidebarBeingShown,w=e.hasContentWrapped,I=e.explicitlyOverrideArrowKeyNavigation,b=(0,_.s0)(),x=(0,m.useContext)(Ur.L).isOutageBannerOn,C=(0,m.useContext)(te._f),E=C.lightboxHeight,y=C.setLightboxHeight,T=(0,V.G)(),N=T.isMinDesktop,R=T.isMinTablet,A=(0,g.Z)(),k=(0,s.Z)(A,2),D=k[0],S=k[1].height,Z=(0,Yi.i_)().isEnablementBannerActive;(0,m.useEffect)((function(){S!==E&&y(S)}),[S,E,y]),(0,m.useEffect)((function(){var e=function(e){var t={state:u};l&&c&&("ArrowLeft"===e.code&&b({pathname:null===l||void 0===l?void 0:l.pathname,search:null===l||void 0===l?void 0:l.search},(0,a.Z)({},t)),"ArrowRight"===e.code&&b({pathname:null===c||void 0===c?void 0:c.pathname,search:null===c||void 0===c?void 0:c.search},(0,a.Z)({},t)))};return v||I||document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[l,c,u,v,I,b]),(0,m.useEffect)((function(){return document.body.style.overflow="hidden",function(){document.body.style.overflow="auto"}}));var O=d()(Aa,(t={},(0,r.Z)(t,ja,h),(0,r.Z)(t,ka,!R),(0,r.Z)(t,xa,x),(0,r.Z)(t,Ca,Z),t)),M=d()(Ta,(n={},(0,r.Z)(n,Na,w),(0,r.Z)(n,Ra,!w),n)),P=d()(ba,(i={},(0,r.Z)(i,Ea,h),(0,r.Z)(i,xa,x),(0,r.Z)(i,Ca,Z),i));return(0,j.jsxs)("div",{className:P,"data-autofocus-inside":!0,ref:D,children:[(0,j.jsx)("div",{className:ya,children:p}),(0,j.jsx)("div",{className:O,children:o}),(!N&&!h||N&&R)&&(0,j.jsx)("div",{className:M,children:f})]})}var Sa,Za="HorizontalArrowGroup_horizontalArrowGroup__XYqRm";!function(e){e[e.NEXT=0]="NEXT",e[e.PREV=1]="PREV"}(Sa||(Sa={}));var Oa=function(e){var t=e.nextLink,n=e.prevLink,i=e.navState,r=(0,m.useContext)(te._f),o=r.discardEditsConfirm,a=r.isEditCommentDirty,l=r.setDiscardEditsConfirm,c=r.setShowDiscardEditsModal,u=r.setEditingCommentId,d=r.resetCommentContextMenu,v=r.setIsEditCommentDirty,p=(0,m.useState)(null),f=(0,s.Z)(p,2),h=f[0],w=f[1],g=(0,_.s0)(),b=(0,m.useCallback)((function(){w(null),l(null)}),[w,l]),C=(0,m.useCallback)((function(e){b(),u(null),d(),v(!1);var i=e===Sa.PREV?{pathname:null===n||void 0===n?void 0:n.pathname,search:null===n||void 0===n?void 0:n.search}:{pathname:null===t||void 0===t?void 0:t.pathname,search:null===t||void 0===t?void 0:t.search};g(i)}),[b,g,t,n,d,u,v]);(0,m.useEffect)((function(){null!==h&&(o&&C(h),!1===o&&b())}),[b,C,o,h]);return(0,j.jsxs)("div",{className:Za,children:[n&&(0,j.jsx)(x.hU,{state:i,appearance:"inverted",onClick:function(){if(a)return w(Sa.PREV),void c(!0);C(Sa.PREV)},children:(0,j.jsx)(I.Xd,{size:"large"})}),t&&(0,j.jsx)(x.hU,{state:i,appearance:"inverted",onClick:function(){if(a)return w(Sa.NEXT),void c(!0);C(Sa.NEXT)},children:(0,j.jsx)(I.ol,{size:"large"})})]})},Ma="NavigationBarWithAdditionalOptions_navigationBarWithAdditionalOptionsContainer__uv0K5",Pa="NavigationBarWithAdditionalOptions_navigationBarWithAdditionalOptionsContainer__horizontalArrowGroup__MsgNl",La=function(e){var t=e.nextLink,n=e.prevLink,i=e.navState,r=e.explicitlyHideNavigationArrows,o=void 0!==r&&r;return(0,j.jsx)("div",{className:Ma,children:!o&&(0,j.jsx)("div",{className:Pa,children:(0,j.jsx)(Oa,{prevLink:n,nextLink:t,navState:i})})})};var Va=["#839dff","#a8bbff","#a790fb","#4dbb5f","#66c576","#b7e7c7","#f9c346","#ff7217","#fda9a9"];function Fa(e){var t=e.comments,n=e.itemId,i=(0,m.useMemo)((function(){var e,i,r=Va,o={};if(!n||null===(e=t[n])||void 0===e||!e.nodes)return o;var a=null===(i=t[n])||void 0===i?void 0:i.nodes.slice().sort((function(e,t){return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()}));return null===a||void 0===a||a.forEach((function(e){var t,n=null!==(t=o[e.author])&&void 0!==t?t:r[function(e){for(var t=0,n=0;n<e.length;n++)t=Math.imul(31,t)+e.charCodeAt(n)|0;return 268435455&t}(e.author)%r.length];r=r.filter((function(e){return e!==n})),o[e.author]=n})),o}),[t,n]);return i}function Ba(e){var t=e.reviewId,n=e.itemId;return{pathname:(0,Ki.o)({reviewId:t}),search:"item=".concat(n)}}function Ua(e){var t,n,i=e.autofocusComments,o=e.portalId,a=e.reviewId,l=e.reviewItems,c=e.review,u=e.viewerIdentity,h=e.focusNoteInputField,w=e.isFavorited,g=e.onAction,I=e.isApproved,b=e.onSetCommentAutofocus,x=e.onOpenIdentificationModal,C=e.isGuest,E=e.user,y=e.team,T=e.portal,N=e.guestTokenId,R=e.onClose,A=void 0===R?function(){}:R,k=e.isProcessing,D=void 0!==k&&k,S=e.hasPublished,O=(0,m.useState)(h),P=(0,s.Z)(O,2),L=P[0],F=P[1],U=(0,f.v9)(kt.v9),W=(0,m.useState)(null),G=(0,s.Z)(W,2),H=G[0],q=G[1],z=(0,p.$G)().t,Y=(0,B.Fn)(),$=Y.fireEvent,K=Y.fireGroupIdentifyAdd,X=Y.fireUserAdd,Q=(0,_.TH)(),J=(0,_.s0)(),ee=Q.state,ne=(0,m.useRef)(null),ie=(0,m.useState)(!1),re=(0,s.Z)(ie,2),oe=re[0],ae=re[1],se=(0,m.useState)(!1),le=(0,s.Z)(se,2),ce=le[0],ue=le[1],de=(0,m.useState)(),ve=(0,s.Z)(de,2),me=ve[0],pe=ve[1],fe=(0,m.useState)(!1),_e=(0,s.Z)(fe,2),he=_e[0],we=_e[1],ge=(0,V.G)(),Ie=ge.isMinTablet,be=ge.isMinDesktop,xe=(0,m.useContext)(Ur.L).isOutageBannerOn,Ce=(0,m.useContext)(te._f).editingCommentId,Ee=(0,m.useContext)(It).teamMembers,ye=(0,f.v9)(ln.m2.selectEntities),Te=(0,Rt.B)({portalId:o,reviewId:a}).guestEmail,Ne=(0,m.useContext)(te._f),Re=Ne.currentMarkup,Ae=Ne.clearAllCurrentMarkup,je=Ne.currentPDFPage,ke=Ne.setCurrentPDFPage,De=Ne.currentVideoTime,Se=Ne.setCurrentVideoTime,Ze=Ne.currentAudioTime,Oe=Ne.setCurrentAudioTime,Me=Ne.activeCommentId,Pe=Ne.setActiveCommentId,Le=Ne.isAnchorCheckboxChecked,Ve=Ne.setIsAnchorCheckboxChecked,Fe=Ne.isCommentContextMenuOpen,Be=Ne.isEditCommentDirty,Ue=Ne.setIsEditCommentDirty,We=Ne.resetCommentContextMenu,Ge=Ne.setEditingCommentId,He=Ne.showDiscardEditsModal,qe=Ne.setShowDiscardEditsModal,ze=Ne.discardEditsConfirm,Ye=Ne.setDiscardEditsConfirm,$e=Ne.setLightboxHeight,Ke=Ne.videoRef,Xe=Ne.audioRef,Qe=l.findIndex((function(e){return(null===e||void 0===e?void 0:e.publicId)===H})),Je=l[Qe],et=Boolean(Je&&Re[Je.publicId]&&Re[Je.publicId].length>0),tt=l&&l.length>0,nt=null===c||void 0===c?void 0:c.downloadEnabled,it="FAVORITE"===(null===c||void 0===c?void 0:c.actionType),rt="APPROVE"===(null===c||void 0===c?void 0:c.actionType),ot=(0,Z.Tn)(Je),at=ot.isVideo,st=ot.isAudio,lt=ot.isPdf,ct=ot.isImage,ut=(0,Z.JB)(Je),dt=at||st||lt,vt=(0,m.useMemo)((function(){return(at||lt||ct)&&be&&!0===(null===c||void 0===c?void 0:c.commentsEnabled)&&!Ce&&!Fe}),[Ce,Fe,ct,be,lt,at,null===c||void 0===c?void 0:c.commentsEnabled]),mt=vt&&"UNKNOWN_GUEST"!==u,pt=(0,m.useMemo)((function(){var e,t,n;return H&&null!==(e=ye[H])&&void 0!==e&&e.nodes&&null!==(t=null===(n=ye[H])||void 0===n?void 0:n.nodes)&&void 0!==t?t:[]}),[ye,H]),ft="OWNER"===u&&ee&&ee.isEditing,_t=!ft&&!(null===Je||void 0===Je||!Je.note),ht=(0,m.useCallback)((function(){Pe(""),pe(void 0),ne.current=null}),[Pe]);(0,m.useEffect)((function(){document.title=(null===c||void 0===c?void 0:c.title)||z("app.document_default_title")}),[z,null===c||void 0===c?void 0:c.title]),(0,m.useEffect)((function(){var e=new URLSearchParams(Q.search);q(e.get("item"))}),[Q.search]),(0,m.useEffect)((function(){je!==ne.current&&null!==ne.current&&ht()}),[je,ht]),(0,m.useEffect)((function(){Ve(!0),ht()}),[H,Ve,ht]),(0,m.useEffect)((function(){""===Me&&ht()}),[Me,ht]),(0,m.useEffect)((function(){lt||at||st||(ke(1),Se(0),Oe(0))}),[H,lt,at,st,ke,Se,Oe]),(0,m.useEffect)((function(){var e=!(null===Je||void 0===Je||!Je.note)||ft||!(null===c||void 0===c||!c.commentsEnabled)||pt&&pt.length>0;ae(e)}),[pt,ft,ee,null===c||void 0===c?void 0:c.commentsEnabled,null===Je||void 0===Je?void 0:Je.note,ae,u]);var wt=(0,m.useCallback)((function(){we(!1),Ye(null)}),[Ye,we]),gt=(0,m.useCallback)((function(){A(),Ae();var e=Q.pathname;Q.state&&Q.state.isEditing&&-1===e.indexOf("/edit")&&(e="".concat(Q.pathname,"/edit")),J(e,{replace:!0})}),[Ae,Q,J,A]);(0,m.useEffect)((function(){return function(){wt(),Ge(null),We(),Ue(!1),$e(0)}}),[]),(0,m.useEffect)((function(){he&&(ze&&gt(),!1===ze&&wt())}),[Ae,gt,ze,he,wt]);var bt=Fa({comments:ye,itemId:H}),xt=(0,m.useMemo)((function(){if(!["OWNER","REVIEWER"].includes(u))return[];if(!at&&!st)return[];var e=Ie?"regular":"small";return pt.filter((function(e){var t,n;return void 0!==(null===(t=e.anchor)||void 0===t?void 0:t.timestamp)&&null!==(null===(n=e.anchor)||void 0===n?void 0:n.timestamp)})).map((function(t){var n,i;return{id:t.publicId,value:null!==(n=null===(i=t.anchor)||void 0===i?void 0:i.timestamp)&&void 0!==n?n:0,size:e,status:""!==Me?Me===t.publicId?"selected":"not-selected":"default",color:bt[t.author]}}))}),[Me,bt,Ie,at,st,pt,u]);if(!tt)return null;if(!H||!Je)return null;var Ct=Qe===l.length-1?0:Qe+1,Et=0===Qe?l.length-1:Qe-1,yt=l.length>1?Ba({reviewId:a,itemId:l[Ct].publicId}):void 0,Tt=l.length>1?Ba({reviewId:a,itemId:l[Et].publicId}):void 0;var At=function(e){at&&Ke.current&&(Se(e),Ke.current.currentTime=e),st&&Xe.current&&(Oe(e),Xe.current.currentTime=e),jt()},jt=function(){at&&Ke.current&&(Ke.current.pause(),Se(Ke.current.currentTime)),st&&Xe.current&&(Xe.current.pause(),Oe(Xe.current.currentTime))},Dt=(0,j.jsx)(La,{navState:ee,prevLink:Tt,nextLink:yt}),St=(0,j.jsx)(Ho,{portalId:o,filename:Je.name||null,filesize:Je.size||null,canDownload:nt,itemType:Je.itemType,isGuest:C,canFavorite:it,shouldDisplayMetaData:be,isFavorited:w&&w(Je.publicId),favoritedBy:Je.favoritedBy,publicId:Je.publicId,onAction:g,canApprove:rt,isApproved:I&&I(Je.publicId),approvedBy:Je.approvedBy,reviewId:a,fileType:ut,onClose:function(){if(Be)return qe(!0),void we(!0);gt()},hasPublished:S});return(0,j.jsxs)("div",{className:d()(Gr,(0,r.Z)({},Hr,xe)),children:[(0,j.jsx)(Ia,{autofocusComments:i,navState:ee,viewerIdentity:u,portalId:o,note:Je.note||"",comments:pt,commentsTotalCount:null===(t=ye[H])||void 0===t?void 0:t.totalCount,reviewItemPublicIdCommentsBelongTo:null===(n=ye[H])||void 0===n?void 0:n.publicId,commentsEnabled:null===c||void 0===c?void 0:c.commentsEnabled,reviewId:a,itemId:H||"",focusNoteInputField:h,review:c,portal:T,onNotesInputFocus:function(e){F(!0),function(e){var t=e.target.value;e.target.value="",e.target.value=t}(e)},onNotesInputBlur:function(){return F(!1)},onCommentsInputFocus:function(){var e,t;(F(!0),ht(),jt(),H&&Re[H])&&(void 0!==(null===(e=Re[H][0])||void 0===e?void 0:e.atTimestamp)&&(Se(Re[H][0].atTimestamp),At(Re[H][0].atTimestamp)),void 0!==(null===(t=Re[H][0])||void 0===t?void 0:t.atPage)&&ke(Re[H][0].atPage))},onCommentsInputCancel:function(){return F(!1)},onCommentAddClick:function(){Pe("")},onCommentEditFocus:function(){return F(!0)},onCommentEditBlur:function(){return F(!1)},onCommentEvent:function(e,t){var n,i={};if("ADD"===e&&(c&&H&&Je.name&&(0,B.EM)({review:c,portal:T,team:y,userId:(null===E||void 0===E?void 0:E.sub)||"",userIdentity:u,guestTokenId:N||"",tier:U,isAnchoredComment:dt?Le:null,itemId:H,fileName:Je.name,hasMarkup:vt?et:null}),n={},(0,r.Z)(n,B.r8.HAS_ANCHOR,dt&&Le),(0,r.Z)(n,B.r8.HAS_MARKUP,et),i=n,null!==c&&void 0!==c&&c.dueDate)){var o=(new Date).getTime(),s=(0,v.default)(o,new Date(c.dueDate));i[B.r8.PAST_DUE_DATE]=s}if(("DELETE"===e||"EDIT"===e)&&t&&H&&ye[H]){var d,m,p,f,_,h=ye[H],w=null===h||void 0===h?void 0:h.nodes.find((function(e){return e.publicId===t}));if(w)_={},(0,r.Z)(_,B.r8.HAS_ANCHOR,!!(null!==(d=w.anchor)&&void 0!==d&&d.timestamp||0===(null===(m=w.anchor)||void 0===m?void 0:m.timestamp)||null!==(p=w.anchor)&&void 0!==p&&p.page)),(0,r.Z)(_,B.r8.HAS_MARKUP,!(null===(f=w.anchor)||void 0===f||!f.markup)),i=_}var g=B.B_.COMMENT_ADDED;if("DELETE"!==e&&"EDIT"!==e||(g=B.B_.COMMENT_EDITED),"EDIT"===e&&(i[B.r8.TYPE]="Edited"),"DELETE"===e&&(i[B.r8.TYPE]="Deleted"),i[B.r8.ITEM_TYPE]=ut,$({eventName:g,optionalEventProperties:i,groups:(0,r.Z)({},Br.YT.REVIEW,a)}),"ADD"===e||"DELETE"===e){var I,b="ADD"===e?1:-1;K({groupType:Br.YT.REVIEW,groupName:a,propertyValues:(I={},(0,r.Z)(I,Br.vb.NUM_COMMENTS,b),(0,r.Z)(I,Br.vb.NUM_REVIEWERS,M(l,(null===E||void 0===E?void 0:E.email)||Te,Ee,"ADD"===e)),I)}),null!==E&&void 0!==E&&E.sub&&X(E.sub,(0,r.Z)({},Br.OE.NUM_COMMENTS_ADDED,b))}},showSidebarToViewer:oe,showNotesToViewer:_t,onSetCommentAutofocus:b,onOpenIdentificationModal:x,onContentWrap:ue,renderAnchoredComments:function(e){var t=e.page,n=e.timestamp,i=e.author,r=e.markup;return(0,j.jsx)(Nt,{displayPage:t,displayTime:n,displayMarkup:r,isPdf:lt,isVideo:at,isAudio:st,color:bt[i],showIndicator:!0})},anchorValue:function(){return at?{location:{timestamp:De}}:st?{location:{timestamp:Ze}}:lt?{location:{page:je}}:{location:{}}},seekToValue:function(e){var t=e.page,n=e.timestamp;void 0!==n&&null!==n&&(ne.current=n,At(n)),void 0!==t&&null!==t&&(ne.current=t,t!==je&&ke(t))},pauseMedia:jt,commentIdToScrollTo:me,addMarkupEnabled:mt,navigationBar:be?null:Dt,children:(0,j.jsx)(Da,{navState:ee,prevLink:Tt,nextLink:yt,overrideArrowkeyNavigation:L,headerBar:St,navigationBar:Dt,isSidebarBeingShown:oe,hasContentWrapped:ce,children:(0,j.jsx)(Wr._A,{children:(0,j.jsx)(Nn.t,{reviewItem:Je,isDownloadEnabled:nt,onCurrentTimeChange:function(e){var t,n,i,r,o;Math.abs(e-De)>.5&&Se(e);var a=null!==(t=null===(n=Je.preview)||void 0===n||null===(i=n.videoStatic)||void 0===i||null===(r=i.metadata)||void 0===r?void 0:r.framerate)&&void 0!==t?t:0;(0,Fr.$w)({time:e,framerate:a})!==(0,Fr.$w)({time:null!==(o=ne.current)&&void 0!==o?o:0,framerate:a})&&ht()},onMarkerSelect:function(e){var t=e.id,n=e.value;Pe(t),pe(t);var i=n;ne.current=i,At(i)},onMarkupLayerDrawStart:function(){vt&&("UNKNOWN_GUEST"===u&&null!==c&&void 0!==c&&c.commentsEnabled&&(null===x||void 0===x||x()),jt(),ht(),null===b||void 0===b||b(!0))},isDetailView:!0,markers:xt,isProcessing:D,isAddMarkupEnabled:mt,showMarkupCursor:!1!==(null===c||void 0===c?void 0:c.commentsEnabled)&&!Ce,viewerIdentity:u},"review-item-preview-".concat(Je.publicId))})})}),He&&(0,j.jsx)(Yo,{onConfirm:function(){Ye(!0),qe(!1)},onCancel:function(){Ye(!1),qe(!1)}})]})}var Wa="AssetPreviewNote_container__STjw1",Ga="AssetPreviewNote_note__M2fdF",Ha="AssetPreviewNote_column__97cye",qa="AssetPreviewNote_placeholder__1rkJ0";function za(e){var t,n=e.identity,i=e.note,o=(0,p.$G)().t,a=(0,m.useContext)(X.X),s=a.layoutGrid,l=a.displayMode,c="OWNER"===n&&o("editReview.add_note"),u="edit"===l;return(0,j.jsx)("div",{className:Wa,children:"GRID"!==s&&(u||i)&&(0,j.jsx)("p",{className:d()(Ga,(t={},(0,r.Z)(t,Ha,"COLUMN"===s),(0,r.Z)(t,qa,!i),t)),children:i||c})})}var Ya="AssetGridNote_noteComments__TkWTJ";function $a(e){var t=e.id,n=e.note,i=e.identity,r=e.isEditing,o=e.focusNotesInDetails,a=void 0===o?function(){}:o,s=(0,_.s0)(),l=(0,_.UO)().reviewId,c=void 0===l?"":l,u=(0,Ar.nB)({id:t}).isDragging,d=(0,m.useCallback)((function(e){a(),s("".concat((0,Ki.o)({reviewId:c}),"?item=").concat(e),{state:{isEditing:r}})}),[a,s,c,r]);return u?null:(0,j.jsx)("div",{className:Ya,children:(0,j.jsx)(x.CE,{onClick:function(){return d(t)},"data-test-id":"note.link",children:(0,j.jsx)(za,{identity:i,note:n})})})}var Ka=n(23441),Xa={container:"AssetPreview_container__8wcC3",actionSelected:"AssetPreview_actionSelected__lCRgj",emptyGridItem:"AssetPreview_emptyGridItem__pwLKW",assetContainer:"AssetPreview_assetContainer__ORYOB",assetContainerGrid:"AssetPreview_assetContainerGrid__+eYe7",assetContainerFixedHeight:"AssetPreview_assetContainerFixedHeight__DCfNM",assetLink:"AssetPreview_assetLink__HhR42",statusBarContainer:"AssetPreview_statusBarContainer__XTgw3",spinnerContainer:"AssetPreview_spinnerContainer__v8iDq"},Qa=n(73388),Ja="ActionsDropdown_menuPopover__CIVK8",es="ActionsDropdown_mainMenuIcon__bNb-e",ts="ActionsDropdown_menu__3Td7r",ns="ActionsDropdown_menuDivider__814nU",is="ActionsDropdown_fileName__J1Vfx",rs="ActionsDropdown_menuItem__jgn2S";function os(e){var t=e.filename,n=e.reviewItemId,i=e.canDelete,r=void 0!==i&&i,o=e.onDeleteItem,a=void 0===o?function(){}:o,s=e.onDownloadItem,l=void 0===s?function(){}:s,c=(0,p.$G)().t,u=(0,L.T)(),d=u.canUseFreeTier,v=u.restrictionStatus,m=d&&"OVER_LIMIT"===v,f=function(){var e=t.lastIndexOf("."),n=t.slice(e),i=t;return t.length>25&&(i="".concat(t.substring(0,25),"...").concat(n)),i};return(0,j.jsx)(ct.v2,{children:function(e){var i=e.isExpanded;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ct.j2,{className:es,as:x.hU,appearance:"overlay",size:"small","data-test-id":"".concat(t,".reviewItem.ellipsis"),children:(0,j.jsx)(I.v2,{})}),i?(0,j.jsx)(ct.YI,{className:Ja,children:(0,j.jsxs)(ct.sd,{className:ts,children:[(0,j.jsx)("p",{className:is,title:t,children:f()}),(0,j.jsx)("hr",{className:ns}),r&&(0,j.jsxs)(ct.sN,{onSelect:a,className:rs,"data-test-id":"".concat(t,".reviewItem.delete"),children:[(0,j.jsx)(I.rF,{size:"regular"}),c("reviewItem.delete")]}),n&&(0,j.jsxs)(ct.sN,{onSelect:l,className:rs,"data-test-id":"".concat(t,".reviewItem.download"),disabled:m,children:[(0,j.jsx)(I.ZZ,{size:"regular"}),c("reviewItem.download")]})]})}):null]})}})}var as,ss={container:"AssetPreviewStatusBar_container__qze4D",progressBar:"AssetPreviewStatusBar_progressBar__Jijtg",progressBarIndicator:"AssetPreviewStatusBar_progressBarIndicator__1rO2S",processingBar:"AssetPreviewStatusBar_processingBar__7UmCy",gradientAnimation:"AssetPreviewStatusBar_gradientAnimation__etMdn",filename:"AssetPreviewStatusBar_filename__FEgge",accentFilename:"AssetPreviewStatusBar_accentFilename__88fDU",status:"AssetPreviewStatusBar_status__-KWr6",hideAfterPause:"AssetPreviewStatusBar_hideAfterPause__l26iy",hideAnimation:"AssetPreviewStatusBar_hideAnimation__ygQlI",labels:"AssetPreviewStatusBar_labels__SLIL9",staticLabel:"AssetPreviewStatusBar_staticLabel__MlZGA"};function ls(e){var t=e.isVideo,n=void 0!==t&&t,i=e.isLinkPreviewType,r=void 0!==i&&i,o=e.filename,a=void 0===o?"":o,s=e.fileSize,l=void 0===s?0:s,c=e.progress,u=void 0===c?0:c,v=e.status,m=e.reviewItemId,f=void 0===m?"":m,_=e.identity,h=e.isEditView,w=e.isOwnerView,g=e.isProcessing,I=void 0!==g&&g,b=e.onDeleteItem,x=e.canDownloadReviewItems,C=e.onDownloadItem,E=e.itemType,y=(e.previewUrl,e.previewSet),T=e.isNotPreviewable,N=void 0!==T&&T,R=v===as.UPLOADING,A=(0,p.$G)().t,k=(0,L.T)(),D=k.canUseFreeTier,S=k.previews,O=k.restrictionStatus,M=100===u,P=R||I,V=(0,Z.yW)(l),F=u<1?1:u,B=R&&!M,U=x&&"LINK"!==E,W=(0,Qa.u)({canUseFreeTier:D,fileSize:l,identity:_,previews:S,previewSet:y}),G="FILE"===E&&U&&!(D&&"OVER_LIMIT"===O);return(0,j.jsxs)("div",{className:d()(ss.container,R&&ss.uploading,I&&ss.processing),children:[P&&!r&&(0,j.jsxs)("div",{children:[R&&!M&&(0,j.jsx)("div",{className:ss.progressBar,children:(0,j.jsx)("div",{className:ss.progressBarIndicator,style:{width:"".concat(F,"%")}})}),(I&&!N&&!R&&!W||R&&M)&&(0,j.jsx)("div",{className:ss.progressBar,children:(0,j.jsx)("div",{className:ss.processingBar,"data-test-id":"portals.processing-bar"})})]}),(0,j.jsxs)("div",{className:ss.labels,children:[(0,j.jsx)("span",{className:d()(ss.filename,ss.accentFilename),children:a}),R&&!M&&!r&&(0,j.jsxs)("span",{className:ss.status,"data-test-id":"itemPreviewStatus.status",children:[V,"\xa0\u2022\xa0",u,"%"]}),!B&&I&&!N&&(0,Z.kS)(a,l)&&!W&&(0,j.jsx)(j.Fragment,{children:n?(0,j.jsx)("span",{className:ss.staticLabel,children:A("reviewItem.preview.processing_video")}):(0,j.jsx)("span",{className:ss.staticLabel,children:A("reviewItem.preview.processing_file")})}),(G&&!R&&!I||!h&&G&&W)&&(0,j.jsx)(os,{filename:a,reviewItemId:f,canDelete:h&&w,onDeleteItem:h?b:void 0,onDownloadItem:function(){return U&&C(f,a)}})]})]})}function cs(e){var t,n,i=e.reviewItem,o=e.isDownloadEnabled,a=void 0===o||o,l=e.isLoading,c=void 0!==l&&l,u=e.isFirstItem,v=e.isEditView,p=e.isOwnerView,f=e.onDeleteItem,w=e.onDownloadItem,g=e.canDownloadReviewItems,I=e.isActionConfirmedUponAsset,b=(0,m.useState)(!1),x=(0,s.Z)(b,2),C=x[0],E=x[1],y=(0,_.UO)().reviewId,T=(0,Ka.YD)(),N=T.ref,R=T.inView,A=(0,m.useContext)(X.X),k=A.layoutGrid,D=A.displayMode,S=(0,m.useContext)(te._f).isUnidentifiedUser,O=(0,m.useContext)(G.H).identity,M=null===i||void 0===i?void 0:i.publicId,P=(null===i||void 0===i?void 0:i.name)||"",L=null===i||void 0===i?void 0:i.preview,V=null===i||void 0===i?void 0:i.size,F=null===i||void 0===i?void 0:i.previewUploadProgress,B=function(e){var t,n;if(e){var i=(0,Z.vY)(null!==(t=e.name)&&void 0!==t?t:"",null!==(n=e.size)&&void 0!==n?n:0),r=!e.isProcessingComplete,o=e.isProcessingComplete&&(0,yn.c0)(e.previewStatus,e.preview)&&!i;return r?as.UPLOADING:o?as.PROCESSING:void 0}}(i),U="edit"===D;(0,Rr.IJ)({onDragMove:function(){E(!0)},onDragEnd:function(){E(!1)}});var W=(0,Z.Tn)(i),H=W.isVideo,q=W.isAudio,z=W.isPdf,Y=W.isLink,$=W.isNotPreviewable,K=q?null===L||void 0===L||null===(t=L.audioVisualization)||void 0===t?void 0:t.imageWaveform:null===L||void 0===L||null===(n=L.image)||void 0===n?void 0:n.url,Q=!$&&(0,yn.c0)(null===i||void 0===i?void 0:i.previewStatus,null===i||void 0===i?void 0:i.preview),J=(null===K||void 0===K?void 0:K.includes("https://previews-te"))||!1,ee=H||q||z||J,ne=(0,j.jsx)(Nn.t,{reviewItem:i,isGridView:!0,isDetailView:!1,isDownloadEnabled:a,isFirstItem:u,forceGenericPreview:U,viewerIdentity:O});return(0,j.jsxs)("div",{className:d()(Xa.container,(0,r.Z)({},Xa.actionSelected,I&&!S)),children:[(0,j.jsx)("div",{ref:N,className:d()(Xa.assetContainer,"GRID"===k?Xa.assetContainerGrid:Xa.assetContainerList),children:c||Y?ne:(0,j.jsx)(h.rU,{className:Xa.assetLink,to:{pathname:(0,Ki.o)({reviewId:y})+(U?"/edit":""),search:"item=".concat(M)},state:{isEditing:U},style:{pointerEvents:C?"none":"auto"},children:(ee||R)&&ne})}),(0,j.jsx)("div",{className:Xa.statusBarContainer,children:(0,j.jsx)(ls,{isVideo:H,isLinkPreviewType:Y,filename:P,fileSize:V,status:B,progress:F,previewSet:L,reviewItemId:(null===i||void 0===i?void 0:i.publicId)||"",identity:O,isOwnerView:p,isEditView:v,isProcessing:Q,onDeleteItem:f,onDownloadItem:w,itemType:null===i||void 0===i?void 0:i.itemType,canDownloadReviewItems:g,previewUrl:K,isNotPreviewable:$})})]})}function us(e){return(0,j.jsx)(Wr._A,{children:(0,j.jsx)(cs,(0,a.Z)({},e))})}!function(e){e.PROCESSING="PROCESSING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE"}(as||(as={}));var ds,vs={contentGrid:"AssetsGrid_contentGrid__3lvL1",grid:"AssetsGrid_grid__twCXC",single:"AssetsGrid_single__r5g0h",double:"AssetsGrid_double__L+-6x",triple:"AssetsGrid_triple__oMV0e",lock:"AssetsGrid_lock__q+Lbr",column:"AssetsGrid_column__xQ1Me",emptyGrid:"AssetsGrid_emptyGrid__mahfU",contentGridItem:"AssetsGrid_contentGridItem__o7jiw",actionSelected:"AssetsGrid_actionSelected__GJ7rH",emptyGridItem:"AssetsGrid_emptyGridItem__SNxq+",fileName:"AssetsGrid_fileName__-BCE3",menuIcon:"AssetsGrid_menuIcon__8Hbd9",menuDivider:"AssetsGrid_menuDivider__gL+HV",cornerOnHover:"AssetsGrid_cornerOnHover__5povx",containerGrid:"AssetsGrid_containerGrid__xMGPR",containerColumn:"AssetsGrid_containerColumn__YtAHo",empty:"AssetsGrid_empty__tTplk",notesContainer:"AssetsGrid_notesContainer__8bbbD",hidden:"AssetsGrid_hidden__ppHYq"},ms=["id","children"];function ps(e){var t=e.id,n=e.children,i=(0,_e.Z)(e,ms),r=(0,m.useContext)(X.X).displayMode,o=function(e){var t=(0,Ar.nB)({id:e}),n=t.attributes,i=t.listeners,r=t.setNodeRef,o=t.transform,s=t.transition,l={touchAction:"none",transform:kr.ux.Transform.toString(o),transition:s};return(0,a.Z)((0,a.Z)({ref:r,style:l},n),i)}(t),s="edit"===r,l=(0,a.Z)((0,a.Z)({},i),s?o:{});return(0,j.jsx)("li",(0,a.Z)((0,a.Z)({},l),{},{children:n}))}function fs(e){var t,n,i,l,u,v,h,w,g=e.portalId,I=e.autofocusComments,b=void 0!==I&&I,x=e.hasPublished,C=void 0!==x&&x,E=e.isEmptyGrid,y=void 0!==E&&E,T=(e.containerWidth,e.onSetCommentAutofocus),N=e.onOpenIdentificationModal,R=e.updateApproved,A=e.updateFavorites,k=(0,m.useContext)(te._f),S=k.cleanupPdfBlobs,O=k.isUnidentifiedUser,M=k.savingActionError,V=k.currentAssetBeingActionedUpon,F=k.setCurrentAssetBeingTargetedUpon,U=(0,p.$G)().t,W=(0,_.UO)().reviewId,G=void 0===W?"":W,H=(0,B.Fn)(),q=H.fireEvent,z=H.fireErrorEvent,Y=H.fireGroupIdentifyAdd,$=H.fireUserAdd,K=(0,P.T)(),Q=(0,_.TH)(),J=(0,m.useState)(!1),ee=(0,s.Z)(J,2),ne=ee[0],ie=ee[1],re=(0,m.useState)(!1),oe=(0,s.Z)(re,2),ae=oe[0],se=oe[1],le=(0,m.useState)(!1),ce=(0,s.Z)(le,2),ue=ce[0],de=ce[1],ve=(0,m.useState)(null),me=(0,s.Z)(ve,2),pe=me[0],fe=me[1],_e=(0,f.v9)(ln.m2.selectEntities),he=(0,m.useContext)(X.X),we=he.displayMode,ge=he.layoutGrid,Ie=he.setShouldDismissToast,be=he.shouldDismissToast,xe=y?"GRID":ge,Ce=(0,m.useContext)(_r.l),Ee=Ce.dismissToast,ye=Ce.isItemUploading,Te=Ce.reviewItemsWithProgress,Ne=y?function(e){for(var t=[],n=0;n<4;n++)t[n]={isProcessingComplete:!0,publicId:n.toString(),stormId:null,order:n,itemType:"FILE",reviewId:e,createdAt:null,updatedAt:null};return t}(G):Te,Re="edit"===we;(0,m.useLayoutEffect)((function(){if(new URLSearchParams(Q.search).get("item"))return de(!0);de(!1)}),[Q.search]);var Ae=(0,m.useMemo)((function(){return 1===Ne.length&&"GRID"===xe}),[xe,Ne.length]),je=(0,m.useMemo)((function(){return 2===Ne.length&&"GRID"===xe}),[xe,Ne.length]),ke=(0,m.useMemo)((function(){return 3===Ne.length&&"GRID"===xe}),[xe,Ne.length]),De=(0,f.v9)(sr.BX),Se=(0,f.v9)(lr.HF),Ze=(0,f.v9)(kt.v9),Oe=(0,Rt.B)({portalId:g,reviewId:G}),Me=Oe.guestTokenId,Pe=Oe.guestEmail,Le=Oe.isFetchingGuestToken,Ve=Pr(g).portal,Fe=(0,Lr.$)({reviewId:G,guestTokenId:Me}).review,Be=(0,ir.c)({guestEmail:Pe,actionRequests:null!==Fe&&void 0!==Fe&&Fe.actionRequest?[Fe.actionRequest]:[],owningTeam:null===Fe||void 0===Fe?void 0:Fe.teamId,isFetchingGuestToken:Le}).identity,Ue=(0,m.useMemo)(ln.q,[]),We=(0,f.v9)((function(e){return Ue(e,G)})),Ge=(0,zi.B)(G).totalAssignedCount,He=(0,L.T)().canUseFreeTier,qe=(0,Xi.v)(),ze=qe.entitlement,Ye=qe.updateEntitlement;(0,m.useEffect)((function(){return function(){return S()}}),[S]),(0,m.useEffect)((function(){be&&(Ee(),Ie(!1))}),[Ee,Ie,be]);var $e=(0,m.useMemo)((function(){var e,t;return null!==(null===Fe||void 0===Fe||null===(e=Fe.actionRequest)||void 0===e?void 0:e.completedAt)&&void 0!==(null===Fe||void 0===Fe||null===(t=Fe.actionRequest)||void 0===t?void 0:t.completedAt)}),[null===Fe||void 0===Fe||null===(t=Fe.actionRequest)||void 0===t?void 0:t.completedAt]),Ke=er(G,"approves",null===Fe||void 0===Fe||null===(n=Fe.actionRequest)||void 0===n?void 0:n.approvedItems,null===Fe||void 0===Fe||null===(i=Fe.actionRequest)||void 0===i?void 0:i.email).isSelectedItem,Xe=er(G,"favorites",null===Fe||void 0===Fe||null===(l=Fe.actionRequest)||void 0===l?void 0:l.favoritedItems,null===Fe||void 0===Fe||null===(u=Fe.actionRequest)||void 0===u?void 0:u.email).isSelectedItem,Qe="GUEST"===Be||"UNKNOWN_GUEST"===Be||"LOADING"===Be;function Je(){ie(!1)}var et=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,o,s,l,u,d,v,m;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fe(null),e.next=3,K((0,At.jw)({reviewId:G,reviewItemIds:[t.publicId]}));case 3:if(!e.sent.error){e.next=7;break}return z("editReview.delete_item_failed"),e.abrupt("return",(0,D.t6)({message:U("editReview.delete_item_failed"),type:"error"}));case 7:if(Fe&&De&&(o=Ne.filter((function(e){return e.publicId!==t.publicId})),(0,B.gk)({review:(0,a.Z)((0,a.Z)({},Fe),{},{itemCount:Fe.itemCount-1}),reviewItems:o,numberOfAssignedReviewers:Ge,portal:Ve,team:De,userId:(null===Se||void 0===Se?void 0:Se.sub)||"",comments:We,tier:Ze}),(s=(null===(n=t.comments)||void 0===n?void 0:n.totalCount)||0)>0&&Y({groupType:B.YT.REVIEW,groupName:G,propertyValues:(0,r.Z)({},B.vb.NUM_COMMENTS,-1*s)}),(l=B.Lg.trackReviewItemDiff(o))&&(Y({groupType:B.YT.REVIEW,groupName:null===Fe||void 0===Fe?void 0:Fe.publicId,propertyValues:l}),l[B.vb.NUM_ITEMS]&&null!==Se&&void 0!==Se&&Se.sub&&$(null===Se||void 0===Se?void 0:Se.sub,(0,r.Z)({},B.OE.NUM_ITEMS_ADDED,l[B.vb.NUM_ITEMS])),l[B.vb.TOTAL_SIZE]&&(u=(0,r.Z)({},B.$H.STORAGE_USED,l[B.vb.TOTAL_SIZE]),"DRAFT"===(null===Fe||void 0===Fe?void 0:Fe.status)&&(u[B.$H.DRAFT_STORAGE_USED]=l[B.vb.TOTAL_SIZE]),Y({groupType:B.YT.WORKSPACE,groupName:null===Fe||void 0===Fe?void 0:Fe.teamId,propertyValues:u}))),d=0,null===Fe||void 0===Fe||null===(i=Fe.actionRequests)||void 0===i||i.forEach((function(e){var n,i;null===(n=e.favoritedItems)||void 0===n||n.forEach((function(e){e.publicId===t.publicId&&d++})),null===(i=e.approvedItems)||void 0===i||i.forEach((function(e){e.publicId===t.publicId&&d++}))})),d&&Y({groupType:B.YT.REVIEW,groupName:null===Fe||void 0===Fe?void 0:Fe.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_ACTIONS,-1*d)})),!He){e.next=13;break}return e.next=11,ze({query:"storage"});case 11:null!==(m=e.sent)&&void 0!==m&&null!==(v=m.entitlements)&&void 0!==v&&v.storage&&Ye("storage",m.entitlements.storage);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),tt=function(e){var t,n;(null!==(t=null===(n=_e[e.publicId])||void 0===n?void 0:n.totalCount)&&void 0!==t?t:0)>=0&&(ie(!0),fe(e))},nt=Or().getDownloadReviewItemLink,it=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,o,a,s,l,u,d,v,m,p,f,_;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.reviewItemId,l=t.fileName,u=void 0===l?"":l,d=t.fileType,e.next=3,nt({reviewId:G,reviewItemId:s});case 3:(v=e.sent).error||null!==(n=v.data)&&void 0!==n&&null!==(i=n.downloadReviewItem)&&void 0!==i&&i.errors&&(null===(o=v.data)||void 0===o||null===(a=o.downloadReviewItem)||void 0===a?void 0:a.errors.length)>0?((0,D.t6)({message:U("error.file_download_error"),type:"error"}),z("error.file_download_error")):(Fe&&(Y({groupType:B.YT.REVIEW,groupName:null===Fe||void 0===Fe?void 0:Fe.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_DOWNLOADS,1)}),(0,B.Xt)({review:Fe,portal:Ve,team:De,userId:(null===Se||void 0===Se?void 0:Se.sub)||"",userIdentity:Be,guestTokenId:Me,tier:Ze,itemId:s,fileName:u})),(f=null===(m=v.data)||void 0===m||null===(p=m.downloadReviewItem)||void 0===p?void 0:p.streamingDownloadUrl)?(q({eventName:B.B_.FILE_DOWNLOADED,optionalEventProperties:(_={},(0,r.Z)(_,B.r8.TYPE,"single"),(0,r.Z)(_,B.r8.LOCATION,B.sR.ITEM_CARD),(0,r.Z)(_,B.r8.ITEM_TYPE,d),_),groups:(0,r.Z)({},B.YT.REVIEW,G)}),window.location.href=f):((0,D.t6)({message:U("error.no_files_to_download"),type:"error"}),z("error.no_files_to_download")));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function rt(e,t,n,i,r){switch(e){case"APPROVE":R&&R(t,n,i,r);break;case"FAVORITE":A&&A(t,n,i,r)}F({assetItemId:n,isSelected:t})}function ot(e){var t,n;return!e.isProcessingComplete&&!(0,Z.vY)(null!==(t=e.name)&&void 0!==t?t:"",null!==(n=e.size)&&void 0!==n?n:0)}return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("ul",{className:d()(vs.contentGrid,vs["GRID"===xe?"grid":"column"],(v={},(0,r.Z)(v,vs.single,Ae),(0,r.Z)(v,vs.double,je),(0,r.Z)(v,vs.triple,ke),(0,r.Z)(v,vs.lock,ue),(0,r.Z)(v,vs.emptyGrid,y),v)),id:"action_parent",children:Ne.map((function(e,t){var n,i,o,a,s,l=e.publicId,c=null!==(n=null===(i=_e[l])||void 0===i?void 0:i.totalCount)&&void 0!==n?n:0,u=null!==(o=e.name)&&void 0!==o?o:"",v=ye(e.publicId),m=(0,Z.JB)(e),p="APPROVE"===(null===Fe||void 0===Fe?void 0:Fe.actionType),f="FAVORITE"===(null===Fe||void 0===Fe?void 0:Fe.actionType),_=Xe(l),h=Ke(l),w=p&&h||f&&_,I=V.assetItemId===(null===e||void 0===e?void 0:e.publicId)?M?w:V.isSelected:w;return(0,j.jsxs)(ps,{className:d()(vs.contentGridItem,(a={},(0,r.Z)(a,vs.actionSelected,I&&!O),(0,r.Z)(a,vs.emptyGridItem,y),a)),id:l,children:[!y&&(0,j.jsx)(Io,{name:null!==(s=e.name)&&void 0!==s?s:"",className:"GRID"===xe?vs.containerGrid:vs.containerColumn,hasPublished:C,isProcessingComplete:e.isProcessingComplete,isUploading:v,isEditView:Re,isGuest:Qe,favoritedBy:e.favoritedBy,approvedBy:e.approvedBy,onDeleteItem:function(){return tt(e)},itemType:e.itemType,publicId:l,portalId:g,reviewId:G,canApprove:"APPROVE"===(null===Fe||void 0===Fe?void 0:Fe.actionType),canFavorite:"FAVORITE"===(null===Fe||void 0===Fe?void 0:Fe.actionType),isFavorited:Xe(l),isApproved:Ke(l),isActionRequestSubmitted:$e,isOwnerView:"OWNER"===Be,onUpdateAction:rt,fileType:m,numberOfComments:c,commentsEnabled:null===Fe||void 0===Fe?void 0:Fe.commentsEnabled,isActionConfirmedUponAsset:I,children:(0,j.jsx)(us,{reviewItem:e,isLoading:ot(e),isDownloadEnabled:null===Fe||void 0===Fe?void 0:Fe.downloadEnabled,isFirstItem:0===t,isEditView:Re,isOwnerView:"OWNER"===Be,onDeleteItem:function(){return tt(e)},onDownloadItem:function(){return it({reviewItemId:l,fileName:u,fileType:m})},canDownloadReviewItems:null===Fe||void 0===Fe?void 0:Fe.downloadEnabled,isActionConfirmedUponAsset:I})}),(0,j.jsx)("div",{className:d()(vs.notesContainer,"GRID"===xe&&vs.hidden,!e.note&&!Re&&vs.hidden),children:(0,j.jsx)($a,{id:e.publicId,identity:Be,note:e.note,isEditing:Re,focusNotesInDetails:function(){return se(!0)}})})]},l)}))}),ne&&pe&&(0,j.jsx)(Vr.s,{numberOfComments:null!==(h=null===(w=_e[pe.publicId])||void 0===w?void 0:w.totalCount)&&void 0!==h?h:0,onConfirm:function(){et(pe),Je()},onDismiss:Je}),ue&&(0,j.jsx)(Ua,{autofocusComments:b,portalId:g,reviewId:G,reviewItems:Ne,review:Fe,viewerIdentity:Be,isFavorited:Xe,isApproved:Ke,onOpenIdentificationModal:N,onSetCommentAutofocus:T,onAction:rt,isGuest:Qe,user:Se,team:De,portal:Ve,guestTokenId:Me,onClose:function(){return se(!1)},focusNoteInputField:ae,hasPublished:C})]})}var _s=(0,Gi.Ps)(ds||(ds=(0,Wi.Z)(["\n  mutation UpdateReviewMutation($id: String!, $attributes: ReviewAttributes!) {\n    updateReview(id: $id, attributes: $attributes) {\n      review {\n        publicId\n        title\n        description\n        layoutType\n        actionType\n        downloadEnabled\n        password\n        passwordProtected\n        dueDate\n        createdAt\n        updatedAt\n        reviewCollectionId\n        stormMutationToken\n        status\n        teamId\n        stats {\n          viewCount\n          downloadCount\n          totalActionCount\n          completedActionCount\n        }\n      }\n      errors\n    }\n  }\n"])));function hs(){var e=(0,Hi.Db)(_s),t=(0,s.Z)(e,2),n=t[0],i=n.data,r=n.fetching,o=t[1],a=(0,m.useCallback)((function(e){return o(e,{additionalTypenames:["ReviewCollection"]})}),[o]);return{review:null===i||void 0===i?void 0:i.updateReview.review,isUpdatingReview:r,updateReview:a}}var ws=n(83868);function gs(e){var t,n=null===e||void 0===e?void 0:e.sort((function(e,t){return(0,ws.Z)(new Date(String(e.completedAt)),new Date(String(t.completedAt)))}));return null!==(t=null===n||void 0===n?void 0:n[0])&&void 0!==t?t:null}var Is,bs,xs=n(61173),Cs=n(25984),Es=(0,Gi.Ps)(Is||(Is=(0,Wi.Z)(["\n  mutation BatchDeleteActionRequest($id: String!) {\n    deleteActionRequest(id: $id) {\n      actionRequest {\n        publicId\n      }\n    }\n  }\n"])));var ys=(0,Gi.Ps)(bs||(bs=(0,Wi.Z)(["\n  mutation BatchUpdateActionRequest(\n    $reviewId: String!\n    $attributes: [UpdateActionRequestAttributes!]!\n  ) {\n    batchUpdateActionRequest(reviewId: $reviewId, attributes: $attributes) {\n      actionRequests {\n        publicId\n      }\n    }\n  }\n"])));var Ts=n(3404),Ns=n(10806),Rs=n(86207),As=n(63546),js={container:"EditorToolbar_container__Ylnf5",group:"EditorToolbar_group__4JCS6",begin:"EditorToolbar_begin__WJuBO",end:"EditorToolbar_end__WtiNl",actionMenu:"EditorToolbar_actionMenu__mY30r",menuButtonAction:"EditorToolbar_menuButtonAction__tKHDQ",icon:"EditorToolbar_icon__sk9Vg",disabled:"EditorToolbar_disabled__Cz61e",baseButton:"EditorToolbar_baseButton__bpJ8i",open:"EditorToolbar_open__tZHpu",activated:"EditorToolbar_activated__ieyCN",menuPopover:"EditorToolbar_menuPopover__+Ielm",offset:"EditorToolbar_offset__+qJtM",menuItem:"EditorToolbar_menuItem__RvfYh",content:"EditorToolbar_content__OeTAi",singleLine:"EditorToolbar_singleLine__aOZiI",title:"EditorToolbar_title__5Nvc3",iconContainer:"EditorToolbar_iconContainer__tTAOC",toggleContainer:"EditorToolbar_toggleContainer__W8cta",hover:"EditorToolbar_hover__8+E8C",popover:"EditorToolbar_popover__3dXPy"},ks="ActionDropdown_actionsList__rzdfM",Ds=["children"];function Ss(e){var t=e.actionType,n=void 0===t?"DEFAULT":t,i=e.actionTypeIsLocked,r=e.disabled,o=e.onUpdateActionType,l=(0,p.$G)().t,c=(0,m.useState)(!1),u=(0,s.Z)(c,2),v=u[0],f=u[1],_=(0,m.useState)(!1),h=(0,s.Z)(_,2),w=h[0],g=h[1],b=(0,m.useState)(!1),C=(0,s.Z)(b,2),E=C[0],y=C[1],T="DEFAULT";n&&(T=n);var N={DEFAULT:l("editReview.request_action"),VIEW:l("editReview.view_items"),DOWNLOAD:l("editReview.download_items"),FAVORITE:l("editReview.star_items"),APPROVE:l("editReview.approve_items")},R=d()(js.menuItem,js.hover),A=function(){i&&f(!0)},k=function(){i&&f(!1)},D=function(e){"FAVORITE"===e&&g(!0),"APPROVE"===e&&y(!0)},S=function(e){"FAVORITE"===e&&g(!1),"APPROVE"===e&&y(!1)},Z={FAVORITE:w?I.Rh:I.OE,APPROVE:E?I.Th:I.EC},O=(0,m.forwardRef)((function(e,t){e.children;var s=(0,_e.Z)(e,Ds),c=(0,dn.uF)().isExpanded,u={DEFAULT:I.Bj,VIEW:I.sG,DOWNLOAD:I.Cz,FAVORITE:I.Bj,APPROVE:I.ED},m=d()(js.baseButton,i&&js.disabled,r&&js.disabled,c&&js.open,"DEFAULT"!==T&&js.activated),p=d()(js.menuButtonAction,i&&js.disabled);return(0,j.jsxs)("div",{className:js.actionMenu,children:[i?(0,j.jsx)(ie.J,{arrowColor:"#161616",positions:["bottom"],isShowing:v,target:(0,j.jsx)(x.LE,(0,a.Z)((0,a.Z)({},s),{},{onMouseEnter:A,onMouseLeave:k,appearance:"secondary",className:m,ref:t,size:"small",type:"button",children:(0,j.jsx)(Re.k,{icon:u[T],space:"small",size:"regular",children:(0,j.jsx)("span",{className:js.btnLabel,children:N[n]})})})),children:(0,j.jsx)("div",{className:js.popover,children:l("editReview.review_in_progress")})}):(0,j.jsx)(x.LE,(0,a.Z)((0,a.Z)({},s),{},{onMouseEnter:A,onMouseLeave:k,appearance:"secondary",className:m,ref:t,size:"small",type:"button",children:(0,j.jsx)(Re.k,{icon:u[n],space:"small",size:"regular",children:(0,j.jsx)("span",{className:js.btnLabel,children:N[n]})})})),"DEFAULT"!==n&&(0,j.jsx)(x.LE,{onMouseEnter:A,onMouseLeave:k,appearance:"secondary",size:"small",type:"button",className:p,onClick:function(){return o("DEFAULT")},children:(0,j.jsx)(I.x8,{className:js.icon})})]})}));return(0,j.jsxs)(Ts.v,{children:[(0,j.jsx)(dn.j2,{as:O,"data-test-id":"actionType",children:N[n]}),(0,j.jsx)(As.Y,{title:l("editReview.request_action_title"),align:"center",className:js.menuPopover,children:(0,j.jsxs)(Rs.s,{className:d()(js.menuItems,ks),children:[(0,j.jsx)(Ns.s,{onSelect:function(){return o("FAVORITE")},onMouseEnter:function(){return D("FAVORITE")},onMouseLeave:function(){return S("FAVORITE")},className:R,"data-test-id":"editReview.star_items",children:(0,j.jsx)(Re.k,{icon:Z.FAVORITE,space:"medium",size:"regular",children:(0,j.jsxs)("div",{className:js.content,children:[(0,j.jsx)("span",{className:js.title,children:l("editReview.star_items")}),(0,j.jsx)("span",{className:js.description,children:l("editReview.star_items_desc")})]})})}),(0,j.jsx)(Ns.s,{onSelect:function(){return o("APPROVE")},onMouseEnter:function(){return D("APPROVE")},onMouseLeave:function(){return S("APPROVE")},className:R,"data-test-id":"editReview.approve_items",children:(0,j.jsx)(Re.k,{icon:Z.APPROVE,space:"medium",size:"regular",children:(0,j.jsxs)("div",{className:js.content,children:[(0,j.jsx)("span",{className:js.title,children:l("editReview.approve_items")}),(0,j.jsx)("span",{className:js.description,children:l("editReview.approve_items_desc")})]})})})]})})]})}var Zs=n(42667),Os=n(77176),Ms={container:"MultipleTextInput_container__dPS1T",background:"MultipleTextInput_background__-tJ++",error:"MultipleTextInput_error__e1INc",info:"MultipleTextInput_info__YBxLD",disabled:"MultipleTextInput_disabled__XNRHa",inputBackground:"MultipleTextInput_inputBackground__GkVQ4",input:"MultipleTextInput_input__jev8g",listContainer:"MultipleTextInput_listContainer__dg9Ax",list:"MultipleTextInput_list__FMhha",listItem:"MultipleTextInput_listItem__826pC",moreAction:"MultipleTextInput_moreAction__rTW53",moreActionText:"MultipleTextInput_moreActionText__JZ-Cq",addIcon:"MultipleTextInput_addIcon__KhNhh"},Ps=["value","separator","status","disabled","maxNumberOfValuesToRender","useList","focusLabel","isValid","isUnique","renderMoreButtonText","onChange","onInputChange"];function Ls(e){var t=e.value,n=void 0===t?"":t,i=e.separator,o=void 0===i?",":i,l=e.status,c=e.disabled,u=e.maxNumberOfValuesToRender,v=void 0===u?3:u,p=e.useList,f=void 0===p||p,_=(e.focusLabel,e.isValid),h=void 0===_?function(){return!0}:_,w=e.isUnique,b=void 0===w?function(){return!0}:w,x=e.renderMoreButtonText,C=void 0===x?function(e){return"".concat(e)}:x,E=e.onChange,y=e.onInputChange,T=(0,_e.Z)(e,Ps),N=(0,m.useState)(""),R=(0,s.Z)(N,2),A=R[0],k=R[1],D=(0,m.useState)(!1),S=(0,s.Z)(D,2),Z=S[0],O=S[1],M=(0,g.Z)(),P=(0,s.Z)(M,2),L=P[0],V=P[1].height,F=(0,m.useRef)(null),B=(0,m.useRef)(null),U=(0,m.useRef)(null),W=n.length>0,G=Z&&T.label||void 0,H=!Z&&T.placeholder||void 0;function q(){var e=null===A||void 0===A?void 0:A.trim();if(e){var t=null;h(e)||(t="invalid"),b(e)||(t="duplicate");var i="".concat(n).concat(W?o:"").concat(e);null===E||void 0===E||E({value:i,error:t}),null===t&&k("")}}function z(e){var t,i=null!==(t=n.split(o).filter((function(t){return!(0,xs.$)(t,e)})).join(o))&&void 0!==t?t:"";null===E||void 0===E||E({value:i,error:null})}var Y=W?n.split(o):[],$=Y.length,K=$>v&&!Z,X=K?Y.slice(0,v):Y,Q=K?$-v:0,J=d()(Ms.background,l&&Ms[l],(0,r.Z)({},Ms.disabled,c)),ee=(0,$o.ZI)(),te=(0,$o.q_)({height:$>0?V:0,ref:ee,config:{duration:200,easing:$o.Z5.easeOutCubic}}),ne=(0,$o.ZI)(),ie=(0,$o.Yz)(X,{from:{opacity:0},enter:{opacity:1},ref:ne}),re=(0,$o.ZI)(),oe=(0,$o.q_)({to:{opacity:1},from:{opacity:0},ref:re});return(0,$o.Ab)([ee,ne,re],[0,0,.1]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:Ms.container,ref:F,onBlur:function(e){var t;null!==(t=F.current)&&void 0!==t&&t.contains(e.relatedTarget)||(O(!1),q())},onFocus:function(){var e;O(!0),document.activeElement===U.current&&(null===(e=B.current)||void 0===e||e.focus())},children:[(0,j.jsx)(Os.o,(0,a.Z)((0,a.Z)({},T),{},{ref:B,value:A,inputClassName:Ms.input,backgroundClassName:Ms.inputBackground,label:G,placeholder:H,status:l,disabled:c,onChange:function(e){var t=e.target.value.replace(o,"");k(t),null===y||void 0===y||y(e)},onKeyDown:function(e){switch(e.key){case"Enter":case o:q()}}})),(0,j.jsx)("div",{className:J})]}),f&&(0,j.jsx)($o.q.div,{style:te,children:$>0&&(0,j.jsx)("div",{className:Ms.listContainer,ref:L,children:(0,j.jsxs)("ul",{className:Ms.list,children:[ie((function(e,t){var n=e.opacity;return(0,j.jsx)($o.q.li,{style:{opacity:n},className:Ms.listItem,children:(0,j.jsx)(Zs.D,{actionIcon:I.x8,onClick:function(){var e;z(t),null===(e=B.current)||void 0===e||e.focus()},"data-test-id":"multipleTextInput.item",title:t,children:t})})})),Q>0&&(0,j.jsx)($o.q.li,{className:Ms.listItem,style:oe,children:(0,j.jsx)("button",{onClick:function(){var e;O(!0),null===(e=B.current)||void 0===e||e.focus()},className:Ms.moreAction,ref:U,"data-test-id":"multipleTextInput.moreButton",children:(0,j.jsx)(Zs.D,{className:Ms.moreActionText,children:C(Q)})})})]})})})]})}var Vs=n(78687),Fs=n(15307),Bs={container:"AssigneesDropdown_container__PO5wP",subTitle:"AssigneesDropdown_subTitle__AfKoE",assigneeContainer:"AssigneesDropdown_assigneeContainer__l1k3w",assigneeItem:"AssigneesDropdown_assigneeItem__VoTpR",icon:"AssigneesDropdown_icon__szN2M",email:"AssigneesDropdown_email__k2gk-",resetButton:"AssigneesDropdown_resetButton__hks4R"},Us=["children"];function Ws(e){var t=e.list,n=void 0===t?[]:t,i=e.onClick;return 0===n.length?null:(0,j.jsx)("div",{className:Bs.assigneeContainer,children:n.map((function(e){return(0,j.jsxs)("div",{className:Bs.assigneeItem,children:[(0,j.jsx)("div",{className:Bs.icon,children:(0,j.jsx)(I.uS,{})}),(0,j.jsx)("div",{className:Bs.email,children:e.email}),(0,j.jsx)("div",{children:(0,j.jsx)(Vs.G,{as:"button",className:Bs.resetButton,onClick:function(){return i(e.publicId)},"data-test-id":"remove.reviewer.button ".concat(e.email),children:(0,j.jsx)(I.x8,{})})})]},e.publicId)}))})}function Gs(e){var t=e.existingActionRequests,n=void 0===t?[]:t,i=e.prePublishEmailList,r=void 0===i?[]:i,o=e.dueDate,l=e.disabled,c=e.onRemoveAssignee,u=e.onRemoveAssigneeList,v=e.onEmailListChange,f=(0,p.$G)().t,_=(0,m.useState)(),h=(0,s.Z)(_,2),w=h[0],g=h[1],b=(0,m.useState)(""),C=(0,s.Z)(b,2),E=C[0],y=C[1],T=(0,m.useMemo)((function(){return r.map((function(e){return{email:e,publicId:e}}))}),[r]),N=n.length+r.length,R=(0,m.forwardRef)((function(e,t){e.children;var n=(0,_e.Z)(e,Us),i=(0,dn.uF)().isExpanded;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(x.LE,(0,a.Z)((0,a.Z)({},n),{},{appearance:"secondary",className:d()(js.baseButton,N>0&&js.activated,l&&js.disabled,i&&js.open),ref:t,size:"small",type:"button",children:(0,j.jsx)(Re.k,{icon:I.uS,space:"small",size:"regular",children:f("review.assignee.button",{count:N})})})),N>0&&(0,j.jsx)(x.LE,{appearance:"secondary",size:"small",type:"button",className:d()(js.menuButtonAction),onClick:u,"data-test-id":"remove.assignees.button",children:(0,j.jsx)(I.x8,{className:Bs.icon})})]})})),A=function(){""!==E&&y(""),void 0!==w&&g(void 0)};return(0,j.jsx)("div",{className:js.actionMenu,children:(0,j.jsxs)(Ts.v,{children:[(0,j.jsx)(dn.j2,{as:R,children:"Assign"}),(0,j.jsx)(As.Y,{title:"Assign this review",align:"center",className:js.menuPopover,children:(0,j.jsx)(Rs.s,{children:(0,j.jsxs)("div",{className:Bs.container,children:[(0,j.jsx)("p",{className:Bs.subTitle,children:f(o?"review.assignee.due_date":"review.assignee.no_due_date")}),(0,j.jsx)("div",{className:Bs.emailField,children:(0,j.jsx)(Ls,{className:Bs.emailInput,onChange:function(e){var t=e.value;switch(e.error){case null:null===v||void 0===v||v(t.length>0?t.split(","):[]),A();break;case"invalid":y(f("error.reviewer_email_invalid_error")),g("error");break;case"duplicate":y(f("error.reviewer_email_already_added_error")),g("info")}},onInputChange:function(e){e.target.value.includes(",")||A()},label:f("review.email_label"),placeholder:f("review.email_placeholder"),status:w,hint:E,isValid:function(e){return(0,Fs.J)(e)},isUnique:function(e){return!n.map((function(e){return e.email})).concat(r).find((function(t){return(0,xs.$)(t,e)}))},useList:!1,separator:",","data-test-id":"reviewer.emailAddress.input",type:"email"})}),Boolean(T.length)&&(0,j.jsx)(Ws,{list:T,onClick:c}),Boolean(n.length)&&(0,j.jsx)(Ws,{list:n,onClick:c})]})})})]})})}var Hs=n(59513),qs=n.n(Hs),zs=(n(68639),n(54690)),Ys=n(39579),$s=n(65319),Ks=n(91951),Xs=n(61537),Qs=n(24424),Js=n(61518),el=n(52074),tl="h:mmaaa",nl="HH:mm",il="17:00",rl="MMM d 'at' h:mmaaa";function ol(e){return e?(0,Ks.default)(new Date(e),tl):""}function al(e){if(!e)return{hours:0,min:0};var t=e.split(/,|:/);return{hours:parseInt(t[0]),min:parseInt(t[1])}}function sl(e){var t=new Date,n=(0,Xs.default)(e),i=(0,Xs.default)(t),r=(0,Qs.default)(t);if(n<17)return il;if(r<30){var o=t.setHours(i,0,0),a=(0,Js.default)(o,30);return(0,Ks.default)(a,nl)}if(r>30){var s=t.setHours(i,0,0),l=(0,el.default)(s,1);return(0,Ks.default)(l,nl)}return il}var ll=n(13029);var cl="Time_container__qVHZe",ul="Time_input__f3snd",dl="Time_open__raBaq",vl="Time_disabled__cTqTb",ml="Time_time__bOuoL",pl="Time_box__-SNPR",fl="Time_item__X9mqS",_l="Time_selected__9rc4A";function hl(e){var t,n=e.step,i=e.onSelect,o=e.time,l=e.disabled,c=e.setOverlay,u=e.preSelection,v=e.timeLabel,p=(0,m.useState)(!1),f=(0,s.Z)(p,2),_=f[0],h=f[1];(0,m.useEffect)((function(){if(o){var e=function(e){if(!e)return{hours:"0",mins:"0"};var t=e.slice(-2),n=e.slice(0,-2),i=n.split(":"),r=(0,s.Z)(i,1)[0];return"12"===r&&(r="00"),"pm"===t&&(r="".concat(parseInt(r,10)+12)),{hours:r,mins:n.split(":")[1]}}(o),t=e.hours,n=e.mins;i("".concat(t,":").concat(n))}}),[o]);var w=function(){h(!1),c(!1)},g=K((function(){return w()})).ref,b=function(){h(!_),c(!_)},x=function(e){i(e),w()},C=d()(ul,(t={},(0,r.Z)(t,dl,_),(0,r.Z)(t,vl,l),t));return(0,j.jsxs)("div",{className:cl,children:[(0,j.jsx)("span",{children:v}),(0,j.jsx)(Os.o,{type:"text",readOnly:!0,className:C,prefix:(0,j.jsx)(I.qp,{size:"small"}),onClick:b,onChange:function(e){return function(e){var t=e.target.value;i(t)}(e)},onKeyDown:function(e){return function(e){var t;"Enter"===e.key&&(h(!0),c(!0),null===g||void 0===g||null===(t=g.current)||void 0===t||t.focus())}(e)},value:o,disabled:l,placeholder:"",tabIndex:l?-1:0}),(0,j.jsx)("div",{className:d()(ml,(0,r.Z)({},vl,l)),onClick:b,"data-test-id":"time.click.handler"}),_&&(0,j.jsx)($s.ZP,{className:d()(pl,(0,r.Z)({},dl,_)),children:(0,j.jsx)("div",{ref:g,children:function(){var e=function(e){var t=(new Date).setHours(0,0),n=(new Date).setHours(24,0);return(0,ll.Z)({start:t,end:n},{step:e}).slice(0,-1).map((function(e){return{display:(0,Ks.default)(new Date(e),tl),input:(0,Ks.default)(new Date(e),nl)}}))}(n),t=(0,zs.default)(new Date(new Date),new Date(new Date(u)));return e.map((function(e){var n,i=e.display,s=e.input,l=al(s),c=l.hours,v=l.min,p=t&&(0,Ys.default)(new Date((new Date).setHours(c,v,0)),new Date(u.setHours((new Date).getHours(),(new Date).getMinutes(),0)));return(0,m.createElement)("div",(0,a.Z)((0,a.Z)({},function(){if(o===i)return(0,a.Z)((0,a.Z)({},{}),{},{"data-autofocus":!0})}()),{},{key:i,className:d()(fl,(n={},(0,r.Z)(n,_l,o===i),(0,r.Z)(n,vl,p),n)),onClick:function(){return x(s)},tabIndex:p?-1:0,onKeyDown:function(e){return"Enter"===e.key&&x(s)}}),(0,j.jsx)("time",{dateTime:s,children:i}))}))}()})})]})}var wl="Calendar_container__1w0cC",gl="Calendar_overlay__1Wvw4",Il="Calendar_show__f8apD",bl="Calendar_submitButton__3HJtY",xl=["children","renderSubmit","value","time","preSelection","step","disabled","inputValue","timeLabel","onTimeSelect"];function Cl(e){var t,n,i=e.children,o=e.renderSubmit,l=e.value,c=e.time,u=e.preSelection,v=e.step,p=e.disabled,f=e.inputValue,_=e.timeLabel,h=e.onTimeSelect,w=(0,_e.Z)(e,xl),g=(0,m.useRef)(null),I=(0,m.useState)(!1),b=(0,s.Z)(I,2),x=b[0],C=b[1],E=(t=f?new Date(f):null,n=new Date(l),!(!t||!n)&&new Date(t.setSeconds(0)).getTime()===new Date(n.setSeconds(0)).getTime()),y=(0,a.Z)({ref:g,className:bl,disabled:E},w);(0,m.useEffect)((function(){p&&C(!0)}),[p]);return(0,j.jsxs)("div",{className:wl,children:[(0,j.jsx)("div",{className:d()(gl,(0,r.Z)({},Il,x))}),(0,j.jsx)(Hs.CalendarContainer,{className:"react-datepicker",children:i}),(0,j.jsx)(hl,{onSelect:function(e){return h(e)},timeLabel:_,time:c,step:v,setOverlay:function(e){return C(e)},preSelection:u,disabled:p}),o({date:l?new Date(l).toISOString():"",props:y})]})}var El=n(62942),yl=n(31641),Tl=n(13830),Nl=n(74890),Rl=n(19736),Al=n(68460),jl=n(8770),kl=n(79939),Dl=n(89505),Sl=n(69016),Zl=n(94612);function Ol(e){var t=e.month,n=e.locale;if(!t)return"";var i={en:El.Z,de:yl.Z,es:Tl.Z,fr:Nl.Z,it:Rl.Z,nb:Al.Z,nl:jl.Z,pt:kl.Z,sv:Dl.Z,tr:Sl.Z,da:Zl.Z};return(0,Ks.default)(t,"MMMM yyyy",{locale:i[n]})}var Ml="Header_header__nMeds",Pl="Header_button__xw-bJ",Ll="Header_month__6U3Ua";function Vl(e){var t=e.decreaseMonth,n=e.increaseMonth,i=e.date,r=e.locale;return(0,j.jsxs)("div",{className:Ml,children:[(0,j.jsx)(x.hU,{size:"regular",onClick:t,className:Pl,children:(0,j.jsx)(I.s$,{})}),(0,j.jsx)("div",{className:Ll,children:"".concat(Ol({month:i,locale:r}))}),(0,j.jsx)(x.hU,{size:"regular",onClick:n,className:Pl,children:(0,j.jsx)(I._Q,{})})]})}var Fl=n(59831);function Bl(e,t,n,i){if(!e)return"";var r={en:El.Z,de:yl.Z,es:Tl.Z,fr:Nl.Z,it:Rl.Z,nb:Al.Z,nl:jl.Z,pt:kl.Z,sv:Dl.Z,tr:Sl.Z,da:Zl.Z},o=i||"MMM d, yyyy",a=new Date(e);if(n){var s=al(n),l=s.hours,c=s.min;a=new Date((0,Fl.default)(e).setHours(l,c)),o=i||rl}return(a.getHours()||a.getMinutes())&&(o=i||rl),(0,Ks.default)(a,o,{locale:r[t]})}var Ul={name:"sameWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;t.styles.popper.width="".concat(t.rects.reference.width,"px")},effect:function(e){var t=e.state;t.elements.popper.style.width="".concat(t.elements.reference.offsetWidth,"px")}};function Wl(e){var t=e.calendarOpen,n=e.renderSubmit,i=e.disabled,r=void 0!==i&&i,o=e.step,a=void 0===o?30:o,l=e.placeholder,c=void 0===l?"":l,u=e.value,d=void 0===u?null:u,v=e.locale,p=void 0===v?"en":v,f=e.timeLabel,_=void 0===f?"Time":f,h=e.input,w=e.portalId,g=void 0===w?"calendar-container":w,I=e.offsetPopper,b=void 0===I?0:I,x=e.handleCalendarClose,C=void 0===x?function(){}:x,E=e.handleCalendarOpen,y=void 0===E?function(){}:E,T=(0,m.useState)(d?new Date(d):new Date),N=(0,s.Z)(T,2),R=N[0],A=N[1],k=(0,m.useState)(""),D=(0,s.Z)(k,2),S=D[0],Z=D[1],O=(0,m.useRef)(null);(0,m.useEffect)((function(){if(!d)return Z(sl(new Date));Z(ol(new Date(d)))}),[]),(0,m.useEffect)((function(){(function(e){var t=new Date;return(0,zs.default)(t,e)&&(0,Ys.default)(e,t)})(R)&&Z(sl(R))}),[R]),(0,m.useEffect)((function(){var e=al(S),t=e.hours,n=e.min;A(new Date(R.setHours(t,n,0)))}),[S]),(0,m.useEffect)((function(){A(d?new Date(d):new Date(R)),C()}),[d]);var M=(0,m.useCallback)((function(){return C(),A(d?new Date(d):new Date(R))}),[C,d,R]),P=function(e){return Z(e)},L=(0,m.useCallback)((function(){var e;if(t)return C();if(!d){var n,i=al(sl(new Date)),r=i.hours,o=i.min,a=new Date((new Date).setHours(r,o,0));return null===(n=O.current)||void 0===n||n.setPreSelection(a),A(a),y()}null===(e=O.current)||void 0===e||e.setPreSelection(R),y()}),[t,d,R,y,C]);return(0,j.jsx)(qs(),{open:t,ref:O,shouldCloseOnSelect:!1,useWeekdaysShort:!0,minDate:new Date,selected:R,placeholderText:c,value:Bl(d,p),onSelect:function(e){var t=al(S),n=t.hours,i=t.min;A(new Date(e.setHours(n,i,0)))},customInput:h({value:Bl(d,p),placeholder:c}),renderCustomHeader:function(e){var t=e.decreaseMonth,n=e.increaseMonth,i=e.date;return(0,j.jsx)(Vl,{decreaseMonth:t,increaseMonth:n,date:i,locale:p})},onInputClick:L,onCalendarClose:M,calendarContainer:(0,m.useCallback)((function(e){var t,i=e.children;return(0,j.jsx)(Cl,{value:R,time:ol(R),inputValue:d,renderSubmit:n,children:i,step:a,preSelection:(null===(t=O.current)||void 0===t?void 0:t.state.preSelection)||new Date,disabled:r,timeLabel:_,onTimeSelect:P,onClose:C})}),[R,n]),popperPlacement:"bottom-end",popperModifiers:[Ul,{name:"offset",options:{offset:function(e){var t=e.reference.width/2,n=0;return d&&(n=b),[-t+n,0]}}},{name:"preventOverflow",options:{tether:!1}}],portalId:g})}var Gl=n(87506),Hl="DueDateConfirmModal_header__XSPy7",ql="DueDateConfirmModal_text__geeOD",zl="DueDateConfirmModal_textTitle__LeRZT",Yl="DueDateConfirmModal_textBody__qmQrX",$l="DueDateConfirmModal_bold__guGbA",Kl="DueDateConfirmModal_buttonContainer__2j8D6",Xl="DueDateConfirmModal_button__E8pP4",Ql=["onDismiss","onPublish","originalDate","dueDate"];function Jl(e){var t=e.onDismiss,n=e.onPublish,i=e.originalDate,r=e.dueDate,o=(0,_e.Z)(e,Ql),s=(0,p.$G)().t,l=(0,m.useMemo)((function(){return s(i?"editReview.due_date_confirm.title_edit":"editReview.due_date_confirm.title")}),[i]),c=(0,m.useMemo)((function(){return s(i?"editReview.due_date_confirm.save_edit":"editReview.due_date_confirm.save")}),[i]);return(0,j.jsxs)(Qe.u,(0,a.Z)((0,a.Z)({ariaLabel:l},o),{},{children:[(0,j.jsx)("header",{className:Hl,"data-test-id":"editReview.due_date_confirm.title",children:(0,j.jsx)("h1",{className:d()(zl,ql),children:l})}),(0,j.jsx)("p",{className:d()(Yl,ql),children:function(e){if(e){var t=new Date(e),n=(0,ee.BF)(t).dayMonth,i=(0,ee.gU)(new Date(t),"h:mmaaa").returnedDateFormat,r=(0,ee.$r)(t,"MM-d"),o=(0,ee.$r)(t,"HH:mm");return(0,j.jsx)(p.cC,{i18nKey:"editReview.due_date_confirm.due_date",values:{dayMonth:n,time:i},components:[(0,j.jsx)("time",{dateTime:r,className:$l}),(0,j.jsx)("time",{dateTime:o,className:$l})]})}}(r)}),(0,j.jsxs)("div",{className:Kl,children:[(0,j.jsx)(x.LE,{className:Xl,appearance:"primary","data-test-id":"editReview.due_date_confirm.save",onClick:n,children:c}),(0,j.jsx)(x.LE,{appearance:"secondary","data-test-id":"editReview.due_date_confirm.cancel",onClick:t,className:Xl,children:s("editReview.due_date_confirm.cancel")})]})]}))}var ec="DueDateDeleteModal_header__2Bk3j",tc="DueDateDeleteModal_text__b6xUq",nc="DueDateDeleteModal_textTitle__9k+FZ",ic="DueDateDeleteModal_textBody__6roNP",rc="DueDateDeleteModal_buttonContainer__gzw1J",oc="DueDateDeleteModal_button__PXImA",ac=["onDismiss","onDelete"];function sc(e){var t=e.onDismiss,n=e.onDelete,i=void 0===n?function(){}:n,r=(0,_e.Z)(e,ac),o=(0,p.$G)().t;return(0,j.jsxs)(Qe.u,(0,a.Z)((0,a.Z)({ariaLabel:o("editReview.due_date_delete.title")},r),{},{children:[(0,j.jsx)("div",{className:ec,"data-test-id":"editReview.due_date_delete.title",children:(0,j.jsx)("p",{className:d()(nc,tc),children:o("editReview.due_date_delete.title")})}),(0,j.jsx)("p",{className:d()(ic,tc),children:o("editReview.due_date_delete.description")}),(0,j.jsx)("p",{className:d()(ic,tc),children:o("editReview.due_date_delete.instruction")}),(0,j.jsxs)("div",{className:rc,children:[(0,j.jsx)(x.LE,{className:oc,appearance:"primary","data-test-id":"editReview.due_date_delete.delete",onClick:i,children:o("editReview.due_date_delete.delete")}),(0,j.jsx)(x.LE,{appearance:"secondary","data-test-id":"editReview.due_date_delete.cancel",onClick:t,className:oc,children:o("editReview.due_date_delete.cancel")})]})]}))}var lc="DueDateDropdown_container__Z1ZKG",cc="DueDateDropdown_menuButtonAction__N-Zs9",uc="DueDateDropdown_overdue__OvqDY",dc="DueDateDropdown_icon__8+++j",vc="DueDateDropdown_destructiveButton__2jBJP",mc="DueDateDropdown_description__LdSkf";function pc(e){var t=e.dueDate,n=e.reviewId,i=e.disabled,l=e.hasPublished,u=e.notifyUser,v=void 0!==u&&u,_=e.lastReviewCompletedAt,h=void 0===_?null:_,w=e.assigneesCount,g=void 0===w?0:w,b=e.review,C=e.portal,E=(0,m.useState)(t),y=(0,s.Z)(E,2),T=y[0],N=y[1],R=(0,m.useState)(!1),A=(0,s.Z)(R,2),k=A[0],S=A[1],Z=(0,m.useState)(!1),O=(0,s.Z)(Z,2),M=O[0],P=O[1],V=(0,L.T)().restrictActionWithModal,F=v?null:h,U=hs().updateReview,W=(0,p.$G)().t,G=(0,B.Fn)(),H=G.fireErrorEvent,q=G.fireGroupIdentifySet,z=(0,m.useContext)(X.X).reviewItems,Y=(0,zi.B)(n).actionRequests,$=(0,f.v9)(sr.BX),K=(0,f.v9)(lr.HF),Q=(0,m.useMemo)(ln.q,[]),J=(0,f.v9)((function(e){return Q(e,n)})),te=(0,f.v9)(kt.v9),ne=(0,m.useCallback)((function(e){var t=e.dueDate;if($&&b&&"DRAFT"!==b.status){var n,i=null!==(n=Y.filter((function(e){return"ASSIGNED"===e.engagementType})).length)&&void 0!==n?n:0;(0,Gl.gk)({review:b,reviewItems:z,numberOfAssignedReviewers:i,portal:C,team:$,userId:(null===K||void 0===K?void 0:K.sub)||"",comments:J,tier:te,dueDate:t})}}),[Y,J,C,b,z,$,te,null===K||void 0===K?void 0:K.sub]);(0,m.useEffect)((function(){N(t)}),[t]);var ie=(0,m.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U({id:n,attributes:{dueDate:t}});case 2:if(!(i=e.sent).error){e.next=7;break}return(0,D.t6)({message:W("error.due_date_error"),type:"error"}),H("error.due_date_error"),e.abrupt("return",{error:"DUE_DATE_ERROR"});case 7:return q({groupType:B.YT.REVIEW,groupName:n,propertyValues:(0,r.Z)({},B.vb.DUE_DATE_ENABLED,!!t)}),ne({dueDate:t}),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[q,ne,n,W,U,H]),re=function(){var e=(0,o.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N(t),!l||!v){e.next=5;break}S(!0),e.next=10;break;case 5:return e.next=7,ie(t);case 7:if(!e.sent.error){e.next=10;break}return e.abrupt("return",N(t));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=2;break}return e.abrupt("return");case 2:return S(!1),e.next=5,ie(T);case 5:if(!e.sent.error){e.next=8;break}return e.abrupt("return",N(t));case 8:case"end":return e.stop()}}),e)}))),[T,t,ie]),ae=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(T){e.next=2;break}return e.abrupt("return");case 2:return P(!1),e.next=5,ie(null);case 5:if(!e.sent.error){e.next=8;break}return e.abrupt("return",N(t));case 8:N(null);case 9:case"end":return e.stop()}}),e)}))),[T,t,ie]),se=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!v){e.next=4;break}P(!0),e.next=10;break;case 4:return e.next=6,ie(null);case 6:if(!e.sent.error){e.next=9;break}return e.abrupt("return",N(t));case 9:return e.abrupt("return",N(null));case 10:case"end":return e.stop()}}),e)}))),[v,ie,t]),le=(0,m.useState)(!1),ce=(0,s.Z)(le,2),ue=ce[0],de=ce[1],ve=(0,m.useCallback)((function(){return de(!1)}),[de]),me=(0,m.useCallback)((function(){return de(!0)}),[de]);return(0,j.jsxs)("div",{className:lc,children:[(0,j.jsx)(Wl,{calendarOpen:ue,value:T,placeholder:W("review.due_date.placeholder"),timeLabel:W("review.due_date.time_label"),offsetPopper:40,handleCalendarOpen:me,handleCalendarClose:ve,renderSubmit:function(e){var t=e.date,n=e.props;return(0,j.jsxs)(j.Fragment,{children:[n.disabled?(0,j.jsx)(x.LE,{className:vc,size:"small",appearance:"destructive-inverse",onClick:function(e){return V({restrictionType:"canUpdateReviews",analyticsEventName:"remove_duedate",onAccessGiven:se,onAccessRefused:function(){return e.preventDefault()}})},children:W("review.due_date.remove")}):(0,j.jsx)(x.LE,(0,a.Z)((0,a.Z)({},n),{},{size:"small",onClick:function(e){return V({restrictionType:"canUpdateReviews",analyticsEventName:"update_duedate",onAccessGiven:function(){return re(t)},onAccessRefused:function(){return e.preventDefault()}})},children:W("review.due_date.button")})),(0,j.jsx)("p",{className:mc,children:W(g>0?"review.due_date.description_assignee":"review.due_date.description_no_assignee")})]})},input:function(e){var n,o=e.value,a=e.placeholder;return(0,j.jsx)(x.LE,{appearance:"secondary",size:"small",className:d()(js.baseButton,(n={},(0,r.Z)(n,js.open,ue),(0,r.Z)(n,js.activated,T),(0,r.Z)(n,uc,(0,ee.Ax)(t,F)),(0,r.Z)(n,js.disabled,i),n)),children:(0,j.jsx)(Re.k,{icon:I.f,space:"small",size:"regular",className:d()(dc,(0,r.Z)({},uc,(0,ee.Ax)(t,F))),children:T?o:a})})}}),T&&(0,j.jsx)(x.LE,{appearance:"secondary",size:"small",type:"button",className:d()(js.menuButtonAction,cc),onClick:function(e){return V({restrictionType:"canUpdateReviews",analyticsEventName:"remove_duedate",onAccessGiven:se,onAccessRefused:function(){return e.preventDefault()}})},children:(0,j.jsx)(I.x8,{className:js.icon})}),k&&(0,j.jsx)(Jl,{onDismiss:function(){N(t),S(!1)},onPublish:oe,originalDate:t,dueDate:T}),M&&(0,j.jsx)(sc,{onDelete:ae,onDismiss:function(){P(!1)}})]})}function fc(e){var t=e.hasUploadedItems,n=e.onPublish,i=e.hasPublished,r=void 0!==i&&i,o=(0,p.$G)().t,a=(0,m.useContext)(_r.l).isUploadComplete,s=(0,m.useContext)(X.X).prePublishAssignee;return(0,j.jsx)(x.LE,{type:"button",size:"small",onClick:function(){return n(s)},disabled:!t||!a,"data-intercom-target":"editorToolbar.publishButton","data-test-id":"editReview.publish_review",children:o(r?"editReview.save_review":"editReview.publish_review")})}var _c=n(16335),hc="ToggleInput_toggleWrapper__8J+OO",wc="ToggleInput_toggleSwitch__an5+m",gc="ToggleInput_slider__TR8FQ",Ic="ToggleInput_checked__P4rnc",bc="ToggleInput_disabled__Vxw2l",xc="ToggleInput_checkbox__DlJCg";function Cc(e){var t,n=e.className,i=e.disabled,o=e.checked,a=e.value,s=void 0===a?"":a,l=e.onChange,c=e.id;return(0,j.jsxs)("div",{className:d()(hc,n),children:[(0,j.jsx)("input",{className:xc,type:"checkbox",id:c,value:s,disabled:i,checked:o,onChange:l,"data-test-id":"toggleInput.".concat(c)}),(0,j.jsx)("label",{htmlFor:hc,children:(0,j.jsx)("div",{className:d()(wc),children:(0,j.jsx)("span",{className:d()(gc,(t={},(0,r.Z)(t,bc,i),(0,r.Z)(t,Ic,o),t))})})})]})}var Ec={menuPopover:"SettingsDropdown_menuPopover__4z-d6",menupPopover:"SettingsDropdown_menupPopover__eJBfs",offset:"SettingsDropdown_offset__XudoP",menuItem:"SettingsDropdown_menuItem__7xYpL",icon:"SettingsDropdown_icon__AGv+d",iconItem:"SettingsDropdown_iconItem__wfVdY",menuContainer:"SettingsDropdown_menuContainer__CHrEv",menuItems:"SettingsDropdown_menuItems__cLtev",actionContainer:"SettingsDropdown_actionContainer__V0AO4",button:"SettingsDropdown_button__zWk8c"},yc=["children"];function Tc(e){var t=e.actionType,n=e.downloadEnabled,i=e.commentsEnabled,r=e.hasPublished,o=e.disabled,s=e.onUpdateCommentsEnabled,l=e.onUpdateDownloadEnabled,c=e.onDeleteReview,u=(0,p.$G)().t,v=(0,m.forwardRef)((function(e,t){e.children;var n=(0,_e.Z)(e,yc),i=(0,dn.uF)().isExpanded;return(0,j.jsx)(x.LE,(0,a.Z)((0,a.Z)({},n),{},{appearance:"secondary",className:d()(js.baseButton,Ec.icon,o&&js.disabled,i&&js.open),ref:t,size:"small",type:"button",children:(0,j.jsx)(I.q8,{size:"regular"})}))}));return(0,j.jsxs)(Ts.v,{children:[(0,j.jsx)(dn.j2,{as:v,"data-test-id":"editReview.security_preferences",children:u("editReview.security_preferences")}),(0,j.jsx)(As.Y,{className:d()(js.menuPopover,Ec.menuPopover,js.offset),align:"center",offsetYAbove:r?10:14,children:(0,j.jsx)("div",{className:Ec.menuContainer,children:(0,j.jsxs)(Rs.s,{className:Ec.menuItems,children:[(0,j.jsxs)("div",{className:d()(_c.Z.menuItem,Ec.menuItem,js.menuItem),onClick:function(){return s(!i)},children:[(0,j.jsx)("div",{className:d()(js.iconContainer,Ec.iconItem),children:(0,j.jsx)(I.cV,{size:"large"})}),(0,j.jsx)("p",{className:js.title,children:u("editReview.allow_comments")}),(0,j.jsx)("div",{className:Ec.toggleContainer,"data-test-id":"editReview.allow_comments",children:(0,j.jsx)(Cc,{id:"comments_toggle",checked:i,onChange:function(e){return s(e.currentTarget.checked)}})})]}),(0,j.jsxs)("div",{className:d()(_c.Z.menuItem,Ec.menuItem,js.menuItem),onClick:function(){return"DOWNLOAD"!==t&&l(!n)},children:[(0,j.jsx)("div",{className:d()(js.iconContainer,Ec.iconItem),children:(0,j.jsx)(I.ZZ,{size:"large"})}),(0,j.jsx)("p",{className:js.title,children:u("editReview.allow_downloads")}),(0,j.jsx)("div",{className:js.toggleContainer,"data-test-id":"editReview.allow_downloads",children:(0,j.jsx)(Cc,{id:"download_toggle",checked:n,disabled:"DOWNLOAD"===t,onChange:function(e){return l(e.currentTarget.checked)}})})]}),(0,j.jsx)("div",{className:Ec.actionContainer,children:(0,j.jsx)(x.LE,{size:"regular",appearance:"destructive-inverse",className:Ec.button,onClick:c,children:u("review.delete_review")})})]})})})]})}function Nc(e){var t,n=e.review,a=e.portal,l=e.portalId,u=e.hasUploadedItems,d=e.onPublish,v=e.hasPublished,_=void 0!==v&&v,h=(0,p.$G)().t,w=(0,B.Fn)(),g=w.fireErrorEvent,b=w.fireGroupIdentifySet,C=(0,m.useContext)(X.X),E=C.prePublishAssignee,y=C.setPrePublishAssignee,T=C.reviewId,N=hs().updateReview,R=function(){var e=(0,m.useMemo)((function(){return{additionalTypenames:["Review"]}}),[]),t=(0,Hi.Db)(Es),n=(0,s.Z)(t,2),i=n[0],r=i.data,o=i.fetching,a=n[1],l=(0,m.useCallback)((function(t){return a(t,e)}),[a,e]);return{actionRequest:null===r||void 0===r?void 0:r.deleteActionRequest.actionRequest,isDeletingActionRequest:o,deleteActionRequest:l}}(),A=R.deleteActionRequest,k=(0,Cs.I)().batchCreateActionRequest,S=function(){var e=(0,m.useMemo)((function(){return{additionalTypenames:["Review"]}}),[]),t=(0,Hi.Db)(ys),n=(0,s.Z)(t,2),i=n[0],r=i.data,o=i.fetching,a=n[1],l=(0,m.useCallback)((function(t){return a(t,e)}),[a,e]);return{actionRequests:null===r||void 0===r?void 0:r.batchUpdateActionRequest.actionRequests,isUpdatingActionRequest:o,batchUpdateActionRequest:l}}(),Z=S.batchUpdateActionRequest,O=(0,f.v9)(sr.BX),M=(0,f.v9)(lr.HF),P=(0,m.useMemo)(ln.q,[]),L=(0,f.v9)((function(e){return P(e,T)})),V=(0,f.v9)(kt.v9),F=(0,m.useMemo)(jt.yh,[]),U=(0,f.v9)((function(e){return F(e,T)})),W=(0,m.useState)(!1),G=(0,s.Z)(W,2),H=G[0],q=G[1],z=(0,m.useState)(!1),Y=(0,s.Z)(z,2),$=Y[0],K=Y[1],Q=(0,m.useState)(!1),J=(0,s.Z)(Q,2),ee=J[0],te=J[1],ne=(0,m.useState)("DEFAULT"),ie=(0,s.Z)(ne,2),re=ie[0],oe=ie[1],ae=(0,zi.B)(T).actionRequests,se=ae.filter((function(e){return"ASSIGNED"===e.engagementType})),le=ae.filter((function(e){var t=e.engagementType,n=e.completedAt;return"ASSIGNED"===t&&null!==n})),ce=(0,m.useMemo)((function(){return le.length}),[le.length]),ue=(0,m.useMemo)((function(){return se.length+E.length}),[se.length,E.length]);(0,m.useEffect)((function(){var e,t,i;te(Boolean(null===n||void 0===n?void 0:n.downloadEnabled)),K(Boolean(null===n||void 0===n?void 0:n.commentsEnabled)),oe(n?n.actionType:"FAVORITE"),q(void 0!==(null===n||void 0===n||null===(e=n.stats)||void 0===e?void 0:e.totalActionCount)&&void 0!==(null===n||void 0===n||null===(t=n.stats)||void 0===t?void 0:t.completedActionCount)&&(null===n||void 0===n||null===(i=n.stats)||void 0===i?void 0:i.completedActionCount)>0)}),[a,n,te,K,oe,q]);var de=(0,m.useState)(!1),ve=(0,s.Z)(de,2),me=ve[0],pe=ve[1],fe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.actionType,i=e.downloadEnabled,r=e.actionRequests,o=e.commentsEnabled;if(O&&n&&"DRAFT"!==n.status){var s,l=null!==(s=(void 0!==r?r:se).length)&&void 0!==s?s:0;(0,B.gk)({review:n,reviewItems:U,numberOfAssignedReviewers:l,portal:a,team:O,userId:(null===M||void 0===M?void 0:M.sub)||"",comments:L,tier:V,actionType:t,downloadEnabled:i,commentsEnabled:o})}},_e=function(){var e=(0,o.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return K(t),e.next=3,N({id:T,attributes:{commentsEnabled:t}});case 3:if(!e.sent.error){e.next=7;break}return g("error.update_review_error"),e.abrupt("return",(0,D.t6)({message:h("error.update_review_error"),type:"error"}));case 7:b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.COMMENTS_ENABLED,t)}),fe({commentsEnabled:t});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=(0,o.Z)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(t),e.next=3,N({id:T,attributes:{downloadEnabled:t}});case 3:if(!e.sent.error){e.next=7;break}return g("error.update_review_error"),e.abrupt("return",(0,D.t6)({message:h("error.update_review_error"),type:"error"}));case 7:b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.DOWNLOADS_ENABLED,t)}),fe({downloadEnabled:t});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(){var e=(0,o.Z)(c().mark((function e(t){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(ee),"DEFAULT"===(n=t)&&(n=null),e.next=5,N({id:T,attributes:{actionType:n,downloadEnabled:ee}});case 5:if(!e.sent.error){e.next=9;break}return g("error.update_review_error"),e.abrupt("return",(0,D.t6)({message:h("error.update_review_error"),type:"error"}));case 9:b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.ACTION_TYPE,t)}),fe({actionType:n});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=(0,o.Z)(c().mark((function e(t){var n,o,a,s,l,u,d;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=4;break}return n=[].concat((0,i.Z)(E),[t[0]]),y(n),e.abrupt("return");case 4:if(o=!1,a=0,ae.forEach((function(e){(0,xs.$)(e.email,t[0])&&(o=!0),"ASSIGNED"===e.engagementType&&a++})),!o){e.next=16;break}if(s=null===ae||void 0===ae?void 0:ae.find((function(e){return e.email===t[0]}))){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,Z({reviewId:T,attributes:[{publicId:s.publicId,engagementType:"ASSIGNED"}]});case 13:return e.sent.error&&((0,D.t6)({message:h("error.add_reviewer_error"),type:"error"}),g("error.add_reviewer_error")),e.abrupt("return");case 16:return e.next=18,k({reviewId:T,attributes:{engagementType:"ASSIGNED",emails:t}});case 18:(l=e.sent).error?((0,D.t6)({message:h("error.add_reviewer_error"),type:"error"}),g("error.add_reviewer_error")):(b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.NUM_ASSIGNEES,a+1)}),fe({actionRequests:[].concat((0,i.Z)(se),(0,i.Z)((null===(u=l.data)||void 0===u||null===(d=u.batchCreateActionRequest)||void 0===d?void 0:d.actionRequests)||[]))}));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=3;break}return n=E.filter((function(e){return e!==t})),e.abrupt("return",y(n));case 3:return e.next=5,A({id:t});case 5:(i=e.sent).error?((0,D.t6)({message:i.error.message,type:"error"}),g(i.error.name,i.error.message)):(o=se.filter((function(e){return e.publicId!==t})),b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.NUM_ASSIGNEES,o.length)}),fe({actionRequests:o}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=(0,o.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_){e.next=2;break}return e.abrupt("return",y([]));case 2:return t=ae.filter((function(e){return"ASSIGNED"===e.engagementType})).map((function(e){return{publicId:e.publicId,engagementType:"INVITED"}})),e.next=5,Z({reviewId:T,attributes:t});case 5:e.sent.error?((0,D.t6)({message:h("error.add_reviewer_error"),type:"error"}),g("error.add_reviewer_error")):(b({groupType:B.YT.REVIEW,groupName:T,propertyValues:(0,r.Z)({},B.vb.NUM_ASSIGNEES,0)}),fe({actionRequests:[]}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xe=(0,m.useCallback)((function(){return pe(!0)}),[pe]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:js.container,children:[(0,j.jsx)("div",{className:js.group,children:(!_||0===U.length)&&(0,j.jsx)("span",{className:js.begin,children:(0,j.jsx)(x.hU,{as:"button",onClick:xe,children:(0,j.jsx)(I.x8,{size:"large"})})})}),(0,j.jsxs)("div",{className:js.group,children:[(0,j.jsx)("div",{"data-intercom-target":"editorToolbar.actionDropdown",children:(0,j.jsx)(Ss,{actionType:re||"DEFAULT",actionTypeIsLocked:H,onUpdateActionType:we,disabled:!u})}),(0,j.jsx)("div",{"data-intercom-target":"editorToolbar.dueDateDropdown",children:(0,j.jsx)(pc,{dueDate:(null===n||void 0===n?void 0:n.dueDate)||null,reviewId:T,notifyUser:ue!==ce,lastReviewCompletedAt:null===(t=gs(null===n||void 0===n?void 0:n.actionRequests))||void 0===t?void 0:t.completedAt,assigneesCount:ue,disabled:!u,hasPublished:_,review:n,portal:a})}),(0,j.jsx)("div",{"data-intercom-target":"editorToolbar.assigneesDropdown",children:(0,j.jsx)(Gs,{existingActionRequests:se,prePublishEmailList:E,onEmailListChange:function(e){return ge(e)},onRemoveAssignee:Ie,onRemoveAssigneeList:be,dueDate:(null===n||void 0===n?void 0:n.dueDate)||null,disabled:!u,"data-test-id":"assignees.emailAddress.input"})})]}),(0,j.jsx)("div",{className:js.group,children:(0,j.jsxs)("span",{className:js.end,children:[(0,j.jsx)(Tc,{actionType:re,downloadEnabled:ee,commentsEnabled:$,onUpdateCommentsEnabled:_e,onUpdateDownloadEnabled:he,onDeleteReview:function(){return pe(!0)},hasPublished:_,disabled:!u}),(0,j.jsx)(fc,{hasPublished:_,hasUploadedItems:u,onPublish:d})]})})]}),me&&(0,j.jsx)(Vr.n,{onDismiss:function(){return pe(!1)},title:null===n||void 0===n?void 0:n.title,reviewId:T,portalId:l,forceNavigation:!0})]})}var Rc="FileDropZone_messageContainer__bFRQs",Ac="FileDropZone_messageBox__MuhTm",jc="FileDropZone_messageText__4j2bI";function kc(e){return Dc.apply(this,arguments)}function Dc(){return(Dc=(0,o.Z)(c().mark((function e(t){var n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=function(e){return new Promise((function(t,n){var i=new FileReader;i.onloadend=function(){if(i.error&&"NotFoundError"===i.error.name)return n(i.error.name);t(e)},i.readAsBinaryString(e)}))},i=0;case 2:if(!(i<t.length)){e.next=15;break}if(""!==t[i].type){e.next=12;break}return e.prev=4,e.next=7,n(t[i]);case 7:e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(4),e.abrupt("return",!1);case 12:i++,e.next=2;break;case 15:return e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,null,[[4,9]])})))).apply(this,arguments)}function Sc(e){var t=e.children,n=e.disabled,i=(0,m.useState)(!1),r=(0,s.Z)(i,2),a=r[0],l=r[1],u=(0,p.$G)().t,d=(0,m.useContext)(_r.l).uploadFiles,v=(0,f.v9)(kt.v9);function _(){return(_=(0,o.Z)(c().mark((function e(t){var i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!a||n){e.next=11;break}if(-1===t.dataTransfer.types.indexOf("Files")){e.next=10;break}return i=Array.from(t.dataTransfer.files),e.next=6,kc(i);case 6:e.sent?d(i):((0,B.gn)({tier:v}),(0,D.t6)({message:u("editReview.add_items.folder_upload_not_supported"),type:"info"})),e.next=11;break;case 10:(0,D.t6)({message:u("editReview.add_items.dropped_content_cant_be_handled"),type:"info"});case 11:l(!1);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,j.jsxs)("div",{onDragOver:function(e){var t;e.preventDefault(),null!==(t=e.nativeEvent.dataTransfer)&&void 0!==t&&t.types.includes("Files")?l(!0):l(!1)},onDragLeave:function(e){e.preventDefault(),l(!1)},onDrop:function(e){return _.apply(this,arguments)},children:[a&&!n&&(0,j.jsx)("div",{className:Rc,children:(0,j.jsxs)("div",{className:Ac,children:[(0,j.jsx)(I.ZZ,{}),(0,j.jsx)("span",{className:jc,children:u("editReview.add_items.drop_file_message")})]})}),t]})}var Zc="MiniLoaderWithTitle_container__bv40Y",Oc="MiniLoaderWithTitle_hideAnimation__1NFWd",Mc="MiniLoaderWithTitle_show__q+lj6",Pc="MiniLoaderWithTitle_hide__ZFX7L",Lc="MiniLoaderWithTitle_spinner__2IU6J",Vc="MiniLoaderWithTitle_message__q3xjz",Fc=function(e){var t=e.title,n=e.show,i=void 0!==n&&n,r=(0,m.useState)(!0),o=(0,s.Z)(r,2),a=o[0],l=o[1],c=a?Oc:"",u=i?Mc:Pc;return(0,m.useEffect)((function(){setTimeout((function(){return l(!1)}),2e3)}),[]),(0,j.jsxs)("div",{className:d()(Zc,u,c),children:[(0,j.jsx)("div",{className:Lc}),(0,j.jsx)("p",{className:Vc,children:t})]})},Bc="Review_containerLoader__0v0+0",Uc="Review_pageWrapper__njcAg",Wc="Review_pageContainer__yvoEx",Gc="Review_editing__x6ksg",Hc="Review_empty__R-vZa",qc="Review_scrollableEditing__uGh3r",zc="Review_pageContent__ujh3d",Yc="Review_emptyScrollable__w2BJa",$c="Review_tallContainer__dAFg4",Kc="Review_itemsUploaded__kQCdF",Xc="Review_overviewWrapper__offjf",Qc="Review_contentGridWrapper__Nm3MZ",Jc="Review_trackerContainer__YvXSQ",eu="Review_tracker__NVphY",tu="Review_itemsContainer__-TWoe",nu="Review_uploadHero__oQb1g",iu="Review_emptyGridContainer__1LhAC",ru="Review_scrollableEmptyGrid__ipgHY",ou="Review_editorWrapper__jKl+P",au="Review_collapsed__TUI0a",su="Review_editor__lMGY-",lu="Review_enablementBanner__B0JYt",cu="Review_reviewInfoAnchor__tglI-",uu="Review_reviewInfoContainer__tH88h",du="Review_metadata__MxnYQ",vu="Review_scroll__eph5-",mu="Review_gradient__Hc+lP",pu="Review_shrink__rptfU",fu="Review_link__3KdMh",_u=n(89985),hu=n(5626),wu=n(12402),gu="ReviewFooter_container__VgSlZ",Iu="ReviewFooter_title__dClKu",bu="ReviewFooter_description__sMS+h";function xu(e){var t=e.teamName,n=e.logoUrl,i=e.title,r=e.shareUrl,o=(0,p.$G)().t,a=(0,m.useCallback)((function(){(0,wu.t6)({message:o("share.success"),type:"info"})}),[o]),s=(0,m.useCallback)((function(){(0,wu.t6)({message:o("share.failure"),type:"error"})}),[o]);return(0,j.jsxs)("div",{className:gu,children:[(0,j.jsx)(_u.q,{imageUrl:n,size:"small"}),i&&(0,j.jsx)("span",{className:Iu,children:i}),(0,j.jsx)("span",{className:bu,children:t&&o("portal.footer.description",{teamName:t,interpolation:{escapeValue:!1}})}),(0,j.jsx)(hu.V,{text:r,onAfterCopy:a,onCopyFail:s})]})}var Cu=n(21105),Eu="DownloadsEnabledTooltip_label__x1yFz",yu=function(e){var t=e.isTransitionOver,n=(0,p.$G)().t;return(0,j.jsx)(re.u,{content:n("editReview.downloads_enabled_tooltip"),positions:["bottom"],isEnabled:t,children:(0,j.jsx)("span",{className:Eu,children:(0,j.jsx)(Re.k,{icon:I.ZZ,size:"small",children:n("editReview.download_enabled")})})})},Tu="LayoutGridToggle_popoverContainer__QYpyt",Nu="LayoutGridToggle_container__oh3jT",Ru="LayoutGridToggle_button__qjXh6",Au="LayoutGridToggle_active__dcUKb";function ju(e){var t=e.review,n=e.portal,i=(0,p.$G)().t,a=(0,B.Fn)(),l=a.fireErrorEvent,u=a.fireGroupIdentifySet,v=(0,m.useContext)(X.X),_=v.layoutGrid,h=v.setLayoutGrid,w=v.reviewId,g=v.reviewItems,b=(0,zi.B)(w).actionRequests,C=hs().updateReview,E=(0,f.v9)(sr.BX),y=(0,f.v9)(lr.HF),T=(0,m.useMemo)(ln.q,[]),N=(0,f.v9)((function(e){return T(e,w)})),R=(0,f.v9)(kt.v9),A=(0,m.useRef)(null),k=(0,m.useState)(!1),S=(0,s.Z)(k,2),Z=S[0],O=S[1],M=(0,m.useState)(!1),P=(0,s.Z)(M,2),L=P[0],V=P[1],F=(0,m.useState)(!1),W=(0,s.Z)(F,2),G=W[0],H=W[1],q=function(e){A.current&&!A.current.contains(e.target)&&O(!1)};(0,m.useEffect)((function(){return document.addEventListener("click",q,!0),function(){document.removeEventListener("click",q,!0)}}),[]),(0,m.useEffect)((function(){"DRAFT"===(null===t||void 0===t?void 0:t.status)&&(G||1!==g.length||(O(!0),H(!0),h("COLUMN")),L||2!==g.length&&3!==g.length||("GRID"!==_&&O(!0),V(!0),h("GRID")),g.length>3&&O(!1))}),[null===t||void 0===t?void 0:t.status,g.length,h]),(0,m.useEffect)((function(){Z&&setTimeout((function(){return O(!1)}),5e3)}),[Z,g.length]);var z=(0,m.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(o){var a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(o),O(!1),e.next=4,C({id:w,attributes:{layoutType:o}});case 4:if(!e.sent.error){e.next=9;break}return(0,D.t6)({message:i("error.update_review_error"),type:"error"}),l("error.update_review_error"),e.abrupt("return");case 9:if(u({groupType:B.YT.REVIEW,groupName:w,propertyValues:(0,r.Z)({},B.vb.LAYOUT,(0,U.xo)(o))}),t&&E){e.next=12;break}return e.abrupt("return");case 12:s=null!==(a=b.filter((function(e){return"ASSIGNED"===e.engagementType})).length)&&void 0!==a?a:0,(0,B.gk)({review:t,reviewItems:g,numberOfAssignedReviewers:s,portal:n,team:E,userId:(null===y||void 0===y?void 0:y.sub)||"",comments:N,tier:R,layoutType:o});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[h,u,C,w,t,E,i,l,b,g,n,null===y||void 0===y?void 0:y.sub,N,R]),Y=(0,j.jsxs)("div",{className:Nu,children:[(0,j.jsx)(x.hU,{type:"button",appearance:"inverted",size:"small",className:d()(Ru,(0,r.Z)({},Au,"GRID"===_)),onClick:function(){return z("GRID")},"data-test-id":"editReview.grid_view",children:(0,j.jsx)(I.I0,{size:"small"})}),(0,j.jsx)(x.hU,{type:"button",appearance:"inverted",size:"small",className:d()(Ru,(0,r.Z)({},Au,"COLUMN"===_)),onClick:function(){return z("COLUMN")},"data-test-id":"editReview.list_view",children:(0,j.jsx)(I.oL,{size:"small"})})]});return(0,j.jsx)("div",{ref:A,children:(0,j.jsx)(ie.J,{target:Y,isShowing:Z,positions:["bottom"],arrowColor:"#161616",children:(0,j.jsx)("div",{className:Tu,children:i("review.layout_tooltip_helper")})})})}var ku="ReviewHeader_wrapper__o31gY",Du="ReviewHeader_editorContainer__c0t03",Su="ReviewHeader_viewerContainer__HpnnY",Zu="ReviewHeader_layoutControls__oIHM0",Ou=n(33392),Mu="ViewHeader_popOverMenu__oT6Me",Pu="ViewHeader_container__dTFcv",Lu="ViewHeader_controlsGroup__vOU69",Vu="ViewHeader_locked__F9LLh",Fu="ViewHeader_iconedLink__KplKu",Bu="ViewHeader_back__PjBuC",Uu="ViewHeader_disabled__9tSBP",Wu="ViewHeader_button__J62Dh",Gu="ViewHeader_avatar__8bcv5",Hu="ViewHeader_title__VgO7E",qu="ViewHeader_teamLogo__+xx-c",zu="ViewHeader_spinnerContainer__vl9ic",Yu="ViewHeader_spinnerIcon__MUpe7";function $u(e){var t=e.logoUrl,n=e.title,i=e.handleShareReviewModal,o=e.handleShareLink,a=e.portalId,l=e.review,c=e.identity,u=e.onDownloadAllFiles,v=e.canDownloadReviewItems,f=e.hasPassphrase,h=e.isStandAloneReview,w=e.downloadStatus,g=(0,m.useContext)(Ou.v).restrictActionWithModal,b=(0,L.T)(),C=b.canUseFreeTier,E=b.canUpdateReviews,y=b.restrictionStatus,T=(0,fr.P)().getEntitlementPopover,N=(0,m.useState)(!1),R=(0,s.Z)(N,2),A=R[0],k=R[1],D=(0,m.useState)(!1),S=(0,s.Z)(D,2),Z=S[0],O=S[1],M=(0,m.useState)(!1),P=(0,s.Z)(M,2),F=P[0],B=P[1],U=C&&"OVER_LIMIT"===y,W=(0,m.useContext)(X.X).enterEditMode,G=(0,V.G)(),H=G.isMinDesktopL,q=G.isMinTablet,z=G.isMinPhone,Y=G.isMinDesktop,$=(0,p.$G)().t,K=(0,_.TH)(),Q=(0,_.s0)(),ee=K.state,te=(0,m.useRef)((null===ee||void 0===ee?void 0:ee.fromPreviewCard)||!1),ne=(0,m.useRef)((null===ee||void 0===ee?void 0:ee.fromPortalPage)||!1);(0,m.useEffect)((function(){w&&B(!1)}),[w,B]);var re="OWNER"===c,oe="LOADING"===c,ae=U?T({target:(0,j.jsx)(To,{children:z?$("review.download"):(0,j.jsx)(Re.k,{icon:I.ZZ,space:"small",size:"regular"})}),type:"review",position:["bottom"]}):(0,j.jsx)(x.CE,{className:Fu,as:"button","data-test-id":"review.download_button",appearance:"inverted",onClick:function(){u()},children:(0,j.jsx)(Re.k,{icon:I.ZZ,space:"small",size:"regular",children:H&&$("review.download")})}),se=U?Y&&T({target:(0,j.jsx)(To,{children:q&&$("review.edit")}),type:"review",position:["bottom"]}):q&&(0,j.jsx)(x.CE,{className:Fu,as:"a",to:"/portals/".concat(a),"data-test-id":"review.edit_button",appearance:"inverted",onClick:function(e){C?E&&W():g({restrictionType:"canUpdateReviews",analyticsEventName:"update_review",onAccessGiven:W,onAccessRefused:function(){return e.preventDefault()}})},children:(0,j.jsx)(Re.k,{icon:I.I8,space:"small",size:"regular",children:H&&$("review.edit")})}),le=F?function(){return(0,j.jsx)("div",{className:zu,children:(0,j.jsx)(J.$,{className:Yu,color:bo.in})})}:I.ZZ,ce=(0,j.jsx)(x.CE,{className:d()(Fu,(0,r.Z)({},Uu,U||"error"===w)),as:"button","data-test-id":"review.download_button",appearance:"inverted",onClick:"error"!==w&&function(e){B(!0),u()},children:(0,j.jsx)(Re.k,{icon:le,space:"small",size:"regular",children:H&&$("review.download")})}),ue=U?(0,j.jsx)(ie.J,{arrowColor:"#333333",isShowing:Z,setIsShowing:O,positions:["bottom"],target:ce,children:(0,j.jsx)("div",{className:Mu,children:$("review.guest_overlimit_download")})}):ce;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:Pu,children:[(0,j.jsx)("div",{className:Lu,children:h&&!re?null:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(x.CE,{className:d()(Fu,Bu),onClick:function(){!te.current&&!h||ne.current?Q("/portals/".concat(a)):Q("/")},"data-test-id":"review.back.chevron",appearance:"inverted",children:(0,j.jsx)(I.s$,{size:"large"})}),h||"/"===(null===ee||void 0===ee?void 0:ee.previousPathname)?null:(0,j.jsxs)("div",{className:Gu,children:[t&&(0,j.jsx)(_u.q,{className:qu,size:"extra-small",imageUrl:t,backgroundColor:"transparent"}),(0,j.jsx)("span",{className:Hu,children:n})]})]})}),(0,j.jsxs)("div",{className:d()(Lu,U&&[Vu]),children:[re&&(0,j.jsxs)(j.Fragment,{children:[v&&ae,se,(0,j.jsx)(x.LE,{className:Wu,type:"button",size:"small",onClick:i,children:(0,j.jsx)(Re.k,{icon:f?I.Z0:I.hB,space:"small",size:"small",children:$("review.share_review")})})]}),!re&&!oe&&(0,j.jsxs)(j.Fragment,{children:[v&&ue,(0,j.jsx)(x.CE,{appearance:"inverted",onClick:o,size:"small",type:"button","data-test-id":"review.share_button",children:(0,j.jsx)(Re.k,{icon:I.$p,size:"regular",space:"extra-small",children:$("review.get_link")})})]})]})]}),A&&(0,j.jsx)(Vr.n,{onDismiss:function(){return k(!1)},title:null===l||void 0===l?void 0:l.title,reviewId:null===l||void 0===l?void 0:l.publicId,portalId:a,forceNavigation:!0})]})}var Ku=["downloadEnabled","review","portal"],Xu=function(e){var t=e.downloadEnabled,n=void 0!==t&&t,i=e.review,r=e.portal,o=(0,_e.Z)(e,Ku),l=(0,m.useContext)(X.X).displayMode,c=(0,m.useContext)(X.X).isStandAloneReview,u=i&&c(i),d=(0,m.useState)(!0),v=(0,s.Z)(d,2),p=v[0],f=v[1];return(0,m.useLayoutEffect)((function(){f(!1),setTimeout((function(){return f(!0)}),500),(0,D.hm)("OVER_LIMIT")&&(0,D.aW)("OVER_LIMIT"),(0,D.hm)("OVER_PREVIEW_LIMIT")&&(0,D.aW)("OVER_PREVIEW_LIMIT")}),[l]),(0,j.jsxs)("div",{className:ku,children:["view"===l&&p&&(0,j.jsx)("div",{className:Su,children:(0,j.jsx)(Cu.M,{appearance:"inverted",children:(0,j.jsx)($u,(0,a.Z)((0,a.Z)({},o),{},{review:i,isStandAloneReview:u}))})}),"edit"===l&&(0,j.jsx)("div",{className:Du,children:(0,j.jsxs)("div",{className:Zu,children:[(0,j.jsx)(br,{type:"Square"}),(0,j.jsx)(ju,{review:i,portal:r}),n&&(0,j.jsx)(yu,{isTransitionOver:p})]})})]})},Qu="ReviewHeroOverview_container__5EWjP",Ju="ReviewHeroOverview_trackerHidden__tWXhV",ed="ReviewHeroOverview_display__dp2W2",td="ReviewHeroOverview_edit__H-qb4",nd="ReviewHeroOverview_inlineInputsNoTracker__BXzBR",id="ReviewHeroOverview_trackerShown__aJ6RF",rd="ReviewHeroOverview_nonEmptyGrid__TGhyW",od=n(87366),ad="InlineInputs_inputTitle__e3KRH InlineInputs_input__-ghlF",sd="InlineInputs_center__nqIGy",ld="InlineInputs_titleOnly__I9fhT",cd="InlineInputs_inputDescription__RBfYm InlineInputs_input__-ghlF",ud="InlineInputs_title__Gd-oV",dd="InlineInputs_description__CYlNa",vd="InlineInputs_readMore__calwv";function md(e){var t=e.reviewTitle,n=e.reviewDescription,i=e.hasAction,r=e.review,o=e.showUploadHero,a=e.onChange,l=(0,p.$G)().t,c=(0,_.TH)(),u=(0,L.T)().restrictActionWithModal,v=(0,m.useState)(t&&""!==t),f=(0,s.Z)(v,2),h=f[0],w=f[1],g=(0,m.useContext)(X.X),I=g.displayMode,b=g.checkTitleAndDescription,x=g.editedTitle,C=g.setEditedTitle,E=g.editedDescription,y=g.setEditedDescription,T=(0,m.useReducer)((function(e){return e+1}),0),N=(0,s.Z)(T,2),R=N[0],A=N[1],k=(0,m.useState)(!1),D=(0,s.Z)(k,2),S=D[0],Z=D[1];(0,m.useEffect)((function(){r&&b(r)}),[b,r]);var O=function(e){(e.title||""===e.title)&&C(e.title),(e.description||""===e.description)&&y(e.description),null===a||void 0===a||a(e)};(0,m.useEffect)((function(){Z(!1)}),[c.search]);var M=(0,m.useMemo)((function(){return void 0!==x?x:t}),[x,t]),P=(0,m.useMemo)((function(){return void 0!==E?E:n}),[E,n]),V=(0,m.useMemo)((function(){return void 0!==x||t&&""!==t||h}),[x,h,t]),F=(0,m.useMemo)((function(){return l(h?"editReview.add_a_description_title_added":"editReview.add_a_description")}),[h,l]);(0,m.useEffect)((function(){A()}),[i,P]);return"edit"===I?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(od.O,{className:d()(ad,!i&&sd,(!P&&!i||o)&&ld),defaultValue:M,placeholder:l("editReview.review_title"),maxLength:255,initialHeight:56,onChange:function(e){w(""!==e.target.value)},onBlur:function(e){t!==e&&O({title:e})},onFocus:function(e){return u({restrictionType:"canUpdateReviews",analyticsEventName:"set_title",onAccessRefused:function(){return e.preventDefault()}})},testId:"review.title",showUploadHero:o},"title-".concat(R)),(0,j.jsx)(od.O,{className:d()(cd,!i&&sd),defaultValue:P,placeholder:F,isDisabled:!V&&!P,maxLength:1e3,onBlur:function(e){n!==e&&O({description:e})},onFocus:function(e){return u({restrictionType:"canUpdateReviews",analyticsEventName:"set_description",onAccessRefused:function(){return e.preventDefault()}})},testId:"review.description"},"description-".concat(R))]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("h1",{className:d()(ud,!n&&!i&&ld,n&&!i&&sd),children:M||l("review.untitled")}),P&&(0,j.jsxs)("p",{className:d()(dd,!i&&sd),children:["edit"===I||S?P:P&&P.length>300?P.substring(0,300):P,!S&&"view"===I&&(null===P||void 0===P?void 0:P.length)>300&&(0,j.jsxs)(j.Fragment,{children:[" ","..."," ",(0,j.jsx)("button",{className:vd,onClick:function(){return Z(!0)},children:l("review.hero.read_more")})]})]})]})}var pd="useTrackerMetadata_assigneeTooltip__dODk8",fd=function(e){if(e){var t=e.charAt(0).toUpperCase()+e.slice(1);return e.length>30?"".concat(t.substring(0,20),"..."):t}},_d="Tracker_lineItemContainer__ZmJoL",hd="Tracker_assigneeContainer__DsAU9",wd="Tracker_headerContainer__Pqgtn",gd=function(e){var t=e.actionType,n=e.dueDate,r=e.assignees,o=function(e,t,n,r,o){var a=(0,p.$G)().t,s=(0,V.G)().isMinDesktop,l={stringToRender:"",iconToRender:I.EC},c=[],u={stringToRender:"",iconToRender:I.uS,hiddenAssignees:!1},d=n&&"VIEW"!==n&&"DOWNLOAD"!==n;switch(n){case"APPROVE":l.stringToRender=a("review.hero.approve_items"),l.iconToRender=I.EC,c=[].concat((0,i.Z)(c),[l]);break;case"FAVORITE":l.stringToRender=a("review.hero.select_favorites"),l.iconToRender=I.OE,c=[].concat((0,i.Z)(c),[l])}if(r){var v="MMM d, yyyy' ".concat(a("at")," ' h:mmaa");d&&(v="'".concat(a("review.hero.due"),"' MMM d, yyyy' ").concat(a("at")," ' h:mmaa"));var m=(0,ee.gU)(new Date(r),v).returnedDateFormat;c=[].concat((0,i.Z)(c),[{stringToRender:m,iconToRender:I.qp}])}if(o){var f=(0,O.Ko)({actionRequests:o,teamMembers:e,user:t,shouldHideEmailDomain:!0}),_="review.hero.assignedOnly";if((d||r)&&(_="review.hero.assignedTo"),f.length>2){u.hiddenAssignees=!0;var h=f.length-2,w="".concat(_,h>1?"_many_more":"_one_more");u.elementToRender=(0,j.jsx)(p.cC,{i18nKey:w,values:{name1:fd(f[0]),name2:fd(f[1]),moreCount:h},components:[(0,j.jsx)(re.u,{content:f.slice(2).map((function(e){return fd(e)})).join(", "),positions:["bottom"],targetClassName:pd})]}),s||(u.elementToRender=(0,j.jsxs)(p.cC,{i18nKey:"review.hero.assigned_to_mobile",children:[f.slice(0,-1).map((function(e){return fd(e)})).join(", "),fd(f.at(-1))]}))}else u.stringToRender=function(){switch(f.length){case 1:return u.hiddenAssignees=!1,a("".concat(_,"_1"),{name1:fd(f[0])});case 2:return u.hiddenAssignees=!1,a("".concat(_,"_2"),{name1:fd(f[0]),name2:fd(f[1])})}}()}return{metadataArray:c,assigneeMetadata:u}}(e.teamMembers,e.user,t,n,r),a=o.metadataArray,s=o.assigneeMetadata,l=function(e,t,n){var i=(0,p.$G)().t;return"FAVORITE"===e||"APPROVE"===e?i("review.info_box.request_to"):t?i("review.info_box.review_by"):n?i("review.info_box.assigned_to"):void 0}(t,n,r);return(0,j.jsxs)("div",{"data-test-id":"reviewHeroOverview.tracker",children:[l&&(0,j.jsx)("div",{className:wd,children:l}),a.map((function(e,t){return(0,j.jsx)(Re.k,{className:_d,icon:e.iconToRender,children:e.stringToRender},t)})),!(null===r||void 0===r||!r.length)&&s&&(0,j.jsx)(Re.k,{className:hd,icon:s.iconToRender,children:s.hiddenAssignees?s.elementToRender:s.stringToRender})]})},Id=function(e){var t,n,o=e.reviewTitle,a=e.reviewDescription,s=e.review,l=e.onTitleDescriptionChange,c=e.showUploadHero,u=(0,m.useContext)(X.X),v=u.displayMode,p=u.prePublishAssignee,f=(null===s||void 0===s||null===(t=s.actionRequests)||void 0===t?void 0:t.filter((function(e){return"ASSIGNED"===e.engagementType})))||[],_=(0,m.useMemo)((function(){return p.map((function(e){return{email:e}}))}),[p]),h=[].concat((0,i.Z)(_),(0,i.Z)(f)),w=(null===s||void 0===s?void 0:s.actionType)||(null===s||void 0===s?void 0:s.dueDate)||h.length>0,g=(0,m.useContext)(It),I=g.teamMembers,b=g.user,x=(0,m.useMemo)((function(){return"view"===v}),[v]);return(0,j.jsxs)("div",{className:d()(Qu,(n={},(0,r.Z)(n,rd,!c),(0,r.Z)(n,id,w),(0,r.Z)(n,Ju,!w),(0,r.Z)(n,ed,x),(0,r.Z)(n,td,!x),n)),children:[(0,j.jsx)("div",{className:d()((0,r.Z)({},nd,!w)),children:(0,j.jsx)(md,{review:s,reviewTitle:o,reviewDescription:a,hasAction:Boolean(w),onChange:l,showUploadHero:c})}),w&&(0,j.jsx)(gd,{actionType:null===s||void 0===s?void 0:s.actionType,dueDate:null===s||void 0===s?void 0:s.dueDate,assignees:h,teamMembers:I,user:b})]})},bd="ReviewTracker_container__YdoBg",xd="RecordLabel_iconedLabel__Na0oX",Cd="RecordLabel_small__3YZzO",Ed="RecordLabel_container__g-CxP",yd=["icon","label","as","size","testId","children"];function Td(e){var t=e.icon,n=e.label,i=e.as,r=e.size,o=e.testId,s=e.children,l=(0,_e.Z)(e,yd);if(!i&&!n&&!s)throw new Error("Unexpected props value: either 'label' or 'as' prop has to be specified");var c={};return o&&(c=(0,a.Z)((0,a.Z)({},c),{},{"data-test-id":o})),t?(0,j.jsx)("div",{className:Ed,children:(0,j.jsx)(Re.k,(0,a.Z)((0,a.Z)({className:d()(xd,"small"===r&&Cd),icon:t,size:r,space:"small"},l),{},{children:(0,j.jsx)("span",(0,a.Z)((0,a.Z)({},c),{},{children:i||n||s}))}))}):(0,j.jsx)("div",{className:d()(Ed,xd),children:(0,j.jsx)("span",(0,a.Z)((0,a.Z)({},c),{},{children:i||n||s}))})}var Nd={actionType:void 0,approvedItemsCount:NaN,favoritedItemsCount:NaN,commentsEnabled:!1,identity:void 0,showIcons:!1,comments:void 0,guestEmail:""},Rd=(0,m.createContext)(Nd),Ad=function(e){var t=e.review,n=e.comments,i=e.identity,r=e.approvedItemsCount,o=e.favoritedItemsCount,a=e.showIcons,s=void 0!==a&&a,l=e.guestEmail,c=t||{},u=c.actionType,d=c.commentsEnabled,v=(0,m.useMemo)((function(){return{actionType:u,approvedItemsCount:r,favoritedItemsCount:o,commentsEnabled:d,identity:i,showIcons:s,comments:n,guestEmail:l}}),[u,r,o,d,i,s,n,l]);return(0,j.jsx)(Rd.Provider,{value:v,children:(0,j.jsx)(Od,{})})};function jd(e){var t=e.label,n=(0,m.useContext)(Rd),i=n.actionType,r=n.showIcons?"small":"large";return"APPROVE"!==i?null:(0,j.jsx)(Td,{icon:I.Th,size:r,label:t,testId:"reviewtracker.approve.count"})}function kd(e){var t=e.label,n=e.commentCount,i=void 0===n?0:n,r=(0,m.useContext)(Rd),o=r.commentsEnabled,s=r.actionType,l=r.showIcons,c=r.identity,u=l?"small":"large",d={},v=t;return(!s||l&&"OWNER"!==c)&&(d=(0,a.Z)((0,a.Z)({},d),{},{icon:I.I3})),"APPROVE"!==s&&"FAVORITE"!==s||(v=", ".concat(t)),l&&"OWNER"!==c&&(v=t),o||0!==i?(0,j.jsx)(Td,(0,a.Z)((0,a.Z)({label:v,size:u},d),{},{testId:"reviewtracker.comment.count"})):null}function Dd(e){var t=e.label,n=(0,m.useContext)(Rd),i=n.actionType,r=n.showIcons?"small":"large";return"FAVORITE"!==i?null:(0,j.jsx)(Td,{icon:I.GM,size:r,label:t,testId:"reviewtracker.favorite.count"})}Ad.displayName="ReviewTrackerContextProvider";var Sd=function(){var e,t,n,i=(0,p.$G)().t,r=(0,m.useContext)(It).review,o=(null===r||void 0===r||null===(e=r.stats)||void 0===e?void 0:e.totalCommentCount)||0;return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Dd,{label:i("review.tracker.favoriteCount",{count:(null===r||void 0===r||null===(t=r.stats)||void 0===t?void 0:t.totalFavoritedCount)||0})}),(0,j.jsx)(jd,{label:i("review.tracker.approveCount",{count:(null===r||void 0===r||null===(n=r.stats)||void 0===n?void 0:n.totalApprovedCount)||0})}),(0,j.jsx)(kd,{label:i("review.tracker.commentsWithCount",{count:o}),commentCount:o})]})},Zd=function(){var e=(0,m.useContext)(Rd),t=e.favoritedItemsCount,n=e.approvedItemsCount,i=e.comments,r=e.guestEmail,o=(0,p.$G)().t,a=(0,m.useMemo)((function(){return i?Object.values(i).map((function(e){return e.nodes})).flat().filter((function(e){return(null===e||void 0===e?void 0:e.author)===r})).length:0}),[i,r]),s=t.toString(),l=n.toString(),c=a.toString();return(0,j.jsxs)(re.u,{positions:["top"],content:o("review.tracker.tooltip"),children:[(0,j.jsx)(Dd,{label:s}),(0,j.jsx)(jd,{label:l}),(0,j.jsx)(kd,{label:c,commentCount:a})]})};function Od(){var e=(0,m.useContext)(Rd).identity;return(0,j.jsx)("div",{className:bd,children:"OWNER"!==e?(0,j.jsx)(Zd,{}):(0,j.jsx)(Sd,{})})}var Md=n(98037),Pd="ReviewerID_container__+Zx7k",Ld="ReviewerID_helpBox__ihK8y",Vd="ReviewerID_menuButton__vz8zc",Fd="ReviewerID_viewingAs__5o-NL",Bd="ReviewerID_guestName__bNVG7";function Ud(e){var t=e.portalId,n=e.canIdentifySelf,i=e.identificationModalVisibility,r=e.onOpenIdentificationModal,o=(0,p.$G)().t,a=(0,m.useContext)(X.X).reviewId,s=(0,Rt.B)({portalId:t,reviewId:a}).guestEmail,l=(0,m.useMemo)((function(){return""===s}),[s]),c=(0,m.useMemo)((function(){return l?o("identity_label.guest_lowercase"):(0,pi.v)({guestEmail:s,truncate:!0})}),[s,l,o]),u=function(){l&&r&&r()},d=(0,m.useMemo)((function(){return!l&&i===cr.U.HIDDEN}),[i,l]);return(0,j.jsx)(j.Fragment,{children:n&&(0,j.jsx)("div",{className:Pd,children:(0,j.jsx)("div",{className:Ld,children:(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(ct.v2,{children:[(0,j.jsx)(ct.j2,{className:Vd,children:(0,j.jsx)(Re.k,{className:Fd,onClick:u,size:"extra-large",space:"extra-small",icon:l?I.uo:I.MT,position:"after",children:(0,j.jsxs)("div",{onClick:u,children:[o(l?"identity_label.viewing_as":"identity_label.reviewing_as"),"\xa0",(0,j.jsx)("span",{className:Bd,children:c})]})})}),(0,j.jsx)(Md.c,{hidePopover:!d,guestEmail:s,onClick:function(){r&&r()}})]})})})})})}var Wd=n(89032),Gd=n(9085),Hd=n(55153),qd=n(57125),zd=["progressHandler","itemIds","getQueueTotalSize"],Yd=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ur._f.post("/graphql",{query:"query ReviewStormMetadataQuery($reviewId: String!) {\n  review(id: $reviewId) {\n    stormMutationToken\n  }\n}\n",operationName:"ReviewStormMetadataQuery",variables:{reviewId:t}});case 3:if(i=e.sent,r=null===(n=i.body.data)||void 0===n?void 0:n.review){e.next=7;break}return e.abrupt("return",{stormMutationToken:void 0});case 7:return e.abrupt("return",{stormMutationToken:r.stormMutationToken});case 10:return e.prev=10,e.t0=e.catch(0),(0,dr.eK)(new Error("Could not get storm mutation token with error: ".concat(e.t0.message))),e.abrupt("return",{stormMutationToken:void 0});case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),$d=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r,o,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",i=0;case 2:if(!(i<3)){e.next=19;break}return e.prev=3,e.next=6,ur._f.post("/graphql",{query:"\n  mutation GetAccessTokenMutation($reviewId: String!) {\n    getAccessToken(foreignId: $reviewId) {\n      token\n    }\n  }\n",operationName:"GetAccessTokenMutation",variables:{reviewId:t}});case 6:return a=e.sent,s=null===(r=a.body.data)||void 0===r||null===(o=r.getAccessToken)||void 0===o?void 0:o.token,e.abrupt("return",s);case 11:if(e.prev=11,e.t0=e.catch(3),"Network Error"===e.t0.message){e.next=15;break}return e.abrupt("return",(0,dr.eK)(new Error("Could not get storm access token message:".concat(e.t0.message," and cause ").concat(e.t0.cause," "))));case 15:n="Could not get storm access token with error after ".concat(i," tries: message").concat((e.t0.message,e.t0.cause));case 16:i++,e.next=2;break;case 19:(0,dr.eK)(new Error(n));case 20:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}(),Kd=function(e){var t=e.progressHandler,n=e.itemIds,i=e.getQueueTotalSize,r=(0,_e.Z)(e,zd);return(0,a.Z)((0,a.Z)({},r),{},{batchForeignSystem:"ensemble-api",atPosition:0,onProgress:function(e){var r=i(),o=(0,s.Z)(r,2),a=o[0],l=o[1],c=e.perFile;if(t){var u=c.map((function(e,t){return{id:n[t],progress:e.progress}})),d=(c.length*e.progress+a)/(c.length+a+l);t(d,u)}}})},Xd=function(e){var t=e.reviewId,n=e.onUploadFail,r=e.onUploadComplete,a=(0,m.useState)(0),l=(0,s.Z)(a,2),u=l[0],d=l[1],v=(0,m.useState)([]),p=(0,s.Z)(v,2),f=p[0],_=p[1],h=(0,m.useState)([]),w=(0,s.Z)(h,2),g=w[0],I=w[1],b=(0,m.useState)({}),x=(0,s.Z)(b,2),C=x[0],E=x[1],y=(0,m.useMemo)((function(){return function(e){var t,n=e.reviewId,r=e.completeHandler,a=e.progressHandler,s=e.uploadFailureHandler,l=[],u=0,d=0,v=0,m=!1,p=function(e,t){var n=Math.floor(100*e),i=t.map((function(e){return{id:e.id,progress:Math.floor(100*e.progress)}})),r=i.reduce((function(e,t){return t.progress+e}),0);n===d&&r===v||(d=n,v=r,null===a||void 0===a||a(n,i))},f=function(){var e=(0,o.Z)(c().mark((function e(){var o,a,d,v,_,h,w,g,I,b,x,C;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=2;break}return e.abrupt("return");case 2:if(0!==l.length){e.next=5;break}return u=0,e.abrupt("return");case 5:if(m=!0,void 0!==t){e.next=16;break}return e.next=9,Yd(n);case 9:if(o=e.sent,void 0!==(a=o.stormMutationToken)){e.next=15;break}return m=!1,(0,dr.eK)(new Error("could not get storm initial batch data")),e.abrupt("return");case 15:t=a;case 16:return e.next=18,$d(n);case 18:if(d=e.sent){e.next=23;break}return m=!1,(0,dr.eK)(new Error("could not get storm access token")),e.abrupt("return");case 23:return v=l[0],_=l[0].map((function(e){return e.item})),h=l[0].map((function(e){return e.id})),l.shift(),w=Kd({token:d,items:_,progressHandler:p,itemIds:h,mutationToken:t,batchForeignId:n,getQueueTotalSize:function(){return[u,l.reduce((function(e,t){return e+t.length}),0)]}}),g=(0,qd.Qu)(w),e.prev=29,e.next=32,g.start();case 32:b=e.sent,x=b.data.batch_after_mutation,I=x,e.next=44;break;case 37:return e.prev=37,e.t0=e.catch(29),(0,dr.eK)(e.t0),(0,dr.eK)(new Error("Failed to start storm upload")),C=function(){l=[v].concat((0,i.Z)(l)),setTimeout((function(){return f()}),0)},null===s||void 0===s||s({items:_,itemIds:h,retry:C}),e.abrupt("return");case 44:m=!1,u+=_.length,null===r||void 0===r||r({stormMutationToken:t,completed:I.items.map((function(e,t){var n=e.id,i=e.direct_file_access_url;return{id:h[t],stormId:n,directFileAccessUrl:i}}))}),setTimeout((function(){return f()}),0);case 48:case"end":return e.stop()}}),e,null,[[29,37]])})));return function(){return e.apply(this,arguments)}}();return{addItems:function(e){l.push(e),f()},removeItems:function(e){l=l.map((function(t){return t.filter((function(t){return!e.includes(t.id)}))})),f()},getQueue:function(){return l},getQueueMeta:function(){return{stormMutationToken:t}}}}({reviewId:t,progressHandler:function(e,t){d(e),_(t)},completeHandler:function(e){E(R()),I((function(t){return[].concat((0,i.Z)(t),(0,i.Z)(e.completed.filter((function(e){return void 0!==e.id}))))})),null===r||void 0===r||r(e)},uploadFailureHandler:function(e){null===n||void 0===n||n(e)}})}),[t,r,n]),T=y.addItems,N=y.removeItems,R=y.getQueueMeta;return{addItems:T,removeItems:N,progress:u,progressItems:f,completed:g,meta:C}},Qd=n(84096),Jd=n(31894),ev=n(3605);function tv(e){var t=e.reviewId,n=e.previewWidth,r=e.previewHeight,o=(0,P.T)(),a=(0,m.useState)(0),l=(0,s.Z)(a,2),c=l[0],u=l[1],d=(0,m.useState)([]),v=(0,s.Z)(d,2),p=v[0],_=v[1],h=(0,m.useMemo)(jt.yh,[]),w=(0,f.v9)((function(e){return h(e,t)}));return(0,Jd.Z)((function(){var e=[],i=[],a=c+1;p.length&&(w.forEach((function(t){var n,r,o,s,l,u,d,v,m=t.publicId,f=p.find((function(e){return e.publicId===m}));if(f)if((null!==(n=t.preview)&&void 0!==n&&null!==(r=n.image)&&void 0!==r&&r.url||null!==(o=t.preview)&&void 0!==o&&null!==(s=o.videoStatic)&&void 0!==s&&s.url||null!==(l=t.preview)&&void 0!==l&&null!==(u=l.audioVisualization)&&void 0!==u&&u.imageWaveform)&&!(0,yn.cS)((null===(d=t.preview)||void 0===d||null===(v=d.image)||void 0===v?void 0:v.url)||""))i.push(f);else if(f.startTick)a-f.startTick<15?e.push(f):i.push(f);else{var _=t.isProcessingComplete?c:0;e.push({publicId:f.publicId,startTick:_})}})),_(e));if(e.length){var s=e.map((function(e){return e.publicId}));o((0,At.Tw)({reviewId:t,previewWidth:n,previewHeight:r,itemsWithoutPreviews:s}))}u(a)}),p.length>0?5e3:2e4),{pollItems:function(e){var n=e.items.filter((function(e){if(e.publicId&&"FILE"===e.itemType&&e.size&&e.name&&(0,Z.dw)(e.name)&&(0,Z.jf)(e.name)>e.size)return!0;return!1}));if(n.length>0){var r=n.map((function(e){return{publicId:e.publicId,startTick:0}}));!function(e){var n=e.attributes;o((0,At.z$)({reviewId:t,attributes:n}))}({attributes:n.map((function(e){return{publicId:e.publicId||"",previewStatus:ev.H.Pending}}))}),_((function(e){return r.concat.apply(r,(0,i.Z)(e))}))}}}}function nv(e,t){if(t.find((function(t){var n;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()}))){var n=(0,Z.qW)(e),i=Math.floor(1e4*Math.random());return"".concat(n.name," ").concat(i,".").concat(n.ext)}return e}function iv(e){var t=e.review,n=e.reviewId,l=e.reviewItems,u=e.onUploadComplete,d=e.children,v=(0,p.$G)().t,_=(0,B.Fn)().fireErrorEvent,h=(0,P.T)(),w=(0,L.T)(),g=w.canUseFreeTier,I=w.storage,b=w.previews,x=(0,Xi.v)(),C=x.entitlement,E=x.updateEntitlement,y=(0,m.useState)(!1),T=(0,s.Z)(y,2),N=T[0],R=T[1],A=(0,m.useRef)(!1),k=(0,m.useCallback)((function(e){(0,dr.eK)(new Error("Storm upload failed for items: ".concat(e.itemIds.join(",")))),(0,D.t6)({message:v("error.review_upload_error"),type:"error"}),_("review_upload_error","onUploadFail_error"),Q(),z(e.itemIds),h((0,At.jw)({reviewId:n,reviewItemIds:e.itemIds}))}),[h,n,v]),S=Xd({reviewId:n,onUploadFail:k,onUploadComplete:function(){var e=(0,o.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(A.current=!1,R(!0),!g){e.next=7;break}return e.next=5,C({query:"storage"});case 5:n=e.sent,null!==(t=n.entitlements)&&void 0!==t&&t.storage&&E("storage",n.entitlements.storage);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),O=S.addItems,M=S.completed,V=S.meta,F=S.progress,U=S.progressItems;(0,Hd.Z)(F>0&&F<100,v("editReview.before_unload_warning"));var W=function(e){var t=e.review,n=e.reviewId,l=e.previewWidth,u=e.previewHeight,d=e.addItems,v=e.completed,_=e.meta,h=e.progressItems,w=e.fullProgress,g=(0,p.$G)().t,I=(0,B.Fn)(),b=I.fireErrorEvent,x=I.fireGroupIdentifyAdd,C=I.fireUserAdd,E=hs().updateReview,y=tv({reviewId:n,previewWidth:l,previewHeight:u}).pollItems,T=(0,m.useState)(0),N=(0,s.Z)(T,2),R=N[0],A=N[1],j=(0,m.useState)([]),k=(0,s.Z)(j,2),S=k[0],O=k[1],M=(0,m.useMemo)(jt.yh,[]),L=(0,f.v9)((function(e){return M(e,n)})),V=(0,f.v9)(lr.HF),F=R;L.forEach((function(e){e.order>F&&(F=e.order)}));var U=(0,P.T)();(0,m.useEffect)((function(){n&&U((0,At.sq)({reviewId:n,previewWidth:l,previewHeight:u}))}),[U,n,l,u]);var W=(0,m.useCallback)((0,o.Z)(c().mark((function e(){var i,o,a,s,l,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=v.map((function(e){return e.id})),!(o=L.filter((function(e){var t=e.publicId,n=e.isProcessingComplete,r=e.stormId;return i.includes(t)&&!1===n&&!r})).map((function(e){var t=v.find((function(t){return t.id===e.publicId}));return{publicId:e.publicId,isProcessingComplete:!0,stormId:null===t||void 0===t?void 0:t.stormId,directFileAccessUrl:null===t||void 0===t?void 0:t.directFileAccessUrl}}))).length){e.next=14;break}return e.next=5,U((0,At.z$)({reviewId:n,attributes:o}));case 5:return(a=e.sent).error&&((0,dr.eK)(a.error),(0,D.t6)({message:g("error.review_upload_error"),type:"error"}),b("review_upload_error","updateReviewItems_error")),e.next=9,E({id:n,attributes:_});case 9:(s=e.sent).error&&((0,dr.eK)(s.error),(0,D.t6)({message:g("error.review_upload_error"),type:"error"}),b("review_upload_error","updateReview_error")),(l=B.Lg.trackReviewItemDiff(L))&&(x({groupType:B.YT.REVIEW,groupName:n,propertyValues:l}),l[B.vb.NUM_ITEMS]&&null!==V&&void 0!==V&&V.sub&&C(null===V||void 0===V?void 0:V.sub,(0,r.Z)({},B.OE.NUM_ITEMS_ADDED,l[B.vb.NUM_ITEMS])),l[B.vb.TOTAL_SIZE]&&t&&(u=(0,r.Z)({},B.$H.STORAGE_USED,l[B.vb.TOTAL_SIZE]),"DRAFT"===(null===t||void 0===t?void 0:t.status)&&(u[B.$H.DRAFT_STORAGE_USED]=l[B.vb.TOTAL_SIZE]),x({groupType:B.YT.WORKSPACE,groupName:null===t||void 0===t?void 0:t.teamId,propertyValues:u}))),O((function(e){return e.filter((function(e){return!i.includes(e.publicId)}))}));case 14:case"end":return e.stop()}}),e)}))),[v,U,x,C,_,t,n,L,g,E,b,null===V||void 0===V?void 0:V.sub]);function G(){return(G=(0,o.Z)(c().mark((function e(t){var r,o,s,l;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Array.from(t),o=r.map((function(e){var t=e;return t.name&&(t.overriddenRelativePath=nv(t.name,L)),t})),s=o.map((function(e){var t=e.url?"LINK":"FILE",i=(0,Ko.Z)(),r="FILE"===t?e.name:void 0,o="FILE"===t?e.size:void 0,s="FILE"===t?(0,Z.mD)(e.name):"",l=F+1;F+=1;var c="LINK"===t?{link:{url:e.url}}:{preview:{image:{url:(0,Z.vY)(e.name,e.size)?URL.createObjectURL(e):null,format:s}}};return(0,B.j)({category:"ensemble",action:"file_upload_start",property:t,label:s,value:o}),(0,a.Z)({itemType:t,publicId:i,name:r,size:o,order:l,isProcessingComplete:!1,reviewId:n},c)})),O([].concat((0,i.Z)(S),(0,i.Z)(s))),e.next=6,U((0,At.Uj)({reviewId:n,reviewItems:s}));case 6:return(l=e.sent).error&&((0,dr.eK)(l.error),(0,D.t6)({message:g("error.review_upload_error"),type:"error"}),b("review_upload_error","createReviewItems_error")),A(F),y({items:s}),e.prev=10,e.next=13,d(o.map((function(e,t){return{id:s[t].publicId,item:e}})));case 13:e.next=20;break;case 15:e.prev=15,e.t0=e.catch(10),(0,dr.eK)(new Error("Failed to add items with error: ".concat(e.t0.message))),(0,D.t6)({message:g("error.review_upload_error"),type:"error"}),b("review_upload_error","addItems_error");case 20:case"end":return e.stop()}}),e,null,[[10,15]])})))).apply(this,arguments)}(0,m.useEffect)((function(){W()}),[W]);var H=(0,m.useMemo)((function(){var e=0,t=L.filter((function(t){return!(!t.isProcessingComplete&&++e>100)}));return t.map((function(n,i){return e>100&&i===t.length-1?(0,a.Z)((0,a.Z)({},n),{},{name:""}):n}))}),[L]);return{reviewItems:(0,m.useMemo)((function(){return H.map((function(e){return h.forEach((function(t){t.id===e.publicId&&(e=(0,a.Z)((0,a.Z)({},e),{},{previewUploadProgress:t.progress}))})),e}))}),[H,h]),progress:w,uploadReviewItems:function(e){return G.apply(this,arguments)},markFailures:function(e){O((function(t){return t.filter((function(t){return!e.includes(t.publicId)}))}))},isIdle:0===S.length}}({review:t,reviewId:n,previewWidth:960,previewHeight:1200,addItems:O,completed:M,meta:V,progressItems:U,fullProgress:F}),G=W.reviewItems,H=W.uploadReviewItems,z=W.markFailures,Y=W.isIdle;!function(e){var t=e.reviewItems,n=e.progressItems,r=(0,m.useRef)([]),o=(0,m.useRef)([]);(0,m.useEffect)((function(){n.forEach((function(e){if(e.progress>0&&!o.current.includes(e.id)&&((0,q.d8)({publicId:e.id}),o.current=[].concat((0,i.Z)(o.current),[e.id])),100===e.progress&&!r.current.includes(e.id)){var n=t.find((function(t){return t.publicId===e.id}));if(n)try{(0,q.Wi)({publicId:n.publicId}),r.current=[].concat((0,i.Z)(r.current),[n.publicId]),(0,q.t1)({publicId:n.publicId}).forEach((function(e){var t=e.duration;return(0,dr.BQ)({duration:t,name:n.name||"",size:Number(n.size)})}))}catch(a){(0,dr.eK)(a)}}}))}),[n])}({reviewItems:l,progressItems:U});var $=(0,Qd.j)(),K=$.dismissToast,X=$.progressToastId,Q=$.resetProgressToast,J=$.updateProgress,ee=100!==F||Y?F:99,te=(0,m.useState)(!1),ne=(0,s.Z)(te,2),ie=ne[0],re=ne[1];(0,m.useEffect)((function(){ee&&J(ee)}),[ee,Q,J]),(0,m.useEffect)((function(){var e=0===l.filter((function(e){return!e.isProcessingComplete})).length;if(e!==ie)return re(e)}),[ie,l,re]),(0,m.useLayoutEffect)((function(){if(g){var e=function(){var e=(0,o.Z)(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C({query:"storage"});case 2:n=e.sent,E("storage",null===(t=n.entitlements)||void 0===t?void 0:t.storage);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}}),[G.length]),(0,m.useEffect)((function(){return function(){(0,D.hm)("OVER_LIMIT")&&(0,D.aW)("OVER_LIMIT"),(0,D.hm)("OVER_PREVIEW_LIMIT")&&(0,D.aW)("OVER_PREVIEW_LIMIT")}}),[]);var oe=(0,m.useCallback)((function(e){var t=50>e.length?e.length:50;if(!g||null===I||void 0===I||!I.quota||null===b||void 0===b||!b.video.quota)return H(e.slice(0,t)),void(t!==e.length&&setTimeout((function(){oe(e.slice(t,e.length))}),1e3));var n=I.quota-I.used,i=e.reduce((function(e,t){return e+Number(t.size)}),0);if(n<0||i>n)return(0,D.t6)({message:(0,j.jsx)(Yi.zD,{type:"OVER_LIMIT"}),position:Gd.Am.POSITION.BOTTOM_CENTER,autoClose:!1,closeOnClick:!0,toastId:"OVER_LIMIT"});0!==e.filter((function(e){return e.type.includes("video")&&e.size>b.video.quota})).length&&(0,D.t6)({message:(0,j.jsx)(Yi.zD,{type:"VIDEO_PREVIEW"}),position:Gd.Am.POSITION.BOTTOM_CENTER,autoClose:!1,closeOnClick:!0,toastId:"OVER_PREVIEW_LIMIT"}),H(e.slice(0,t)),t!==e.length&&setTimeout((function(){oe(e.slice(t,e.length))}),1e3)}),[null===b||void 0===b?void 0:b.video.quota,null===I||void 0===I?void 0:I.quota,null===I||void 0===I?void 0:I.used,H,g]),ae=(0,m.useCallback)((function(e){var t=U.find((function(t){return t.id===e}));return!!t&&(100!==ee&&(t.progress>=0&&t.progress<=100))}),[U,ee]);(0,m.useEffect)((function(){N&&!A.current&&(R(!1),null===u||void 0===u||u(G),A.current=!0)}),[u,G,N]);var se=(0,m.useMemo)((function(){return{reviewItemsWithProgress:G,uploadFiles:oe,progressToastId:X,dismissToast:K,progress:F,isIdle:Y,isItemUploading:ae,isUploadComplete:ie}}),[G,oe,X,K,F,Y,ae,ie]);return(0,j.jsx)(_r.l.Provider,{value:se,children:d})}function rv(e,t,n){var i=(0,p.$G)().t,r=(0,B.Fn)().fireErrorEvent,a=function(){var e,t=(0,Hi.Db)(Dr),n=(0,s.Z)(t,2),i=n[0],r=i.data,o=i.fetching,a=n[1];return{downloadLink:null===r||void 0===r||null===(e=r.downloadReview)||void 0===e?void 0:e.streamingDownloadUrl,isFetching:o,getDownloadReviewLink:a}}(),l=a.getDownloadReviewLink,u=(0,m.useState)(null),d=(0,s.Z)(u,2),v=d[0],f=d[1];function _(){return(_=(0,o.Z)(c().mark((function o(a){var s,u,d,v,m,p,_,h,w,g,I;return c().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(s=a.onSuccess,!(d=e.some((function(e){return"FILE"===e.itemType})))){o.next=15;break}return o.next=5,l({reviewId:t});case 5:if(!((g=o.sent).error||null!==(v=g.data)&&void 0!==v&&null!==(m=v.downloadReview)&&void 0!==m&&m.errors&&(null===(p=g.data)||void 0===p||null===(_=p.downloadReview)||void 0===_?void 0:_.errors.length)>0)){o.next=12;break}return f("error"),I=n?"error.file_download_error":"error.file_download_error_guest",(0,D.t6)({message:i(I)}),r("error.failed_to_download"),o.abrupt("return");case 12:f("success"),(u=null===(h=g.data)||void 0===h||null===(w=h.downloadReview)||void 0===w?void 0:w.streamingDownloadUrl)&&(window.location.href=u);case 15:d&&u||((0,D.t6)({message:i("error.no_files_to_download"),type:"error"}),r("error.failed_to_download")),s&&s();case 17:case"end":return o.stop()}}),o)})))).apply(this,arguments)}return{onDownloadAllFiles:function(e){return _.apply(this,arguments)},downloadStatus:v}}var ov,av,sv=n(63791),lv=(0,Gi.Ps)(ov||(ov=(0,Wi.Z)(["\n  mutation PublicCreateActionRequest($reviewId: String!, $token: String!) {\n    publicCreateActionRequest(reviewId: $reviewId, token: $token) {\n      actionRequest {\n        actionType\n        engagementType\n        email\n        reviewId\n        completionCount\n        completedAt\n        createdAt\n        updatedAt\n      }\n    }\n  }\n"])));var cv,uv=(0,Gi.Ps)(av||(av=(0,Wi.Z)(["\n  mutation PublishReviewMutation(\n    $reviewId: String!\n    $attributes: ActionRequestBatchAttributes!\n  ) {\n    publishReview(reviewId: $reviewId, actionRequestAttributes: $attributes) {\n      review {\n        publicId\n      }\n      errors\n    }\n  }\n"])));var dv=(0,Gi.Ps)(cv||(cv=(0,Wi.Z)(["\n  mutation PublicUpdateActionRequest(\n    $attributes: PublicUpdateActionRequestAttributes!\n    $reviewId: String!\n    $token: String!\n  ) {\n    publicUpdateActionRequest(\n      attributes: $attributes\n      reviewId: $reviewId\n      token: $token\n    ) {\n      actionRequest {\n        completionCount\n      }\n    }\n  }\n"])));function vv(e,t){return e>=1920&&t>=1440}function mv(){var e,t,n,l,u,x,C,E,y,T=(0,L.T)(),N=T.canUpdateReviews,R=T.canUseFreeTier,A=T.canUploadAssets,O=T.restrictionStatus,Y=(0,Yi.i_)().isEnablementBannerActive,$=(0,m.useRef)(!1),K=(0,B.Fn)(),J=K.fireEvent,ee=K.fireErrorEvent,ne=K.fireGroupIdentifyAdd,ie=K.fireGroupIdentifySet,re=K.fireUserAdd,oe=K.fireUserSet,ae=(0,w.Z)().y,se=(0,m.useRef)(!1),le=(0,_.s0)(),ce=(0,P.T)(),ue=(0,_.TH)(),de=ue.state,ve="report",me=(0,p.$G)().t,pe=(0,_.UO)(),fe=pe.reviewId,_e=void 0===fe?"":fe,he=pe.editMode,we=(0,m.useState)(""),ge=(0,s.Z)(we,2),Ie=ge[0],be=ge[1],xe=(0,m.useState)(null),Ce=(0,s.Z)(xe,2),Ee=Ce[0],ye=Ce[1],Te=(0,m.useState)(0),Ne=(0,s.Z)(Te,2),Re=Ne[0],Ae=Ne[1],je=hs(),ke=je.updateReview,De=je.isUpdatingReview,Se=(0,Rt.B)({portalId:Ie,reviewId:_e}),Ze=Se.guestTokenId,Oe=Se.guestEmail,Me=Se.isFetchingGuestToken,Pe=Se.setGuestEmail,Le=(0,Lr.$)({reviewId:_e,guestTokenId:Ze}),Ve=Le.review,Fe=Le.isFetchingReviewStale,Be=Le.isFetchingReview,Ue=Le.shareUrl,We=Le.refreshReview;(0,m.useEffect)((function(){if(!Ve||!Ve.teamId)return ye(null);ur.kV.get("/public/teams/".concat(Ve.teamId)).then((function(e){var t=e.body;ye(t.team)})).catch((function(e){(0,dr.eK)(e),ye(null)}))}),[Ve]),(0,m.useEffect)((function(){be((null===Ve||void 0===Ve?void 0:Ve.reviewCollectionId)||"")}),[null===Ve||void 0===Ve?void 0:Ve.reviewCollectionId]);var Ge=(0,m.useState)(!1),He=(0,s.Z)(Ge,2),qe=He[0],ze=He[1],Ye=(0,m.useState)(cr.U.HIDDEN),$e=(0,s.Z)(Ye,2),Ke=$e[0],Xe=$e[1],Qe=(0,m.useState)("wt"),Je=(0,s.Z)(Qe,2),et=Je[0],tt=Je[1],nt=(0,m.useState)(!1),it=(0,s.Z)(nt,2),rt=it[0],ot=it[1],at=(0,m.useState)(!1),st=(0,s.Z)(at,2),lt=st[0],ct=st[1],ut=(0,m.useState)(null),dt=(0,s.Z)(ut,2),vt=dt[0],mt=dt[1],pt=(0,m.useState)(null),ft=(0,s.Z)(pt,2),_t=ft[0],ht=ft[1],wt=(0,m.useState)(null),gt=(0,s.Z)(wt,2),It=gt[0],xt=gt[1],Ct=(0,m.useState)(!1),Et=(0,s.Z)(Ct,2),yt=Et[0],Tt=Et[1],Nt=(0,m.useState)(!1),jt=(0,s.Z)(Nt,2),Dt=jt[0],St=jt[1],Zt=(0,m.useState)(""),Ot=(0,s.Z)(Zt,2),Mt=Ot[0],Pt=Ot[1],Lt=(0,m.useState)(!1),Vt=(0,s.Z)(Lt,2),Ft=Vt[0],Bt=Vt[1],Ut=(0,m.useState)(!0),Wt=(0,s.Z)(Ut,2),Gt=Wt[0],Ht=Wt[1],qt=(0,m.useState)(!0),zt=(0,s.Z)(qt,2),Yt=zt[0],$t=zt[1],Kt=(0,f.v9)(sr.BX),Xt=(0,f.v9)(lr.HF),Qt=(0,m.useMemo)(ln.q,[]),Jt=(0,f.v9)((function(e){return Qt(e,_e)})),en=(0,f.v9)(kt.v9),tn=(0,m.useRef)(!1),nn=Pr(Ie),rn=nn.portal,on=nn.isFetchingPortal,an=(0,zi.B)(_e),sn=an.actionRequests,cn=an.isFetchingReviewActionRequests,un=(0,F.U)().areAccepted,dn=function(e){var t,n=(0,Hi.aM)({query:qi,variables:{portalId:e},pause:!e}),i=(0,s.Z)(n,2),r=i[0],o=r.data,a=r.fetching,l=i[1];return{portal:null!==(t=null===o||void 0===o?void 0:o.portal)&&void 0!==t?t:null,isFetchingPortal:a,refresh:function(){l({requestPolicy:"network-only"})}}}(Ie),vn=dn.refresh,mn=function(){var e=(0,Hi.Db)(uv),t=(0,s.Z)(e,2),n=t[0],i=n.data,r=n.fetching,o=t[1],a=(0,m.useCallback)((function(e){return o(e,{additionalTypenames:["ReviewCollection"]})}),[o]);return{review:null===i||void 0===i?void 0:i.publishReview.review,errors:null===i||void 0===i?void 0:i.publishReview.errors,isPublishingReview:r,publishReview:a}}(),pn=mn.publishReview,fn=function(){var e=(0,m.useMemo)((function(){return{additionalTypenames:["Review"]}}),[]),t=(0,Hi.Db)(lv),n=(0,s.Z)(t,2),i=n[0],r=i.data,o=i.fetching,a=n[1],l=(0,m.useCallback)((function(t){return a(t,e)}),[a,e]);return{actionRequest:null===r||void 0===r?void 0:r.publicCreateActionRequest.actionRequest,isCreatingActionRequest:o,publicCreateActionRequest:l}}(),_n=fn.publicCreateActionRequest,hn=fn.isCreatingActionRequest,wn=(0,V.G)().isMinTablet,gn=(0,or.i)().height,In=(0,z.g)({portalId:Ie,guestTokenId:Ze}),bn=In.portal,xn=In.refreshPortalReviews,Cn=Ie?null===rn||void 0===rn?void 0:rn.teamId:null===Ve||void 0===Ve?void 0:Ve.teamId,En=(0,ir.c)({guestEmail:Oe,actionRequests:null!==Ve&&void 0!==Ve&&Ve.actionRequest?[Ve.actionRequest]:[],owningTeam:Cn,isFetchingGuestToken:Me}).identity,yn=(0,m.useContext)(G.H),Tn=yn.setIdentity,Nn=yn.setIsOverLimit,Rn=(0,m.useContext)(X.X),An=Rn.setLayoutGrid,jn=Rn.setReviewId,kn=Rn.displayMode,Dn=Rn.enterEditMode,Sn=Rn.exitEditMode,Zn=Rn.reviewItems,On=Rn.setPrePublishAssignee,Mn=Rn.prePublishAssignee,Pn=Rn.reportOriginPage,Ln=(0,Xi.v)(),Vn=Ln.entitlement,Fn=Ln.updateEntitlement,Bn=(0,m.useMemo)((function(){return"edit"===kn}),[kn]),Un=!R&&Bn||Bn&&R&&A,Wn=Zn&&Zn.length>0,Gn=(0,m.useMemo)((function(){return Bn&&!Wn}),[Bn,Wn]),Hn=(0,g.Z)(),qn=(0,s.Z)(Hn,2),zn=qn[0],Yn=qn[1].height,$n=(0,g.Z)(),Kn=(0,s.Z)($n,2),Xn=Kn[0],Qn=Kn[1].width,Jn=(0,m.useCallback)((function(e){null!==e&&Ae(e.getBoundingClientRect().top)}),[]),ei=(0,m.useMemo)((function(){return Math.round(100*(.7*gn-88-Re))/100}),[Re,gn]),ti=(0,m.useMemo)((function(){return!!(Gn&&Yn&&ei)&&Yn+64+16>ei}),[ei,Gn,Yn]),ni=(0,m.useMemo)((function(){return ti?{top:"".concat(Re,"px")}:{top:"".concat(ei,"px")}}),[Re,ei,ti]),ii=(0,m.useMemo)((function(){return Gn?(0,a.Z)((0,a.Z)({},ni),{},{maxWidth:"".concat(Qn,"px")}):void 0}),[Qn,Gn,ni]),ri=(0,m.useMemo)((function(){return{minHeight:"calc(100vh - ".concat(Re,"px)")}}),[Re]),oi=gn>820,ai=(null===Ve||void 0===Ve?void 0:Ve.layoutType)||"COLUMN",si="LOADING"===En,li="OWNER"===En,ci=!li,ui=(0,m.useMemo)((function(){return(null===sn||void 0===sn?void 0:sn.filter((function(e){return"ASSIGNED"===e.engagementType})))||[]}),[sn]);(0,m.useEffect)((function(){Tn(En)}),[En,Tn]),(0,m.useEffect)((function(){Nn(R&&"OVER_LIMIT"===O)}),[R,O,Nn]),(0,m.useEffect)((function(){_e&&!tn.current&&((0,q.hQ)({reviewId:_e}),tn.current=!0)}),[_e]),(0,m.useEffect)((function(){An(ai),jn(_e)}),[An,_e,jn,ai]);var di=(0,m.useState)(!1),vi=(0,s.Z)(di,2),mi=vi[0],pi=vi[1],fi=(0,m.useRef)(vv(window.innerWidth,window.innerHeight)?window.innerWidth:1920),_i=(0,m.useRef)(vv(window.innerWidth,window.innerHeight)?window.innerWidth:1440),hi=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return pi(!0),e.next=3,ce((0,At.sq)({reviewId:_e,previewWidth:fi.current,previewHeight:_i.current}));case 3:pi(!1);case 4:case"end":return e.stop()}}),e)}))),[ce,_e]);(0,m.useEffect)((function(){hi()}),[hi]),(0,m.useEffect)((function(){if("LOADING"!==En&&"OWNER"!==En&&Ve&&Ve.passwordProtected&&!Ve.reviewCollectionId){if((0,H.BV)(_e))return;var e="".concat((0,Ki.o)({reviewId:_e}),"/protected");le(e,{replace:!0})}}),[En,_e,Ve,le]),(0,m.useEffect)((function(){if("LOADING"!==En&&"OWNER"!==En&&Ve&&Ve.passwordProtected&&Ve.reviewCollectionId&&rn&&rn.passwordProtected){if((0,H.e5)(Ve.reviewCollectionId))return;le("/portals/".concat(Ve.reviewCollectionId,"/protected"),{replace:!0,state:{reviewId:_e}})}}),[En,le,rn,Ve,_e]),(0,m.useEffect)((function(){if("LOADING"!==En&&"OWNER"!==En&&Ve&&Ve.passwordProtected&&Ve.reviewCollectionId&&rn&&!rn.passwordProtected){if((0,H.BV)(_e))return;var e="".concat((0,Ki.o)({reviewId:_e}),"/protected");le(e,{replace:!0})}}),[En,le,rn,Ie,Ve,_e]),(0,m.useEffect)((function(){"edit"!==kn||N||Sn()}),[N,kn,Sn,le,Ie,_e]);var wi=un(),gi=(0,m.useCallback)((0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!cn&&!hn&&Yt){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,_n({reviewId:_e,token:Ze});case 4:e.sent.error?((0,D.t6)({message:me("error.failed_to_assign"),type:"error"}),ee("error.failed_to_assign"),$t(!1)):Ht(!1),Ze&&(vt&&(wr(vt.toIncrement,vt.publicId,vt.itemName),mt(null)),_t&&(hr(_t.toIncrement,_t.publicId,_t.itemName),ht(null)));case 7:case"end":return e.stop()}}),e)}))),[Yt,vt,_t,ee,Ze,Be,_n,Ve,_e,me,En]);(0,m.useEffect)((function(){var e,t;if(!Be&&Ze&&Ve&&!Bn&&"OWNER"!==En&&"REVIEWER"!==En&&"LOADING"!==En){var n="FAVORITE"===(null===Ve||void 0===Ve?void 0:Ve.actionType)&&!(null!==Ve&&void 0!==Ve&&null!==(e=Ve.actionRequest)&&void 0!==e&&e.favoritedItems),i="APPROVE"===(null===Ve||void 0===Ve?void 0:Ve.actionType)&&!(null!==Ve&&void 0!==Ve&&null!==(t=Ve.actionRequest)&&void 0!==t&&t.approvedItems),r=!(null!==Ve&&void 0!==Ve&&Ve.actionType)&&!(null!==Ve&&void 0!==Ve&&Ve.actionRequest);(n||i||r)&&gi()}}),[Ze,Ve,gi,Be,Bn,En]),(0,m.useEffect)((function(){var e=function(){var e=(0,o.Z)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(li&&!cn&&!hn){e.next=2;break}return e.abrupt("return");case 2:if(!$.current){e.next=4;break}return e.abrupt("return");case 4:if(Pe((null===Xt||void 0===Xt?void 0:Xt.email)||""),sn.filter((function(e){return"SELF"===e.engagementType&&e.email===(null===Xt||void 0===Xt?void 0:Xt.email)})).length){e.next=10;break}return e.next=9,_n({reviewId:_e,token:Ze});case 9:$.current=!0;case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[sn,Ze,hn,cn,li,_n,_e,Pe,null===Xt||void 0===Xt?void 0:Xt.email]);var Ii=(0,m.useMemo)((function(){return("UNKNOWN_GUEST"===En||!wi&&"LOADING"!==En)&&!on&&!Be&&!Me}),[wi,En,Me,on,Be]),bi=(0,m.useMemo)((function(){return ci||Ii}),[ci,Ii]);(0,m.useEffect)((function(){wi||Xe(cr.U.SHOW_T_AND_C),rn&&ci&&!si&&(null===rn||void 0===rn?void 0:rn.teamId)!==(null===Kt||void 0===Kt?void 0:Kt.id)&&ce((0,ar.F)(null===rn||void 0===rn?void 0:rn.teamId))}),[wi,ce,En,Me,on,Be,ci,si,Ii,rn,Xe,null===Kt||void 0===Kt?void 0:Kt.id]);var xi=(0,sv.A)(li,null===Ve||void 0===Ve?void 0:Ve.teamId).teamMembers,Ci=(0,rr.O)(null===Kt||void 0===Kt?void 0:Kt.id,null===bn||void 0===bn?void 0:bn.teamId).swapTeams;(0,m.useEffect)((function(){null!==Kt&&void 0!==Kt&&Kt.id&&null!==bn&&void 0!==bn&&bn.teamId&&(null===Kt||void 0===Kt?void 0:Kt.id)!==(null===bn||void 0===bn?void 0:bn.teamId)&&(Ci(),We(),hi(),xn())}),[null===bn||void 0===bn?void 0:bn.teamId,xn,We,hi,Ci,null===Kt||void 0===Kt?void 0:Kt.id]),(0,m.useEffect)((function(){Gn&&window.scroll({top:0,behavior:"smooth"})}),[Gn]),(0,m.useEffect)((function(){document.title=(null===Ve||void 0===Ve?void 0:Ve.title)||me("app.document_default_title")}),[me,null===Ve||void 0===Ve?void 0:Ve.title]),(0,m.useEffect)((function(){!se.current&&Ve&&!mi&&"LOADING"!==En&&Kt&&null!==Xt&&void 0!==Xt&&Xt.sub&&((0,B.$9)({review:Ve,portal:rn,team:Kt,userId:Xt.sub,userIdentity:En,tier:en}),Zn.length&&(0,B.bB)({reviewItems:Zn,action:"review_previewability"}),se.current=!0)}),[Ve,Zn,mi,rn,En,en,Kt,null===Xt||void 0===Xt?void 0:Xt.sub]);var Ei=(0,m.useMemo)((function(){return"PUBLISHED"===(null===Ve||void 0===Ve?void 0:Ve.status)}),[Ve]);(0,m.useEffect)((function(){(0,o.Z)(c().mark((function e(){var t,n,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ALL"!==It||!Ve||Be||Fe||De){e.next=13;break}if(xt(null),n=B.Lg.trackReviewAll(Ve,Zn,Mn),On([]),!n){e.next=9;break}return e.next=7,null===(i=J({eventName:B.B_.REVIEW_UPDATED,optionalEventProperties:n,groups:(0,r.Z)({},B.YT.REVIEW,null===Ve||void 0===Ve?void 0:Ve.publicId)}))||void 0===i?void 0:i.promise;case 7:ne({groupType:B.YT.REVIEW,groupName:null===Ve||void 0===Ve?void 0:Ve.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_EDITS,1)}),void 0!==n["Num Assignees"]&&ie({groupType:B.YT.REVIEW,groupName:null===Ve||void 0===Ve?void 0:Ve.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_ASSIGNEES,n["Num Assignees"])});case 9:J({eventName:B.B_.REVIEW_PUBLISHED,groups:(0,r.Z)({},B.YT.REVIEW,null===Ve||void 0===Ve?void 0:Ve.publicId)}),ie({groupType:B.YT.REVIEW,groupName:null===Ve||void 0===Ve?void 0:Ve.publicId,propertyValues:(t={},(0,r.Z)(t,B.vb.STATUS,"Published"),(0,r.Z)(t,B.vb.LAYOUT,(0,U.xo)(null===Ve||void 0===Ve?void 0:Ve.layoutType)),t)}),ne({groupType:B.YT.WORKSPACE,groupName:null===Ve||void 0===Ve?void 0:Ve.teamId,propertyValues:(0,r.Z)({},B.$H.DRAFT_STORAGE_USED,-1*(0,Z.Y7)(Ve.totalSize))}),null!==Xt&&void 0!==Xt&&Xt.sub&&re(Xt.sub,(0,r.Z)({},B.OE.NUM_LIVE_REVIEWS,1));case 13:case"end":return e.stop()}}),e)})))()}),[J,ie,ne,re,Be,Fe,De,Mn,Ve,Zn,On,It,null===Xt||void 0===Xt?void 0:Xt.sub]),(0,m.useEffect)((function(){if("DIFF"===It&&Ve&&!Be&&!Fe&&!De){xt(null);var e=B.Lg.trackReviewDiff(Ve,Zn);e&&(J({eventName:B.B_.REVIEW_UPDATED,optionalEventProperties:e,groups:(0,r.Z)({},B.YT.REVIEW,null===Ve||void 0===Ve?void 0:Ve.publicId)}),ne({groupType:B.YT.REVIEW,groupName:null===Ve||void 0===Ve?void 0:Ve.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_EDITS,1)}))}}),[J,ne,Be,Fe,De,Ve,Zn,It]),(0,m.useEffect)((function(){Bn&&(Ve&&B.Lg.setReviewStart((0,a.Z)({},Ve)),Zn&&B.Lg.setReviewItemsStart((0,i.Z)(Zn)))}),[Bn]),(0,m.useEffect)((function(){if(Ve&&!rt)if(ue.pathname.includes("report")||ue.pathname.includes("new"))ot(!0);else{var e=!Ve.passwordProtected||Ve.passwordProtected&&(0,H.BV)(_e)||Ve.reviewCollectionId&&(0,H.e5)(Ie);"LOADING"!==En&&(li||e)&&(ot(!0),oe((null===Xt||void 0===Xt?void 0:Xt.sub)||"",(0,r.Z)({},B.OE.PORTALS_IDENTITY,li?"Owner":"Guest")),J({eventName:B.B_.REVIEW_OPENED,groups:(0,r.Z)({},B.YT.REVIEW,_e)}))}}),[J,oe,En,_e,Ve,li,ue,rt,Ie,null===Ve||void 0===Ve?void 0:Ve.passwordProtected,null===Xt||void 0===Xt?void 0:Xt.sub]);var yi=(0,m.useCallback)((function(e,t){var n,i=(n={},(0,r.Z)(n,B.r8.ITEM_TYPE,t),(0,r.Z)(n,B.r8.ACTION_TYPE,e),n);if(null!==Ve&&void 0!==Ve&&Ve.dueDate){var o=(new Date).getTime(),a=(0,v.default)(o,new Date(Ve.dueDate));i[B.r8.PAST_DUE_DATE]=a}J({eventName:B.B_.ACTION_ADDED,optionalEventProperties:i,groups:(0,r.Z)({},B.YT.REVIEW,_e)})}),[Ve,_e,J]);(0,m.useEffect)((function(){var e=function(e){e.key==="".concat(Ie,"-passphraseToggled")&&(vn(),localStorage.removeItem("".concat(Ie,"-passphraseToggled")))};return window.addEventListener("storage",e),function(){window.removeEventListener("storage",e),localStorage.removeItem("".concat(Ie,"-passphraseToggled"))}}),[Ie,vn]);var Ti=(0,m.useState)(!1),Ni=(0,s.Z)(Ti,2),Ri=Ni[0],Ai=Ni[1];function ji(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wt";tt(e),Xe(cr.U.SHOW_ID)}function ki(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"wt";tt(e),(Ii||ci)&&Xe(cr.U.SHOW_ID)}function Di(){Xe(cr.U.HIDDEN)}function Si(){ct((function(e){return!e}))}(0,m.useLayoutEffect)((function(){!li||si||Be||mi||0!==Zn.length&&!he||ue.pathname.includes("/report")||(Dn(),setTimeout((function(){return Ai(!0)}),0))}),[he,Dn,li,mi,Be,Zn,ue,si,R]),(0,m.useEffect)((function(){if(!li&&!si&&!Be&&!mi&&"DRAFT"===(null===Ve||void 0===Ve?void 0:Ve.status)){var e=Ie?"/portals/".concat(Ie):"/";le(e)}li||si||Be||mi||!Ei||!he||le((0,Ki.o)({reviewId:_e}))}),[Ve,li,mi,Be,Ei,le,Ie,_e,he,si]),(0,m.useEffect)((function(){var e;return ue.pathname.split("/").includes(ve)&&li&&!si?e=setTimeout((function(){return ze(!0)}),null!==de&&void 0!==de&&de.fromPreviewCard?250:0):ze(!1),function(){return clearTimeout(e)}}),[En,ue.pathname]);function Zi(){return(Zi=(0,o.Z)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,B.BH)({tier:en}),e.prev=1,t="".concat(window.location.origin).concat((0,Ki.o)({reviewId:_e})),J({eventName:B.B_.REVIEW_LINK_COPIED,optionalEventProperties:(0,r.Z)({},B.r8.LOCATION,B.sR.REVIEW),groups:(0,r.Z)({},B.YT.REVIEW,null===Ve||void 0===Ve?void 0:Ve.publicId)}),e.next=6,navigator.clipboard.writeText(t);case 6:(0,D.t6)({message:me("share.success"),type:"info"}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),(0,D.t6)({message:me("share.failure"),type:"error"});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}var Oi=function(){var e,t=(0,Hi.Db)(dv),n=(0,s.Z)(t,2),i=n[0],r=i.data,o=i.fetching,a=n[1];return{updateActionRequestResponse:null===r||void 0===r||null===(e=r.publicUpdateActionRequest)||void 0===e?void 0:e.actionRequest,isUpdatingActionRequest:o,updateActionRequest:a}}(),Mi=Oi.updateActionRequest,Pi=er(_e,"approves",null===Ve||void 0===Ve||null===(e=Ve.actionRequest)||void 0===e?void 0:e.approvedItems,null===Ve||void 0===Ve||null===(t=Ve.actionRequest)||void 0===t?void 0:t.email),Li=Pi.selectedItems,Vi=Pi.updateItems,Fi=er(_e,"favorites",null===Ve||void 0===Ve||null===(n=Ve.actionRequest)||void 0===n?void 0:n.favoritedItems,null===Ve||void 0===Ve||null===(l=Ve.actionRequest)||void 0===l?void 0:l.email),Bi=Fi.selectedItems,Wi=Fi.updateItems,Gi=Zn.map((function(e){return e.favoritedBy})).flat().filter((function(e){return(null===e||void 0===e?void 0:e.email)===Oe})),Qi=Zn.map((function(e){return e.approvedBy})).flat().filter((function(e){return(null===e||void 0===e?void 0:e.email)===Oe})),Ji=Object.values(Jt).map((function(e){return e.nodes})).flat().filter((function(e){return(null===e||void 0===e?void 0:e.author)===Oe})),tr=Object.values(Jt).reduce((function(e,t){return e+(null!==t&&void 0!==t&&t.totalCount?null===t||void 0===t?void 0:t.totalCount:0)}),0),nr=(0,m.useMemo)((function(){var e;return"OWNER"!==En?Bi.length:(null===Ve||void 0===Ve||null===(e=Ve.stats)||void 0===e?void 0:e.totalFavoritedCount)||0}),[Bi,En,null===Ve||void 0===Ve||null===(u=Ve.stats)||void 0===u?void 0:u.totalFavoritedCount]),vr=(0,m.useMemo)((function(){var e;return"OWNER"!==En?Li.length:(null===Ve||void 0===Ve||null===(e=Ve.stats)||void 0===e?void 0:e.totalApprovedCount)||0}),[Li,En,null===Ve||void 0===Ve||null===(x=Ve.stats)||void 0===x?void 0:x.totalApprovedCount]),mr=Gi.length>0||Qi.length>0||Ji.length>0,pr=document.body.clientHeight-window.outerHeight>=160,fr={};pr&&!mr&&"OWNER"!==En&&Gt||(fr={show:!0});var _r=(0,m.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t,n,i){var r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Bt(!1),r={actionType:t,selected:n,itemId:i},e.next=4,Mi({token:Ze,reviewId:_e,attributes:r});case 4:e.sent.error&&((0,D.t6)({message:me("error.submit_review_error"),type:"error"}),ee(me("error.submit_review_error")),Bt(!0)),setTimeout((function(){return St(!1)}),2e3);case 7:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),[ee,Ze,_e,me,Mi]),hr=(0,m.useCallback)((function(e,t,n,i){Wi(e,t);var o,a=e?"FAVORITE_ADDED":"FAVORITE_REMOVED";if(e&&yi("FAVORITE",i),Ii)return ht({toIncrement:e,publicId:t,itemName:n}),ji();(n&&Pt(n),e&&St(!0),Ve)&&((0,B.re)({review:Ve,action:a,portal:bn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",userIdentity:En,guestTokenId:Ze,tier:en,itemId:t,fileName:n||""}),ne({groupType:B.YT.REVIEW,groupName:_e,propertyValues:(o={},(0,r.Z)(o,B.vb.NUM_ACTIONS,e?1:-1),(0,r.Z)(o,B.vb.NUM_REVIEWERS,M(Zn,(null===Xt||void 0===Xt?void 0:Xt.email)||Oe,xi,e)),o)}));_r("FAVORITE",e,t)}),[yi,ne,bn,Oe,Ze,_r,En,Ii,Ve,_e,Zn,Kt,xi,en,Wi,null===Xt||void 0===Xt?void 0:Xt.sub,null===Xt||void 0===Xt?void 0:Xt.email]),wr=(0,m.useCallback)((function(e,t,n,i){Vi(e,t);var o,a=e?"APPROVE_ADDED":"APPROVE_REMOVED";if(e&&yi("APPROVE",i),Ii)return mt({toIncrement:e,publicId:t,itemName:n}),ji();(n&&Pt(n),e&&St(!0),Ve)&&((0,B.re)({review:Ve,action:a,portal:bn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",userIdentity:En,guestTokenId:Ze,tier:en,itemId:t,fileName:n||""}),ne({groupType:B.YT.REVIEW,groupName:_e,propertyValues:(o={},(0,r.Z)(o,B.vb.NUM_ACTIONS,e?1:-1),(0,r.Z)(o,B.vb.NUM_REVIEWERS,M(Zn,(null===Xt||void 0===Xt?void 0:Xt.email)||Oe,xi,e)),o)}));_r("APPROVE",e,t)}),[yi,ne,bn,Oe,Ze,_r,En,Ii,Ve,_e,Zn,Kt,xi,en,Vi,null===Xt||void 0===Xt?void 0:Xt.sub,null===Xt||void 0===Xt?void 0:Xt.email]);(0,m.useEffect)((function(){"REVIEWER"===En&&Ze&&(_t&&(hr(_t.toIncrement,_t.publicId,_t.itemName),ht(null),Ht(!1)),vt&&(wr(vt.toIncrement,vt.publicId,vt.itemName),mt(null),Ht(!1)))}),[En,_t,vt,Ze,wr,hr]);var gr=function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,o,a,s,l,u;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ei){e.next=4;break}return xt("DIFF"),Sn(),e.abrupt("return");case 4:return e.next=6,pn({reviewId:_e,attributes:{emails:t,message:""}});case 6:if(o=e.sent,!((a=null===(n=o.data)||void 0===n||null===(i=n.publishReview)||void 0===i?void 0:i.errors)&&a.length>0&&a.includes("SUBSCRIPTION_OVER_USAGE"))){e.next=11;break}return s=(0,S.Cp)("?trk=review_bnr_at_limit"),e.abrupt("return",(0,D.t6)({message:(0,j.jsx)(p.cC,{i18nKey:"app.publish_review_at_limit",components:[(0,j.jsx)(h.rU,{to:s,target:"_blank",rel:"noopener noreferrer",className:fu,onClick:function(){var e;return J({eventName:B.B_.UPGRADE_FLOW_ENTERED,optionalEventProperties:(e={},(0,r.Z)(e,B.r8.DESTINATION,s),(0,r.Z)(e,B.r8.LOCATION,"Review Publish Toast"),e),bypassTitleize:!0})}})]}),autoClose:!1,closeOnClick:!0,toastId:"REVIEW_AT_LIMIT"}));case 11:if(!o.error){e.next=16;break}(0,D.t6)({message:me("error.publish_review_error"),type:"error"}),ee("error.publish_review_error"),e.next=28;break;case 16:if(!(Ve&&Kt&&Xt)){e.next=25;break}if((0,B.Nk)({review:Ve,reviewItems:Zn,numberOfAssignedReviewers:t.length,portal:rn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",comments:Jt,tier:en}),Zn.length&&(0,B.bB)({reviewItems:Zn,action:"edit_previewability"}),!R){e.next=24;break}return e.next=22,Vn({query:"storage,reviews"});case 22:null!==(u=e.sent)&&void 0!==u&&null!==(l=u.entitlements)&&void 0!==l&&l.reviews&&Fn(["reviews","storage"],[u.entitlements.reviews,u.entitlements.storage]);case 24:(0,D.t6)({message:me("review.review_published"),type:"info"});case 25:Sn(),xt("ALL"),le((0,Ki.o)({reviewId:_e}));case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ir=null===Ve||void 0===Ve?void 0:Ve.downloadEnabled,br=rv(Zn,_e,li),xr=br.downloadStatus,Cr=br.onDownloadAllFiles,Er=function(){var e;Ve&&(ne({groupType:B.YT.REVIEW,groupName:null===Ve||void 0===Ve?void 0:Ve.publicId,propertyValues:(0,r.Z)({},B.vb.NUM_DOWNLOADS,1)}),(0,B.xp)({review:Ve,portal:bn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",userIdentity:En,guestTokenId:Ze,tier:en})),J({eventName:B.B_.FILE_DOWNLOADED,optionalEventProperties:(e={},(0,r.Z)(e,B.r8.TYPE,"all"),(0,r.Z)(e,B.r8.LOCATION,B.sR.REVIEW),e),groups:(0,r.Z)({},B.YT.REVIEW,_e)})},yr=(0,m.useCallback)((function(e){Ve&&Kt&&(0,B.gk)({review:Ve,reviewItems:e,numberOfAssignedReviewers:ui.length,portal:rn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",comments:Jt,tier:en})}),[ui.length,Jt,rn,Ve,Kt,en,null===Xt||void 0===Xt?void 0:Xt.sub]),Tr=(0,m.useCallback)(function(){var e=(0,o.Z)(c().mark((function e(t){var n,i,r,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ke({id:_e,attributes:t});case 2:if(null===(n=e.sent)||void 0===n||!n.error){e.next=6;break}return(0,D.t6)({message:me("error.update_review_error")}),e.abrupt("return");case 6:i=t.title,r=t.description,o={},void 0!==i&&(o[B.vb.TITLE]=i.length),void 0!==r&&(o[B.vb.DESCRIPTION]=r.length),o&&ie({groupType:B.YT.REVIEW,groupName:_e,propertyValues:o}),Kt&&Ve&&"DRAFT"!==Ve.status&&(0,B.gk)({review:Ve,reviewItems:Zn,numberOfAssignedReviewers:ui.length,portal:bn,team:Kt,userId:(null===Xt||void 0===Xt?void 0:Xt.sub)||"",comments:Jt,tier:en,description:t.description,title:t.title});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[ui.length,Jt,ie,bn,Ve,_e,Zn,me,Kt,en,ke,null===Xt||void 0===Xt?void 0:Xt.sub]);if(on||Be||mi||si)return(0,j.jsx)("div",{className:Bc,children:(0,j.jsx)(b.a,{})});var Rr=(0,j.jsx)(Id,{review:Ve,reviewTitle:null===Ve||void 0===Ve?void 0:Ve.title,reviewDescription:null===Ve||void 0===Ve?void 0:Ve.description,onTitleDescriptionChange:Tr,showUploadHero:Gn});return(0,j.jsx)(bt,{review:Ve,user:Xt,team:Kt,teamMembers:xi,children:(0,j.jsx)("div",{className:d()(ou,Y&&lu,Bn?su:au),ref:Jn,id:"review-editor-wrapper",children:(0,j.jsxs)(iv,{review:Ve,reviewId:_e,reviewItems:Zn,onUploadComplete:yr,children:[Bn&&(0,j.jsx)(Nc,{portal:rn,review:Ve,onPublish:gr,portalId:Ie,hasUploadedItems:Wn,hasPublished:Ei}),(0,j.jsx)(Sc,{disabled:!Un,children:(0,j.jsxs)("div",{className:Uc,children:[(0,j.jsxs)("div",{className:d()(Wc,(C={},(0,r.Z)(C,Gc,Bn),(0,r.Z)(C,qc,!Gn||ti),(0,r.Z)(C,Hc,!Wn&&Gn),C)),style:ri,id:"review-page-container",children:[!Gn&&Ve&&(0,j.jsx)(Xu,{downloadEnabled:null===Ve||void 0===Ve?void 0:Ve.downloadEnabled,logoUrl:null===bn||void 0===bn?void 0:bn.logoUrl,title:(null===bn||void 0===bn?void 0:bn.title)||me("portal.untitled"),handleShareReviewModal:Si,handleShareLink:function(){return Zi.apply(this,arguments)},portalId:Ie,identity:En,hasPassphrase:(null===Ve||void 0===Ve?void 0:Ve.passwordProtected)||!1,onDownloadAllFiles:function(e){Cr({onSuccess:e||Er})},canDownloadReviewItems:Ir,review:Ve,portal:rn,downloadStatus:xr}),(0,j.jsx)("div",{className:d()(zc,(E={},(0,r.Z)(E,Kc,Wn),(0,r.Z)(E,$c,oi),(0,r.Z)(E,Yc,Gn&&ti),E)),ref:Xn,children:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:Xc,ref:zn,children:Rr}),(0,j.jsxs)("div",{className:d()(Qc,tu,(y={},(0,r.Z)(y,iu,Gn),(0,r.Z)(y,ru,ti),y)),style:ii,children:[Gn&&(0,j.jsx)("div",{className:nu,children:(0,j.jsx)(Nr,{completedLoading:Ri})}),(0,j.jsx)(jr,{children:(0,j.jsx)(te.bL,{isUnidentifiedUser:Ii,savingActionError:Ft,children:(0,j.jsx)(fs,{portalId:Ie,hasPublished:Ei,isEmptyGrid:!Wn&&Gn,onOpenIdentificationModal:ki,onSetCommentAutofocus:function(e){Tt(e)},autofocusComments:yt,updateApproved:wr,updateFavorites:hr})})}),!Bn&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:Jc,children:"OWNER"!==En&&((null===Ve||void 0===Ve?void 0:Ve.actionType)||(null===Ve||void 0===Ve?void 0:Ve.commentsEnabled))&&wn&&!mr&&Gt&&pr&&(0,j.jsx)(k,{className:eu,onClick:function(){Ht(!1),window.scroll({top:210,behavior:"smooth"})},children:(0,j.jsx)(Td,{icon:I.GM,size:"large",label:me("review.tracker.start_review")})})}),(0,j.jsx)("div",{className:d()(((null===Ve||void 0===Ve?void 0:Ve.actionType)||(null===Ve||void 0===Ve?void 0:Ve.commentsEnabled))&&mu,ae>100&&pu)})]}),Wn&&(0,j.jsx)(xu,{logoUrl:null===Ee||void 0===Ee?void 0:Ee.logo,teamName:null===Ee||void 0===Ee?void 0:Ee.name,title:(null===Ve||void 0===Ve?void 0:Ve.title)||me("portal.untitled"),shareUrl:Ue})]})]})})]}),!Bn&&(0,j.jsx)("div",{className:cu,children:(0,j.jsxs)("div",{className:d()(uu,ae>100&&vu),children:[(0,j.jsx)(Fc,{show:Dt,title:me("APPROVE"===(null===Ve||void 0===Ve?void 0:Ve.actionType)?"review.approve_item_saving_message":"review.favorite_item_saving_message",{itemName:Mt})}),(0,j.jsxs)("div",{className:d()(du),children:[(0,j.jsx)(Ud,{portalId:null===Ve||void 0===Ve?void 0:Ve.reviewCollectionId,canIdentifySelf:bi,identificationModalVisibility:Ke,onOpenIdentificationModal:function(){return ki("user")}}),((null===Ve||void 0===Ve?void 0:Ve.actionType)||(null===Ve||void 0===Ve?void 0:Ve.commentsEnabled)||!(null!==Ve&&void 0!==Ve&&Ve.commentsEnabled)&&tr>0)&&"UNKNOWN_GUEST"!==En&&(0,j.jsx)(k,(0,a.Z)((0,a.Z)({size:"small",inverseScroll:!(mr||!pr)&&"OWNER"!==En,className:eu,onClick:function(){"OWNER"===En&&(J({eventName:B.B_.REPORT_OPENED,optionalEventProperties:(0,r.Z)({},B.r8.LOCATION,B.sR.REVIEW),groups:(0,r.Z)({},B.YT.REVIEW,null===Ve||void 0===Ve?void 0:Ve.publicId)}),We(),le("".concat((0,Ki.o)({reviewId:_e}),"/report")))}},fr),{},{children:(0,j.jsx)(Ad,{showIcons:!0,comments:Jt,review:Ve,identity:En,guestEmail:Oe,approvedItemsCount:vr||0,favoritedItemsCount:nr||0})}))]})]})})]})}),Ke!==cr.U.HIDDEN&&(0,j.jsx)($i.v,{logoUrl:null===Kt||void 0===Kt?void 0:Kt.logo,size:"medium",teamName:(null===Kt||void 0===Kt?void 0:Kt.name)||"",identifiedGuest:!!Oe,showTermsAndConditions:Ke===cr.U.SHOW_T_AND_C,onSubmit:function(e){var t;!function(e){Pe(e),Di()}(e),J({eventName:"user"===et?B.B_.IDENTITY_UPDATED:B.B_.IDENTITY_REQUESTED,optionalEventProperties:(t={},(0,r.Z)(t,B.r8.IDENTITY_SUCCESS,!!e),(0,r.Z)(t,B.r8.LOCATION,B.sR.REVIEW),t)})},onDismiss:function(){var e;Tt(!1),Ke===cr.U.SHOW_ID&&J({eventName:"user"===et?B.B_.IDENTITY_UPDATED:B.B_.IDENTITY_REQUESTED,optionalEventProperties:(e={},(0,r.Z)(e,B.r8.IDENTITY_SUCCESS,!1),(0,r.Z)(e,B.r8.LOCATION,B.sR.REVIEW),e)}),Di()}}),lt&&(0,j.jsx)(Wd.G,{isOpen:lt,portalId:Ie,onDismiss:Si,reviewId:_e,reviewActionType:null===Ve||void 0===Ve?void 0:Ve.actionType,reviewItems:Zn}),li&&(0,j.jsx)(Ui,{portalId:Ie,show:qe,review:Ve,onTransitionEnd:function(){if(ue.pathname.split("/").some((function(e){return e===ve})))switch(Pn){case Q.Wy.REVIEW:le((0,Ki.o)({reviewId:_e}));break;case Q.Wy.PORTAL:le("/portals/".concat(Ie));break;case Q.Wy.HOMEPAGE:le("/")}},onCloseReportOverlay:function(){return ze(!1)}}),Bn&&li&&wn&&(0,j.jsx)(W.n,{placeAttention:!Wn,tier:en})]})})})}var pv=function(){return(0,j.jsx)(X.C,{children:(0,j.jsx)(mv,{})})}}}]);